import { __decorate, __metadata } from "tslib";
import { Component, Input, Output, EventEmitter, ViewEncapsulation, forwardRef, ViewChild, TemplateRef, ChangeDetectionStrategy } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { coerceBooleanProperty, coerceNumberProperty } from '@angular/cdk/coercion';
import moment from 'moment-timezone';
import { DialogService } from '../dialog/dialog.service';
import { DateTimeType } from './date-time-type.enum';
import { InputComponent } from '../input';
let nextId = 0;
const DATE_TIME_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => DateTimeComponent),
    multi: true
};
let DateTimeComponent = class DateTimeComponent {
    constructor(dialogService) {
        this.dialogService = dialogService;
        this.id = `datetime-${++nextId}`;
        this.placeholder = '';
        this.inputFormats = ['L', `LT`, 'L LT', moment.ISO_8601];
        this.change = new EventEmitter();
        this.displayValue = '';
        this.modes = ['millisecond', 'second', 'minute', 'hour', 'date', 'month', 'year'];
        this._disabled = false;
        this._autofocus = false;
        this.onTouchedCallback = () => {
            // placeholder
        };
        this.onChangeCallback = () => {
            // placeholder
        };
    }
    get disabled() {
        return this._disabled;
    }
    set disabled(disabled) {
        this._disabled = coerceBooleanProperty(disabled);
    }
    get tabindex() {
        return this._tabindex;
    }
    set tabindex(tabindex) {
        this._tabindex = coerceNumberProperty(tabindex);
    }
    get autofocus() {
        return this._autofocus;
    }
    set autofocus(autofocus) {
        this._autofocus = coerceBooleanProperty(autofocus);
    }
    get inputType() {
        if (!this._inputType) {
            return DateTimeType.date;
        }
        return this._inputType;
    }
    set inputType(val) {
        this._inputType = val;
        this.displayValue = this.getDisplayValue();
    }
    get format() {
        if (!this._format) {
            if (this.inputType === DateTimeType.date) {
                return 'L';
            }
            else if (this.inputType === DateTimeType.datetime) {
                return 'L LT';
            }
            else {
                return 'LT';
            }
        }
        return this._format;
    }
    set format(val) {
        this._format = val;
        this.displayValue = this.getDisplayValue();
    }
    get value() {
        return this._value;
    }
    set value(val) {
        let date;
        let isSame;
        if (val) {
            date = this.parseDate(val);
            let sameDiff;
            if (this.precision) {
                sameDiff = this.precision;
            }
            else {
                sameDiff = this.inputType === DateTimeType.date ? 'day' : 'second';
            }
            isSame = this._value && date.isSame(this._value, sameDiff);
        }
        else {
            // if we have a val and had no val before, ensure
            // we set the property correctly even if its same
            isSame = val === this._value;
        }
        if (val && date) {
            this.validate(date);
        }
        this._value = date && date.isValid() ? date.toDate() : val;
        if (!isSame) {
            this.onChangeCallback(val);
            this.change.emit(val);
        }
    }
    ngOnDestroy() {
        this.close();
    }
    writeValue(val) {
        this.value = val;
        this.displayValue = this.getDisplayValue();
    }
    onBlur() {
        this.onTouchedCallback();
        const value = this.parseDate(this.value);
        if (this.validate(value)) {
            const displayValue = this.getDisplayValue();
            if (this.input.value !== displayValue) {
                this.input.value = displayValue;
            }
        }
    }
    open() {
        const value = moment(this._value);
        const isValid = value.isValid();
        this.setDialogDate(isValid ? value : new Date());
        this.dialog = this.dialogService.create({
            cssClass: 'ngx-date-time-dialog',
            template: this.calendarTpl,
            closeButton: false
        });
    }
    apply() {
        this.value = this.dialogModel.toDate();
        this.displayValue = this.getDisplayValue();
        this.close();
    }
    setDialogDate(date) {
        this.dialogModel = this.createMoment(date);
        this.hour = +this.dialogModel.format('hh');
        this.minute = this.dialogModel.format('mm');
        this.amPmVal = this.dialogModel.format('A');
    }
    minuteChanged(newVal) {
        this.dialogModel = this.dialogModel.clone().minute(newVal);
        this.minute = this.dialogModel.format('mm');
    }
    hourChanged(newVal) {
        newVal = +newVal % 12;
        if (this.amPmVal === 'PM') {
            newVal = 12 + newVal;
        }
        this.dialogModel = this.dialogModel.clone().hour(newVal);
        this.hour = +this.dialogModel.format('hh');
    }
    selectCurrent() {
        this.setDialogDate(new Date());
    }
    isCurrent() {
        const now = this.createMoment(new Date());
        if (this.inputType === 'time') {
            return now.hour() === this.dialogModel.hour() && now.minute() === this.dialogModel.minute();
        }
        return now.isSame(this.dialogModel, 'minute');
    }
    clear() {
        this.value = undefined;
        this.displayValue = this.getDisplayValue();
        this.close();
    }
    onAmPmChange(newVal) {
        const clone = this.dialogModel.clone();
        if (newVal === 'AM' && this.amPmVal === 'PM') {
            this.dialogModel = clone.subtract(12, 'h');
        }
        else if (newVal === 'PM' && this.amPmVal === 'AM') {
            this.dialogModel = clone.add(12, 'h');
        }
        this.amPmVal = this.dialogModel.format('A');
    }
    getDayDisabled(date) {
        if (!date)
            return false;
        const isBeforeMin = this.minDate && date.isBefore(this.parseDate(this.minDate));
        const isAfterMax = this.maxDate && date.isAfter(this.parseDate(this.maxDate));
        return isBeforeMin || isAfterMax;
    }
    isTimeDisabled(mode) {
        return this.modes.indexOf(`${this.precision}`) > this.modes.indexOf(`${mode}`);
    }
    inputChanged(val) {
        const date = this.parseDate(val);
        this.value = date.isValid() ? date.toDate() : val;
    }
    close() {
        if (!this.dialog)
            return;
        // tear down the dialog instance
        this.dialogService.destroy(this.dialog);
        const date = this.parseDate(this.value);
        this.validate(date);
    }
    registerOnChange(fn) {
        this.onChangeCallback = fn;
    }
    registerOnTouched(fn) {
        this.onTouchedCallback = fn;
    }
    roundTo(val, key) {
        /* istanbul ignore if */
        if (!key || !val) {
            return val;
        }
        val = val.clone();
        const idx = this.modes.indexOf(key);
        if (idx > 0) {
            this.modes.forEach((mode, index) => {
                if (index < idx) {
                    val = val[mode](mode === 'date' ? 1 : 0);
                }
            });
        }
        return val;
    }
    validate(date) {
        const isValid = date.isValid();
        const outOfRange = this.getDayDisabled(date);
        let errorMsg = '';
        if (!isValid)
            errorMsg = 'Invalid Date';
        if (outOfRange)
            errorMsg = 'Date out of range';
        this.errorMsg = errorMsg;
        return isValid && !outOfRange;
    }
    getDisplayValue() {
        // note same as {{ value | amTimeZone: timezone | amDateFormat: format }}
        if (!this.value) {
            return '';
        }
        const m = this.createMoment(this.value);
        return m.isValid() ? m.format(this.format) : '' + String(this.value);
    }
    parseDate(date) {
        if (date instanceof Date) {
            /* istanbul ignore next */
            date = isNaN(date.getTime()) ? date.toString() : date.toISOString();
        }
        const inputFormats = [...this.inputFormats];
        if (this.format && !inputFormats.includes(this.format)) {
            inputFormats.unshift(this.format);
        }
        let m = this.timezone ? moment.tz(date, inputFormats, this.timezone) : moment(date, inputFormats);
        m = this.precision ? this.roundTo(m, this.precision) : m;
        return m;
    }
    createMoment(date) {
        let m = moment(date).clone();
        m = this.timezone ? m.tz(this.timezone) : m;
        m = this.precision ? this.roundTo(m, this.precision) : m;
        return m;
    }
};
DateTimeComponent.ctorParameters = () => [
    { type: DialogService }
];
__decorate([
    Input(),
    __metadata("design:type", String)
], DateTimeComponent.prototype, "id", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DateTimeComponent.prototype, "name", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DateTimeComponent.prototype, "label", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DateTimeComponent.prototype, "hint", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DateTimeComponent.prototype, "placeholder", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DateTimeComponent.prototype, "minDate", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DateTimeComponent.prototype, "maxDate", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], DateTimeComponent.prototype, "precision", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], DateTimeComponent.prototype, "timezone", void 0);
__decorate([
    Input(),
    __metadata("design:type", Array)
], DateTimeComponent.prototype, "inputFormats", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], DateTimeComponent.prototype, "disabled", null);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], DateTimeComponent.prototype, "tabindex", null);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], DateTimeComponent.prototype, "autofocus", null);
__decorate([
    Input(),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [String])
], DateTimeComponent.prototype, "inputType", null);
__decorate([
    Input(),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [String])
], DateTimeComponent.prototype, "format", null);
__decorate([
    Output(),
    __metadata("design:type", Object)
], DateTimeComponent.prototype, "change", void 0);
__decorate([
    ViewChild('dialogTpl', { static: true }),
    __metadata("design:type", TemplateRef)
], DateTimeComponent.prototype, "calendarTpl", void 0);
__decorate([
    ViewChild('input', { static: true }),
    __metadata("design:type", InputComponent)
], DateTimeComponent.prototype, "input", void 0);
DateTimeComponent = __decorate([
    Component({
        exportAs: 'ngxDateTime',
        selector: 'ngx-date-time',
        template: "<div class=\"ngx-date-time\">\n  <ng-template #dialogTpl>\n    <div class=\"selected-header text-center\">\n      <h1>\n        <span *ngIf=\"dialogModel && (inputType === 'datetime' || inputType === 'date')\">\n          {{ dialogModel | amTimeZone: timezone | amDateFormat: 'ddd, MMM D YYYY' }}\n          <small *ngIf=\"inputType === 'datetime'\">\n            {{ dialogModel | amTimeZone: timezone | amDateFormat: 'h:mm a' }}\n          </small>\n        </span>\n        <span *ngIf=\"dialogModel && inputType === 'time'\">\n          {{ dialogModel | amTimeZone: timezone | amDateFormat: 'h:mm a' }}\n        </span>\n        <span *ngIf=\"!dialogModel\">No value</span>\n      </h1>\n    </div>\n    <ngx-calendar\n      [id]=\"id + '-cal'\"\n      *ngIf=\"inputType === 'date' || inputType === 'datetime'\"\n      (change)=\"setDialogDate($event)\"\n      [minDate]=\"minDate\"\n      [maxDate]=\"maxDate\"\n      [ngModel]=\"dialogModel\"\n      [timezone]=\"timezone\"\n      [minView]=\"precision\"\n      name=\"calendar\"\n    >\n    </ngx-calendar>\n    <div class=\"time-row\" *ngIf=\"inputType === 'time' || inputType === 'datetime'\">\n      <div fxLayout=\"row\" fxLayoutGap=\"10px\" fxLayoutWrap=\"nowrap\" fxLayoutAlign=\"center baseline\">\n        <div fxFlex>\n          <ngx-input\n            type=\"number\"\n            hint=\"Hour\"\n            [id]=\"id + '-hour'\"\n            [ngModel]=\"hour\"\n            min=\"1\"\n            max=\"12\"\n            (change)=\"hourChanged($event)\"\n            [disabled]=\"isTimeDisabled('hour')\"\n          >\n          </ngx-input>\n        </div>\n        <div fxFlex>\n          <ngx-input\n            type=\"number\"\n            hint=\"Minute\"\n            [id]=\"id + '-minute'\"\n            [ngModel]=\"minute\"\n            min=\"0\"\n            max=\"59\"\n            (change)=\"minuteChanged($event)\"\n            [disabled]=\"isTimeDisabled('minute')\"\n          >\n          </ngx-input>\n        </div>\n        <div fxFlex>\n          <button\n            class=\"ampm\"\n            type=\"button\"\n            [class.selected]=\"amPmVal === 'AM'\"\n            (click)=\"onAmPmChange('AM')\"\n            [disabled]=\"isTimeDisabled('hour')\"\n          >\n            AM\n          </button>\n          <button\n            class=\"ampm\"\n            type=\"button\"\n            [class.selected]=\"amPmVal === 'PM'\"\n            (click)=\"onAmPmChange('PM')\"\n            [disabled]=\"isTimeDisabled('hour')\"\n          >\n            PM\n          </button>\n        </div>\n      </div>\n    </div>\n    <nav role=\"navigation\" class=\"ngx-dialog-footer\">\n      <div fxLayout=\"row\" fxLayoutWrap=\"nowrap\">\n        <div class=\"text-left\" fxFlex=\"1 1 50%\">\n          <button type=\"button\" class=\"btn btn-link today-btn\" (click)=\"selectCurrent()\" [hidden]=\"isCurrent()\">\n            Current\n          </button>\n        </div>\n        <div class=\"text-right\" fxFlex=\"1 1 50%\">\n          <button type=\"button\" class=\"btn btn-link clear-btn\" (click)=\"clear()\">Clear</button>\n          <button type=\"button\" class=\"btn btn-link apply-btn\" (click)=\"apply()\">Apply</button>\n        </div>\n      </div>\n    </nav>\n  </ng-template>\n  <ngx-input\n    #input\n    [id]=\"id + '-input'\"\n    [autocorrect]=\"false\"\n    [autocomplete]=\"false\"\n    [spellcheck]=\"false\"\n    [disabled]=\"disabled\"\n    [placeholder]=\"placeholder\"\n    [autofocus]=\"autofocus\"\n    [tabindex]=\"tabindex\"\n    [label]=\"label\"\n    [ngModel]=\"displayValue\"\n    (ngModelChange)=\"inputChanged($event)\"\n    (blur)=\"onBlur()\"\n  >\n    <ngx-input-hint>\n      <div fxLayout=\"row\" fxLayoutGap=\"10px\" fxLayoutWrap=\"nowrap\">\n        <div fxFlex *ngIf=\"hint\" class=\"text-left\">{{ hint }}</div>\n        <div *ngIf=\"errorMsg\" fxFlex class=\"text-right input-error\">{{ errorMsg }}</div>\n      </div>\n    </ngx-input-hint>\n  </ngx-input>\n  <button\n    title=\"Show date/time selector\"\n    type=\"button\"\n    [disabled]=\"disabled\"\n    (click)=\"open()\"\n    [ngClass]=\"{\n      'icon-calendar': inputType === 'date',\n      'icon-calendar-clock': inputType === 'datetime',\n      'icon-clock': inputType === 'time'\n    }\"\n    class=\"calendar-dialog-btn\"\n  ></button>\n</div>\n",
        providers: [DATE_TIME_VALUE_ACCESSOR],
        encapsulation: ViewEncapsulation.None,
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: ["input[type=number],input[type=password],input[type=tel],input[type=text],textarea{display:inline-block;box-sizing:border-box;outline:0}.form-input{background:#313847;border:1px solid #455066;color:#b6b6b6;-webkit-transition:box-shadow .2s;transition:box-shadow .2s;border-radius:0;font-size:13px;height:32px;line-height:32px;width:100%;padding:6px;margin-bottom:1em}.form-input::-webkit-input-placeholder{color:#647493}.form-input::-moz-placeholder{color:#647493}.form-input::-ms-input-placeholder{color:#647493}.form-input::placeholder{color:#647493}.form-input:focus{box-shadow:0 1px 5px 0 rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.12)}.form-input[disabled]{cursor:not-allowed;color:#363636}textarea.form-input{min-height:120px;line-height:1.3em}.ngx-date-time{position:relative}.ngx-date-time .calendar-dialog-btn{position:absolute;right:5px;height:30px;line-height:30px;top:-5px;color:#afb7c8;padding:20px 0;padding-top:calc(.7em + 8px);padding-bottom:calc(.7em + 8px)}.ngx-date-time .input-error{color:#ff4514}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog{padding:0!important;width:auto}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog h1{font-size:1.2rem;white-space:nowrap}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog h1 small{color:#cfcfcf}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .selected-header{padding:5px 20px;background:#1483ff;color:#cfcfcf}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .time-row{background:#1c2029;border:1px solid #2d3544;padding:8px 15px;margin-top:0}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .time-row .ngx-input{margin-top:0;padding-top:0}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .time-row .ngx-input .ngx-input-underline{background-color:#b6b6b6}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .time-row button.ampm{color:#5a6884}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .time-row button.ampm.selected{color:#fff}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .ngx-calendar{box-shadow:none}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .ngx-calendar .title-row{background:0 0}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .ngx-calendar .day-name-row{margin-top:0}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .ngx-dialog-footer{border:1px solid #2d3544;border-top:0;padding:.5rem 0}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .ngx-dialog-footer .btn{font-size:1em;color:#72819f;margin:0;padding:0}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .ngx-dialog-footer .today-btn{margin-left:15px;opacity:1;-webkit-transition:opacity .2s;transition:opacity .2s}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .ngx-dialog-footer .today-btn[hidden]{display:inline-block!important;opacity:0}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .ngx-dialog-footer .apply-btn{margin-right:15px;color:#479eff}.ngx-dialog .ngx-dialog-content.ngx-date-time-dialog .ngx-dialog-footer .clear-btn{margin-right:15px}"]
    }),
    __metadata("design:paramtypes", [DialogService])
], DateTimeComponent);
export { DateTimeComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS10aW1lLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bzd2ltbGFuZS9uZ3gtdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9kYXRlLXRpbWUvZGF0ZS10aW1lLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixpQkFBaUIsRUFDakIsVUFBVSxFQUNWLFNBQVMsRUFDVCxXQUFXLEVBR1gsdUJBQXVCLEVBQ3hCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVwRixPQUFPLE1BQU0sTUFBTSxpQkFBaUIsQ0FBQztBQUVyQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDekQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRXJELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFMUMsSUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFDO0FBRWYsTUFBTSx3QkFBd0IsR0FBRztJQUMvQixPQUFPLEVBQUUsaUJBQWlCO0lBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsaUJBQWlCLENBQUM7SUFDaEQsS0FBSyxFQUFFLElBQUk7Q0FDWixDQUFDO0FBV0YsSUFBYSxpQkFBaUIsR0FBOUIsTUFBYSxpQkFBaUI7SUFnSTVCLFlBQTZCLGFBQTRCO1FBQTVCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBL0hoRCxPQUFFLEdBQVcsWUFBWSxFQUFFLE1BQU0sRUFBRSxDQUFDO1FBSXBDLGdCQUFXLEdBQVcsRUFBRSxDQUFDO1FBT3pCLGlCQUFZLEdBQVUsQ0FBQyxHQUFHLEVBQUUs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QVMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7OEJBQ3JCLGNBQWM7Z0RBQUM7QUE5R3BCLGlCQUFpQjtJQVQ3QixTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsYUFBYTtRQUN2QixRQUFRLEVBQUUsZUFBZTtRQUN6Qixrd0lBQXlDO1FBRXpDLFNBQVMsRUFBRSxDQUFDLHdCQUF3QixDQUFDO1FBQ3JDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO1FBQ3JDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOztLQUNoRCxDQUFDO3FDQWlJNEMsYUFBYTtHQWhJOUMsaUJBQWlCLENBa1U3QjtTQWxVWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG4gIGZvcndhcmRSZWYsXG4gIFZpZXdDaGlsZCxcbiAgVGVtcGxhdGVSZWYsXG4gIE9uRGVzdHJveSxcbiAgRWxlbWVudFJlZixcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3lcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBjb2VyY2VCb29sZWFuUHJvcGVydHksIGNvZXJjZU51bWJlclByb3BlcnR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcblxuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQtdGltZXpvbmUnO1xuXG5pbXBvcnQgeyBEaWFsb2dTZXJ2aWNlIH0gZnJvbSAnLi4vZGlhbG9nL2RpYWxvZy5zZXJ2aWNlJztcbmltcG9ydCB7IERhdGVUaW1lVHlwZSB9IGZyb20gJy4vZGF0ZS10aW1lLXR5cGUuZW51bSc7XG5pbXBvcnQgeyBEYXRlbGlrZSB9IGZyb20gJy4vZGF0ZS1saWtlLnR5cGUnO1xuaW1wb3J0IHsgSW5wdXRDb21wb25lbnQgfSBmcm9tICcuLi9pbnB1dCc7XG5cbmxldCBuZXh0SWQgPSAwO1xuXG5jb25zdCBEQVRFX1RJTUVfVkFMVUVfQUNDRVNTT1IgPSB7XG4gIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBEYXRlVGltZUNvbXBvbmVudCksXG4gIG11bHRpOiB0cnVlXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgZXhwb3J0QXM6ICduZ3hEYXRlVGltZScsXG4gIHNlbGVjdG9yOiAnbmd4LWRhdGUtdGltZScsXG4gIHRlbXBsYXRlVXJsOiAnLi9kYXRlLXRpbWUuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9kYXRlLXRpbWUuY29tcG9uZW50LnNjc3MnXSxcbiAgcHJvdmlkZXJzOiBbREFURV9USU1FX1ZBTFVFX0FDQ0VTU09SXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgRGF0ZVRpbWVDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcbiAgQElucHV0KCkgaWQ6IHN0cmluZyA9IGBkYXRldGltZS0keysrbmV4dElkfWA7XG4gIEBJbnB1dCgpIG5hbWU6IHN0cmluZztcbiAgQElucHV0KCkgbGFiZWw6IHN0cmluZztcbiAgQElucHV0KCkgaGludDogc3RyaW5nO1xuICBASW5wdXQoKSBwbGFjZWhvbGRlcjogc3RyaW5nID0gJyc7XG5cbiAgQElucHV0KCkgbWluRGF0ZTogc3RyaW5nIHwgRGF0ZTtcbiAgQElucHV0KCkgbWF4RGF0ZTogc3RyaW5nIHwgRGF0ZTtcbiAgQElucHV0KCkgcHJlY2lzaW9uOiBtb21lbnQudW5pdE9mVGltZS5TdGFydE9mO1xuXG4gIEBJbnB1dCgpIHRpbWV6b25lOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGlucHV0Rm9ybWF0czogYW55W10gPSBbJ0wnLCBgTFRgLCAnTCBMVCcsIG1vbWVudC5JU09fODYwMV07XG5cbiAgQElucHV0KClcbiAgZ2V0IGRpc2FibGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9kaXNhYmxlZDtcbiAgfVxuICBzZXQgZGlzYWJsZWQoZGlzYWJsZWQpIHtcbiAgICB0aGlzLl9kaXNhYmxlZCA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eShkaXNhYmxlZCk7XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgdGFiaW5kZXgoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3RhYmluZGV4O1xuICB9XG4gIHNldCB0YWJpbmRleCh0YWJpbmRleCkge1xuICAgIHRoaXMuX3RhYmluZGV4ID0gY29lcmNlTnVtYmVyUHJvcGVydHkodGFiaW5kZXgpO1xuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IGF1dG9mb2N1cygpIHtcbiAgICByZXR1cm4gdGhpcy5fYXV0b2ZvY3VzO1xuICB9XG4gIHNldCBhdXRvZm9jdXMoYXV0b2ZvY3VzKSB7XG4gICAgdGhpcy5fYXV0b2ZvY3VzID0gY29lcmNlQm9vbGVhblByb3BlcnR5KGF1dG9mb2N1cyk7XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgaW5wdXRUeXBlKCk6IHN0cmluZyB7XG4gICAgaWYgKCF0aGlzLl9pbnB1dFR5cGUpIHtcbiAgICAgIHJldHVybiBEYXRlVGltZVR5cGUuZGF0ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2lucHV0VHlwZTtcbiAgfVxuICBzZXQgaW5wdXRUeXBlKHZhbDogc3RyaW5nKSB7XG4gICAgdGhpcy5faW5wdXRUeXBlID0gdmFsO1xuICAgIHRoaXMuZGlzcGxheVZhbHVlID0gdGhpcy5nZXREaXNwbGF5VmFsdWUoKTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIGdldCBmb3JtYXQoKTogc3RyaW5nIHtcbiAgICBpZiAoIXRoaXMuX2Zvcm1hdCkge1xuICAgICAgaWYgKHRoaXMuaW5wdXRUeXBlID09PSBEYXRlVGltZVR5cGUuZGF0ZSkge1xuICAgICAgICByZXR1cm4gJ0wnO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmlucHV0VHlwZSA9PT0gRGF0ZVRpbWVUeXBlLmRhdGV0aW1lKSB7XG4gICAgICAgIHJldHVybiAnTCBMVCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ0xUJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fZm9ybWF0O1xuICB9XG4gIHNldCBmb3JtYXQodmFsOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9mb3JtYXQgPSB2YWw7XG4gICAgdGhpcy5kaXNwbGF5VmFsdWUgPSB0aGlzLmdldERpc3BsYXlWYWx1ZSgpO1xuICB9XG5cbiAgZ2V0IHZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuICBzZXQgdmFsdWUodmFsOiBEYXRlIHwgc3RyaW5nKSB7XG4gICAgbGV0IGRhdGU6IG1vbWVudC5Nb21lbnQ7XG4gICAgbGV0IGlzU2FtZTogYm9vbGVhbjtcblxuICAgIGlmICh2YWwpIHtcbiAgICAgIGRhdGUgPSB0aGlzLnBhcnNlRGF0ZSh2YWwpO1xuICAgICAgbGV0IHNhbWVEaWZmOiBtb21lbnQudW5pdE9mVGltZS5TdGFydE9mO1xuXG4gICAgICBpZiAodGhpcy5wcmVjaXNpb24pIHtcbiAgICAgICAgc2FtZURpZmYgPSB0aGlzLnByZWNpc2lvbjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNhbWVEaWZmID0gdGhpcy5pbnB1dFR5cGUgPT09IERhdGVUaW1lVHlwZS5kYXRlID8gJ2RheScgOiAnc2Vjb25kJztcbiAgICAgIH1cblxuICAgICAgaXNTYW1lID0gdGhpcy5fdmFsdWUgJiYgZGF0ZS5pc1NhbWUodGhpcy5fdmFsdWUsIHNhbWVEaWZmKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gaWYgd2UgaGF2ZSBhIHZhbCBhbmQgaGFkIG5vIHZhbCBiZWZvcmUsIGVuc3VyZVxuICAgICAgLy8gd2Ugc2V0IHRoZSBwcm9wZXJ0eSBjb3JyZWN0bHkgZXZlbiBpZiBpdHMgc2FtZVxuICAgICAgaXNTYW1lID0gdmFsID09PSB0aGlzLl92YWx1ZTtcbiAgICB9XG5cbiAgICBpZiAodmFsICYmIGRhdGUpIHtcbiAgICAgIHRoaXMudmFsaWRhdGUoZGF0ZSk7XG4gICAgfVxuICAgIHRoaXMuX3ZhbHVlID0gZGF0ZSAmJiBkYXRlLmlzVmFsaWQoKSA/IGRhdGUudG9EYXRlKCkgOiB2YWw7XG5cbiAgICBpZiAoIWlzU2FtZSkge1xuICAgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrKHZhbCk7XG4gICAgICB0aGlzLmNoYW5nZS5lbWl0KHZhbCk7XG4gICAgfVxuICB9XG5cbiAgQE91dHB1dCgpIGNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nIHwgRGF0ZT4oKTtcblxuICBAVmlld0NoaWxkKCdkaWFsb2dUcGwnLCB7IHN0YXRpYzogdHJ1ZSB9KVxuICByZWFkb25seSBjYWxlbmRhclRwbDogVGVtcGxhdGVSZWY8RWxlbWVudFJlZj47XG5cbiAgQFZpZXdDaGlsZCgnaW5wdXQnLCB7IHN0YXRpYzogdHJ1ZSB9KVxuICByZWFkb25seSBpbnB1dDogSW5wdXRDb21wb25lbnQ7XG5cbiAgZXJyb3JNc2c6IHN0cmluZztcbiAgZGlhbG9nOiBhbnk7XG4gIGRpYWxvZ01vZGVsOiBtb21lbnQuTW9tZW50O1xuICBob3VyOiBudW1iZXI7XG4gIG1pbnV0ZTogc3RyaW5nO1xuICBhbVBtVmFsOiBzdHJpbmc7XG4gIGRpc3BsYXlWYWx1ZSA9ICcnO1xuICBtb2RlcyA9IFsnbWlsbGlzZWNvbmQnLCAnc2Vjb25kJywgJ21pbnV0ZScsICdob3VyJywgJ2RhdGUnLCAnbW9udGgnLCAneWVhciddO1xuXG4gIHByaXZhdGUgX3ZhbHVlOiBEYXRlIHwgc3RyaW5nO1xuICBwcml2YXRlIF9mb3JtYXQ6IHN0cmluZztcbiAgcHJpdmF0ZSBfaW5wdXRUeXBlOiBzdHJpbmc7XG4gIHByaXZhdGUgX2Rpc2FibGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgX2F1dG9mb2N1czogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF90YWJpbmRleDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgZGlhbG9nU2VydmljZTogRGlhbG9nU2VydmljZSkge31cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbDogYW55KTogdm9pZCB7XG4gICAgdGhpcy52YWx1ZSA9IHZhbDtcbiAgICB0aGlzLmRpc3BsYXlWYWx1ZSA9IHRoaXMuZ2V0RGlzcGxheVZhbHVlKCk7XG4gIH1cblxuICBvbkJsdXIoKSB7XG4gICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjaygpO1xuXG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLnBhcnNlRGF0ZSh0aGlzLnZhbHVlKTtcbiAgICBpZiAodGhpcy52YWxpZGF0ZSh2YWx1ZSkpIHtcbiAgICAgIGNvbnN0IGRpc3BsYXlWYWx1ZSA9IHRoaXMuZ2V0RGlzcGxheVZhbHVlKCk7XG4gICAgICBpZiAodGhpcy5pbnB1dC52YWx1ZSAhPT0gZGlzcGxheVZhbHVlKSB7XG4gICAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBkaXNwbGF5VmFsdWU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb3BlbigpOiB2b2lkIHtcbiAgICBjb25zdCB2YWx1ZSA9IG1vbWVudCh0aGlzLl92YWx1ZSk7XG4gICAgY29uc3QgaXNWYWxpZCA9IHZhbHVlLmlzVmFsaWQoKTtcblxuICAgIHRoaXMuc2V0RGlhbG9nRGF0ZShpc1ZhbGlkID8gdmFsdWUgOiBuZXcgRGF0ZSgpKTtcblxuICAgIHRoaXMuZGlhbG9nID0gdGhpcy5kaWFsb2dTZXJ2aWNlLmNyZWF0ZSh7XG4gICAgICBjc3NDbGFzczogJ25neC1kYXRlLXRpbWUtZGlhbG9nJyxcbiAgICAgIHRlbXBsYXRlOiB0aGlzLmNhbGVuZGFyVHBsLFxuICAgICAgY2xvc2VCdXR0b246IGZhbHNlXG4gICAgfSk7XG4gIH1cblxuICBhcHBseSgpOiB2b2lkIHtcbiAgICB0aGlzLnZhbHVlID0gdGhpcy5kaWFsb2dNb2RlbC50b0RhdGUoKTtcbiAgICB0aGlzLmRpc3BsYXlWYWx1ZSA9IHRoaXMuZ2V0RGlzcGxheVZhbHVlKCk7XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9XG5cbiAgc2V0RGlhbG9nRGF0ZShkYXRlOiBEYXRlbGlrZSkge1xuICAgIHRoaXMuZGlhbG9nTW9kZWwgPSB0aGlzLmNyZWF0ZU1vbWVudChkYXRlKTtcbiAgICB0aGlzLmhvdXIgPSArdGhpcy5kaWFsb2dNb2RlbC5mb3JtYXQoJ2hoJyk7XG4gICAgdGhpcy5taW51dGUgPSB0aGlzLmRpYWxvZ01vZGVsLmZvcm1hdCgnbW0nKTtcbiAgICB0aGlzLmFtUG1WYWwgPSB0aGlzLmRpYWxvZ01vZGVsLmZvcm1hdCgnQScpO1xuICB9XG5cbiAgbWludXRlQ2hhbmdlZChuZXdWYWw6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuZGlhbG9nTW9kZWwgPSB0aGlzLmRpYWxvZ01vZGVsLmNsb25lKCkubWludXRlKG5ld1ZhbCk7XG4gICAgdGhpcy5taW51dGUgPSB0aGlzLmRpYWxvZ01vZGVsLmZvcm1hdCgnbW0nKTtcbiAgfVxuXG4gIGhvdXJDaGFuZ2VkKG5ld1ZhbDogbnVtYmVyKTogdm9pZCB7XG4gICAgbmV3VmFsID0gK25ld1ZhbCAlIDEyO1xuICAgIGlmICh0aGlzLmFtUG1WYWwgPT09ICdQTScpIHtcbiAgICAgIG5ld1ZhbCA9IDEyICsgbmV3VmFsO1xuICAgIH1cbiAgICB0aGlzLmRpYWxvZ01vZGVsID0gdGhpcy5kaWFsb2dNb2RlbC5jbG9uZSgpLmhvdXIobmV3VmFsKTtcbiAgICB0aGlzLmhvdXIgPSArdGhpcy5kaWFsb2dNb2RlbC5mb3JtYXQoJ2hoJyk7XG4gIH1cblxuICBzZWxlY3RDdXJyZW50KCk6IHZvaWQge1xuICAgIHRoaXMuc2V0RGlhbG9nRGF0ZShuZXcgRGF0ZSgpKTtcbiAgfVxuXG4gIGlzQ3VycmVudCgpIHtcbiAgICBjb25zdCBub3cgPSB0aGlzLmNyZWF0ZU1vbWVudChuZXcgRGF0ZSgpKTtcbiAgICBpZiAodGhpcy5pbnB1dFR5cGUgPT09ICd0aW1lJykge1xuICAgICAgcmV0dXJuIG5vdy5ob3VyKCkgPT09IHRoaXMuZGlhbG9nTW9kZWwuaG91cigpICYmIG5vdy5taW51dGUoKSA9PT0gdGhpcy5kaWFsb2dNb2RlbC5taW51dGUoKTtcbiAgICB9XG4gICAgcmV0dXJuIG5vdy5pc1NhbWUodGhpcy5kaWFsb2dNb2RlbCwgJ21pbnV0ZScpO1xuICB9XG5cbiAgY2xlYXIoKTogdm9pZCB7XG4gICAgdGhpcy52YWx1ZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmRpc3BsYXlWYWx1ZSA9IHRoaXMuZ2V0RGlzcGxheVZhbHVlKCk7XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9XG5cbiAgb25BbVBtQ2hhbmdlKG5ld1ZhbDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgY2xvbmUgPSB0aGlzLmRpYWxvZ01vZGVsLmNsb25lKCk7XG4gICAgaWYgKG5ld1ZhbCA9PT0gJ0FNJyAmJiB0aGlzLmFtUG1WYWwgPT09ICdQTScpIHtcbiAgICAgIHRoaXMuZGlhbG9nTW9kZWwgPSBjbG9uZS5zdWJ0cmFjdCgxMiwgJ2gnKTtcbiAgICB9IGVsc2UgaWYgKG5ld1ZhbCA9PT0gJ1BNJyAmJiB0aGlzLmFtUG1WYWwgPT09ICdBTScpIHtcbiAgICAgIHRoaXMuZGlhbG9nTW9kZWwgPSBjbG9uZS5hZGQoMTIsICdoJyk7XG4gICAgfVxuICAgIHRoaXMuYW1QbVZhbCA9IHRoaXMuZGlhbG9nTW9kZWwuZm9ybWF0KCdBJyk7XG4gIH1cblxuICBnZXREYXlEaXNhYmxlZChkYXRlOiBtb21lbnQuTW9tZW50KTogYm9vbGVhbiB7XG4gICAgaWYgKCFkYXRlKSByZXR1cm4gZmFsc2U7XG5cbiAgICBjb25zdCBpc0JlZm9yZU1pbiA9IHRoaXMubWluRGF0ZSAmJiBkYXRlLmlzQmVmb3JlKHRoaXMucGFyc2VEYXRlKHRoaXMubWluRGF0ZSkpO1xuICAgIGNvbnN0IGlzQWZ0ZXJNYXggPSB0aGlzLm1heERhdGUgJiYgZGF0ZS5pc0FmdGVyKHRoaXMucGFyc2VEYXRlKHRoaXMubWF4RGF0ZSkpO1xuXG4gICAgcmV0dXJuIGlzQmVmb3JlTWluIHx8IGlzQWZ0ZXJNYXg7XG4gIH1cblxuICBpc1RpbWVEaXNhYmxlZChtb2RlOiBtb21lbnQudW5pdE9mVGltZS5TdGFydE9mKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMubW9kZXMuaW5kZXhPZihgJHt0aGlzLnByZWNpc2lvbn1gKSA+IHRoaXMubW9kZXMuaW5kZXhPZihgJHttb2RlfWApO1xuICB9XG5cbiAgaW5wdXRDaGFuZ2VkKHZhbDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgZGF0ZSA9IHRoaXMucGFyc2VEYXRlKHZhbCk7XG4gICAgdGhpcy52YWx1ZSA9IGRhdGUuaXNWYWxpZCgpID8gZGF0ZS50b0RhdGUoKSA6IHZhbDtcbiAgfVxuXG4gIGNsb3NlKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5kaWFsb2cpIHJldHVybjtcblxuICAgIC8vIHRlYXIgZG93biB0aGUgZGlhbG9nIGluc3RhbmNlXG4gICAgdGhpcy5kaWFsb2dTZXJ2aWNlLmRlc3Ryb3kodGhpcy5kaWFsb2cpO1xuXG4gICAgY29uc3QgZGF0ZSA9IHRoaXMucGFyc2VEYXRlKHRoaXMudmFsdWUpO1xuICAgIHRoaXMudmFsaWRhdGUoZGF0ZSk7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2sgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm9uVG91Y2hlZENhbGxiYWNrID0gZm47XG4gIH1cblxuICBwcml2YXRlIHJvdW5kVG8odmFsOiBtb21lbnQuTW9tZW50LCBrZXk6IHN0cmluZyk6IG1vbWVudC5Nb21lbnQge1xuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqL1xuICAgIGlmICgha2V5IHx8ICF2YWwpIHtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuICAgIHZhbCA9IHZhbC5jbG9uZSgpO1xuXG4gICAgY29uc3QgaWR4ID0gdGhpcy5tb2Rlcy5pbmRleE9mKGtleSk7XG4gICAgaWYgKGlkeCA+IDApIHtcbiAgICAgIHRoaXMubW9kZXMuZm9yRWFjaCgobW9kZSwgaW5kZXgpID0+IHtcbiAgICAgICAgaWYgKGluZGV4IDwgaWR4KSB7XG4gICAgICAgICAgdmFsID0gdmFsW21vZGVdKG1vZGUgPT09ICdkYXRlJyA/IDEgOiAwKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiB2YWw7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlKGRhdGU6IG1vbWVudC5Nb21lbnQpIHtcbiAgICBjb25zdCBpc1ZhbGlkID0gZGF0ZS5pc1ZhbGlkKCk7XG4gICAgY29uc3Qgb3V0T2ZSYW5nZSA9IHRoaXMuZ2V0RGF5RGlzYWJsZWQoZGF0ZSk7XG5cbiAgICBsZXQgZXJyb3JNc2cgPSAnJztcbiAgICBpZiAoIWlzVmFsaWQpIGVycm9yTXNnID0gJ0ludmFsaWQgRGF0ZSc7XG4gICAgaWYgKG91dE9mUmFuZ2UpIGVycm9yTXNnID0gJ0RhdGUgb3V0IG9mIHJhbmdlJztcbiAgICB0aGlzLmVycm9yTXNnID0gZXJyb3JNc2c7XG5cbiAgICByZXR1cm4gaXNWYWxpZCAmJiAhb3V0T2ZSYW5nZTtcbiAgfVxuXG4gIHByaXZhdGUgb25Ub3VjaGVkQ2FsbGJhY2s6ICgpID0+IHZvaWQgPSAoKSA9PiB7XG4gICAgLy8gcGxhY2Vob2xkZXJcbiAgfTtcblxuICBwcml2YXRlIG9uQ2hhbmdlQ2FsbGJhY2s6IChfOiBhbnkpID0+IHZvaWQgPSAoKSA9PiB7XG4gICAgLy8gcGxhY2Vob2xkZXJcbiAgfTtcblxuICBwcml2YXRlIGdldERpc3BsYXlWYWx1ZSgpOiBzdHJpbmcge1xuICAgIC8vIG5vdGUgc2FtZSBhcyB7eyB2YWx1ZSB8IGFtVGltZVpvbmU6IHRpbWV6b25lIHwgYW1EYXRlRm9ybWF0OiBmb3JtYXQgfX1cbiAgICBpZiAoIXRoaXMudmFsdWUpIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgY29uc3QgbSA9IHRoaXMuY3JlYXRlTW9tZW50KHRoaXMudmFsdWUpO1xuICAgIHJldHVybiBtLmlzVmFsaWQoKSA/IG0uZm9ybWF0KHRoaXMuZm9ybWF0KSA6ICcnICsgU3RyaW5nKHRoaXMudmFsdWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBwYXJzZURhdGUoZGF0ZTogc3RyaW5nIHwgRGF0ZSk6IG1vbWVudC5Nb21lbnQge1xuICAgIGlmIChkYXRlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAgIGRhdGUgPSBpc05hTihkYXRlLmdldFRpbWUoKSkgPyBkYXRlLnRvU3RyaW5nKCkgOiBkYXRlLnRvSVNPU3RyaW5nKCk7XG4gICAgfVxuICAgIGNvbnN0IGlucHV0Rm9ybWF0cyA9IFsuLi50aGlzLmlucHV0Rm9ybWF0c107XG4gICAgaWYgKHRoaXMuZm9ybWF0ICYmICFpbnB1dEZvcm1hdHMuaW5jbHVkZXModGhpcy5mb3JtYXQpKSB7XG4gICAgICBpbnB1dEZvcm1hdHMudW5zaGlmdCh0aGlzLmZvcm1hdCk7XG4gICAgfVxuICAgIGxldCBtID0gdGhpcy50aW1lem9uZSA/IG1vbWVudC50eihkYXRlLCBpbnB1dEZvcm1hdHMsIHRoaXMudGltZXpvbmUpIDogbW9tZW50KGRhdGUsIGlucHV0Rm9ybWF0cyk7XG4gICAgbSA9IHRoaXMucHJlY2lzaW9uID8gdGhpcy5yb3VuZFRvKG0sIHRoaXMucHJlY2lzaW9uKSA6IG07XG4gICAgcmV0dXJuIG07XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZU1vbWVudChkYXRlOiBEYXRlbGlrZSk6IG1vbWVudC5Nb21lbnQge1xuICAgIGxldCBtID0gbW9tZW50KGRhdGUpLmNsb25lKCk7XG4gICAgbSA9IHRoaXMudGltZXpvbmUgPyBtLnR6KHRoaXMudGltZXpvbmUpIDogbTtcbiAgICBtID0gdGhpcy5wcmVjaXNpb24gPyB0aGlzLnJvdW5kVG8obSwgdGhpcy5wcmVjaXNpb24pIDogbTtcbiAgICByZXR1cm4gbTtcbiAgfVxufVxuIl19