import { __decorate, __metadata } from "tslib";
import { Component, Input, Output, EventEmitter, ViewChild, TemplateRef, ElementRef, ChangeDetectionStrategy } from '@angular/core';
import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { KeyboardKeys } from '../../enums';
let SelectInputComponent = class SelectInputComponent {
    constructor() {
        this.toggle = new EventEmitter();
        this.selection = new EventEmitter();
        this.activate = new EventEmitter();
        this.keyup = new EventEmitter();
        this.selectedOptions = [];
    }
    get autofocus() {
        return this._autofocus;
    }
    set autofocus(autofocus) {
        this._autofocus = coerceBooleanProperty(autofocus);
    }
    get allowClear() {
        return this._allowClear;
    }
    set allowClear(allowClear) {
        this._allowClear = coerceBooleanProperty(allowClear);
    }
    get multiple() {
        return this._multiple;
    }
    set multiple(multiple) {
        this._multiple = coerceBooleanProperty(multiple);
    }
    get tagging() {
        return this._tagging;
    }
    set tagging(tagging) {
        this._tagging = coerceBooleanProperty(tagging);
    }
    get allowAdditions() {
        return this._allowAdditions;
    }
    set allowAdditions(allowAdditions) {
        this._allowAdditions = coerceBooleanProperty(allowAdditions);
    }
    get disableDropdown() {
        return this._disableDropdown;
    }
    set disableDropdown(disableDropdown) {
        this._disableDropdown = coerceBooleanProperty(disableDropdown);
    }
    get selected() {
        return this._selected;
    }
    set selected(val) {
        this._selected = val;
        this.selectedOptions = this.calcSelectedOptions(val);
    }
    get caretVisible() {
        if (this.disableDropdown)
            return false;
        if (this.tagging && (!this.options || !this.options.length))
            return false;
        return true;
    }
    get isNotTemplate() {
        return !(typeof this.selectCaret === 'object' && this.selectCaret instanceof TemplateRef);
    }
    ngAfterViewInit() {
        if (this.tagging && this.autofocus) {
            setTimeout(() => {
                this.inputElement.nativeElement.focus();
            }, 5);
        }
    }
    onKeyUp(event) {
        event.stopPropagation();
        const key = event.key;
        const value = event.target.value;
        if (key === KeyboardKeys.ENTER) {
            if (value !== '') {
                const hasSelection = this.selected.find(selection => {
                    return value === selection;
                });
                if (!hasSelection) {
                    const newSelections = [...this.selected, value];
                    this.selection.emit(newSelections);
                    event.target.value = '';
                }
            }
            event.preventDefault();
        }
        else if (key === KeyboardKeys.ESCAPE) {
            this.toggle.emit();
        }
        this.keyup.emit({ event, value });
    }
    onKeyDown(event) {
        if (this.disableDropdown)
            return;
        event.stopPropagation();
        if (!this.tagging) {
            this.keyup.emit({ event });
        }
    }
    onClick(event) {
        if (this.disableDropdown)
            return;
        this.activate.emit(event);
        if (this.tagging) {
            setTimeout(() => {
                this.inputElement.nativeElement.focus();
            }, 5);
        }
    }
    onOptionRemove(event, option) {
        event.stopPropagation();
        const newSelections = this.selected.filter(selection => {
            if (this.identifier !== undefined) {
                return option.value[this.identifier] !== selection[this.identifier];
            }
            return option.value !== selection;
        });
        this.selection.emit(newSelections);
    }
    calcSelectedOptions(selected) {
        const results = [];
        // result out if nothing here
        if (!selected)
            return results;
        for (const selection of selected) {
            let match;
            if (this.options) {
                match = this.options.find(option => {
                    if (this.identifier) {
                        return selection[this.identifier] === option.value[this.identifier];
                    }
                    return selection === option.value;
                });
            }
            if ((this.tagging || this.allowAdditions) && !match) {
                match = { value: selection, name: selection };
            }
            if (match)
                results.push(match);
        }
        return results;
    }
};
__decorate([
    Input(),
    __metadata("design:type", String)
], SelectInputComponent.prototype, "placeholder", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], SelectInputComponent.prototype, "identifier", void 0);
__decorate([
    Input(),
    __metadata("design:type", Array)
], SelectInputComponent.prototype, "options", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], SelectInputComponent.prototype, "label", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], SelectInputComponent.prototype, "hint", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], SelectInputComponent.prototype, "selectCaret", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], SelectInputComponent.prototype, "requiredIndicator", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], SelectInputComponent.prototype, "autofocus", null);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], SelectInputComponent.prototype, "allowClear", null);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], SelectInputComponent.prototype, "multiple", null);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], SelectInputComponent.prototype, "tagging", null);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], SelectInputComponent.prototype, "allowAdditions", null);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], SelectInputComponent.prototype, "disableDropdown", null);
__decorate([
    Input(),
    __metadata("design:type", Array),
    __metadata("design:paramtypes", [Array])
], SelectInputComponent.prototype, "selected", null);
__decorate([
    Output(),
    __metadata("design:type", Object)
], SelectInputComponent.prototype, "toggle", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], SelectInputComponent.prototype, "selection", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], SelectInputComponent.prototype, "activate", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], SelectInputComponent.prototype, "keyup", void 0);
__decorate([
    ViewChild('tagInput'),
    __metadata("design:type", ElementRef)
], SelectInputComponent.prototype, "inputElement", void 0);
SelectInputComponent = __decorate([
    Component({
        exportAs: 'ngxSelectInput',
        selector: 'ngx-select-input',
        template: "<div tabindex=\"-1\" (keydown)=\"onKeyDown($event)\" class=\"ngx-select-input-box\" (click)=\"onClick($event)\">\n  <span *ngIf=\"label !== undefined\" class=\"ngx-select-label\">\n    <span [innerHTML]=\"label\"></span>\n    <span [innerHTML]=\"requiredIndicator\"></span>\n  </span>\n  <span\n    *ngIf=\"!selected?.length && placeholder !== undefined\"\n    class=\"ngx-select-placeholder\"\n    [innerHTML]=\"placeholder\"\n  >\n  </span>\n  <ul class=\"horizontal-list ngx-select-input-list\">\n    <li *ngFor=\"let option of selectedOptions\" class=\"ngx-select-input-option\" [class.disabled]=\"option.disabled\">\n      <ng-template\n        *ngIf=\"option.inputTemplate\"\n        [ngTemplateOutlet]=\"option.inputTemplate\"\n        [ngTemplateOutletContext]=\"{ option: option }\"\n      >\n      </ng-template>\n      <span *ngIf=\"!option.inputTemplate\" class=\"ngx-select-input-name\" [innerHTML]=\"option.name || option.value\">\n      </span>\n      <span\n        *ngIf=\"allowClear && (multiple || tagging) && !option.disabled\"\n        title=\"Remove Selection\"\n        class=\"ngx-select-clear icon-x\"\n        (click)=\"onOptionRemove($event, option)\"\n      >\n      </span>\n    </li>\n    <li *ngIf=\"tagging\" class=\"ngx-select-input-box-wrapper\">\n      <input\n        #tagInput\n        type=\"search\"\n        class=\"ng-select-text-box\"\n        tabindex=\"\"\n        autocomplete=\"off\"\n        autocorrect=\"off\"\n        spellcheck=\"off\"\n        (keyup)=\"onKeyUp($event)\"\n      />\n    </li>\n  </ul>\n</div>\n<div class=\"ngx-select-input-underline\">\n  <div class=\"underline-fill\"></div>\n</div>\n<div class=\"ngx-select-hint\">\n  <span *ngIf=\"hint !== undefined\" [innerHTML]=\"hint\"></span>\n  <ng-content select=\"ngx-input-hint\"></ng-content>\n</div>\n<span\n  *ngIf=\"allowClear && !multiple && !tagging && selectedOptions?.length\"\n  title=\"Clear Selections\"\n  class=\"ngx-select-clear icon-x\"\n  (click)=\"selection.emit([])\"\n>\n</span>\n<span\n  *ngIf=\"caretVisible\"\n  class=\"ngx-select-caret icon-arrow-down\"\n  [class.icon-arrow-down]=\"!selectCaret\"\n  (click)=\"toggle.emit()\"\n>\n  <span *ngIf=\"isNotTemplate; else tpl\" [innerHTML]=\"selectCaret\"> </span>\n  <ng-template #tpl>\n    <ng-container *ngTemplateOutlet=\"selectCaret\"></ng-container>\n  </ng-template>\n</span>\n",
        host: { class: 'ngx-select-input' },
        changeDetection: ChangeDetectionStrategy.OnPush
    })
], SelectInputComponent);
export { SelectInputComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LWlucHV0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bzd2ltbGFuZS9uZ3gtdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9zZWxlY3Qvc2VsZWN0LWlucHV0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBRVQsV0FBVyxFQUNYLFVBQVUsRUFDVix1QkFBdUIsRUFDeEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFOUQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGFBQWEsQ0FBQztBQVUzQyxJQUFhLG9CQUFvQixHQUFqQyxNQUFhLG9CQUFvQjtJQUFqQztRQWtFWSxXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUNsQyxjQUFTLEdBQUcsSUFBSSxZQUFZLEVBQVMsQ0FBQztRQUN0QyxhQUFRLEdBQUcsSUFBSSxZQUFZLEVBQVMsQ0FBQztRQUNyQyxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQTRDLENBQUM7UUFlL0Usb0JBQWUsR0FBMkIsRUFBRSxDQUFDO0lBMkcvQyxDQUFDO0lBckxDLElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN6QixDQUFDO0lBQ0QsSUFBSSxTQUFTLENBQUMsU0FBUztRQUNyQixJQUFJLENBQUMsVUFBVSxHQUFHLHFCQUFxQixDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFHRCxJQUFJLFVBQVU7UUFDWixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDMUIsQ0FBQztJQUNELElBQUksVUFBVSxDQUFDLFVBQVU7UUFDdkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxxQkFBcUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBR0QsSUFBSSxR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REFBcUI7QUFDcEI7SUFBUixLQUFLLEVBQUU7O3dEQUFvQjtBQUNuQjtJQUFSLEtBQUssRUFBRTs7cURBQWlDO0FBQ2hDO0lBQVIsS0FBSyxFQUFFOzttREFBZTtBQUNkO0lBQVIsS0FBSyxFQUFFOztrREFBYztBQUNiO0lBQVIsS0FBSyxFQUFFOzt5REFBd0M7QUFDdkM7SUFBUixLQUFLLEVBQUU7OytEQUFxQztBQUc3QztJQURDLEtBQUssRUFBRTs7O3FEQUdQO0FBTUQ7SUFEQyxLQUFLLEVBQUU7OztzREFHUDtBQU1EO0lBREMsS0FBSyxFQUFFOzs7b0RBR1A7QUFNRDtJQURDLEtBQUssRUFBRTs7O21EQUdQO0FBTUQ7SUFEQyxLQUFLLEVBQUU7OzswREFHUDtBQU1EO0lBREMsS0FBSyxFQUFFOzs7MkRBR1A7QUFNRDtJQURDLEtBQUssRUFBRTs7O29EQUdQO0FBTVM7SUFBVCxNQUFNLEVBQUU7O29EQUFtQztBQUNsQztJQUFULE1BQU0sRUFBRTs7dURBQXVDO0FBQ3RDO0lBQVQsTUFBTSxFQUFFOztzREFBc0M7QUFDckM7SUFBVCxNQUFNLEVBQUU7O21EQUFzRTtBQUcvRTtJQURDLFNBQVMsQ0FBQyxVQUFVLENBQUM7OEJBQ0UsVUFBVTswREFBbUI7QUF4RTFDLG9CQUFvQjtJQVBoQyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsZ0JBQWdCO1FBQzFCLFFBQVEsRUFBRSxrQkFBa0I7UUFDNUIsMjBFQUE0QztRQUM1QyxJQUFJLEVBQUUsRUFBRSxLQUFLLEVBQUUsa0JBQWtCLEVBQUU7UUFDbkMsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07S0FDaEQsQ0FBQztHQUNXLG9CQUFvQixDQStMaEM7U0EvTFksb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXIsXG4gIFZpZXdDaGlsZCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgVGVtcGxhdGVSZWYsXG4gIEVsZW1lbnRSZWYsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgY29lcmNlQm9vbGVhblByb3BlcnR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcblxuaW1wb3J0IHsgS2V5Ym9hcmRLZXlzIH0gZnJvbSAnLi4vLi4vZW51bXMnO1xuaW1wb3J0IHsgU2VsZWN0RHJvcGRvd25PcHRpb24gfSBmcm9tICcuL3NlbGVjdC1kcm9wZG93bi1vcHRpb24uaW50ZXJmYWNlJztcblxuQENvbXBvbmVudCh7XG4gIGV4cG9ydEFzOiAnbmd4U2VsZWN0SW5wdXQnLFxuICBzZWxlY3RvcjogJ25neC1zZWxlY3QtaW5wdXQnLFxuICB0ZW1wbGF0ZVVybDogJy4vc2VsZWN0LWlucHV0LmNvbXBvbmVudC5odG1sJyxcbiAgaG9zdDogeyBjbGFzczogJ25neC1zZWxlY3QtaW5wdXQnIH0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFNlbGVjdElucHV0Q29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XG4gIEBJbnB1dCgpIHBsYWNlaG9sZGVyOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGlkZW50aWZpZXI6IHN0cmluZztcbiAgQElucHV0KCkgb3B0aW9uczogU2VsZWN0RHJvcGRvd25PcHRpb25bXTtcbiAgQElucHV0KCkgbGFiZWw6IHN0cmluZztcbiAgQElucHV0KCkgaGludDogc3RyaW5nO1xuICBASW5wdXQoKSBzZWxlY3RDYXJldDogc3RyaW5nIHwgVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgcmVxdWlyZWRJbmRpY2F0b3I6IHN0cmluZyB8IGJvb2xlYW47XG5cbiAgQElucHV0KClcbiAgZ2V0IGF1dG9mb2N1cygpIHtcbiAgICByZXR1cm4gdGhpcy5fYXV0b2ZvY3VzO1xuICB9XG4gIHNldCBhdXRvZm9jdXMoYXV0b2ZvY3VzKSB7XG4gICAgdGhpcy5fYXV0b2ZvY3VzID0gY29lcmNlQm9vbGVhblByb3BlcnR5KGF1dG9mb2N1cyk7XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgYWxsb3dDbGVhcigpIHtcbiAgICByZXR1cm4gdGhpcy5fYWxsb3dDbGVhcjtcbiAgfVxuICBzZXQgYWxsb3dDbGVhcihhbGxvd0NsZWFyKSB7XG4gICAgdGhpcy5fYWxsb3dDbGVhciA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eShhbGxvd0NsZWFyKTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIGdldCBtdWx0aXBsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fbXVsdGlwbGU7XG4gIH1cbiAgc2V0IG11bHRpcGxlKG11bHRpcGxlKSB7XG4gICAgdGhpcy5fbXVsdGlwbGUgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkobXVsdGlwbGUpO1xuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IHRhZ2dpbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3RhZ2dpbmc7XG4gIH1cbiAgc2V0IHRhZ2dpbmcodGFnZ2luZykge1xuICAgIHRoaXMuX3RhZ2dpbmcgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodGFnZ2luZyk7XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgYWxsb3dBZGRpdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FsbG93QWRkaXRpb25zO1xuICB9XG4gIHNldCBhbGxvd0FkZGl0aW9ucyhhbGxvd0FkZGl0aW9ucykge1xuICAgIHRoaXMuX2FsbG93QWRkaXRpb25zID0gY29lcmNlQm9vbGVhblByb3BlcnR5KGFsbG93QWRkaXRpb25zKTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIGdldCBkaXNhYmxlRHJvcGRvd24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVEcm9wZG93bjtcbiAgfVxuICBzZXQgZGlzYWJsZURyb3Bkb3duKGRpc2FibGVEcm9wZG93bikge1xuICAgIHRoaXMuX2Rpc2FibGVEcm9wZG93biA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eShkaXNhYmxlRHJvcGRvd24pO1xuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IHNlbGVjdGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZDtcbiAgfVxuICBzZXQgc2VsZWN0ZWQodmFsOiBhbnlbXSkge1xuICAgIHRoaXMuX3NlbGVjdGVkID0gdmFsO1xuICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gdGhpcy5jYWxjU2VsZWN0ZWRPcHRpb25zKHZhbCk7XG4gIH1cblxuICBAT3V0cHV0KCkgdG9nZ2xlID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBAT3V0cHV0KCkgc2VsZWN0aW9uID0gbmV3IEV2ZW50RW1pdHRlcjxhbnlbXT4oKTtcbiAgQE91dHB1dCgpIGFjdGl2YXRlID0gbmV3IEV2ZW50RW1pdHRlcjxFdmVudD4oKTtcbiAgQE91dHB1dCgpIGtleXVwID0gbmV3IEV2ZW50RW1pdHRlcjx7IGV2ZW50OiBLZXlib2FyZEV2ZW50OyB2YWx1ZT86IHN0cmluZyB9PigpO1xuXG4gIEBWaWV3Q2hpbGQoJ3RhZ0lucHV0JylcbiAgcmVhZG9ubHkgaW5wdXRFbGVtZW50PzogRWxlbWVudFJlZjxIVE1MSW5wdXRFbGVtZW50PjtcblxuICBnZXQgY2FyZXRWaXNpYmxlKCk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmRpc2FibGVEcm9wZG93bikgcmV0dXJuIGZhbHNlO1xuICAgIGlmICh0aGlzLnRhZ2dpbmcgJiYgKCF0aGlzLm9wdGlvbnMgfHwgIXRoaXMub3B0aW9ucy5sZW5ndGgpKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBnZXQgaXNOb3RUZW1wbGF0ZSgpIHtcbiAgICByZXR1cm4gISh0eXBlb2YgdGhpcy5zZWxlY3RDYXJldCA9PT0gJ29iamVjdCcgJiYgdGhpcy5zZWxlY3RDYXJldCBpbnN0YW5jZW9mIFRlbXBsYXRlUmVmKTtcbiAgfVxuXG4gIHNlbGVjdGVkT3B0aW9uczogU2VsZWN0RHJvcGRvd25PcHRpb25bXSA9IFtdO1xuXG4gIHByaXZhdGUgX3NlbGVjdGVkOiBhbnlbXTtcbiAgcHJpdmF0ZSBfYXV0b2ZvY3VzOiBib29sZWFuO1xuICBwcml2YXRlIF9hbGxvd0NsZWFyOiBib29sZWFuO1xuICBwcml2YXRlIF9tdWx0aXBsZTogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfdGFnZ2luZzogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfYWxsb3dBZGRpdGlvbnM6IGJvb2xlYW47XG4gIHByaXZhdGUgX2Rpc2FibGVEcm9wZG93bjogYm9vbGVhbjtcblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMudGFnZ2luZyAmJiB0aGlzLmF1dG9mb2N1cykge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgIH0sIDUpO1xuICAgIH1cbiAgfVxuXG4gIG9uS2V5VXAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIGNvbnN0IGtleSA9IGV2ZW50LmtleTtcbiAgICBjb25zdCB2YWx1ZSA9IChldmVudC50YXJnZXQgYXMgYW55KS52YWx1ZTtcblxuICAgIGlmIChrZXkgPT09IChLZXlib2FyZEtleXMuRU5URVIgYXMgYW55KSkge1xuICAgICAgaWYgKHZhbHVlICE9PSAnJykge1xuICAgICAgICBjb25zdCBoYXNTZWxlY3Rpb24gPSB0aGlzLnNlbGVjdGVkLmZpbmQoc2VsZWN0aW9uID0+IHtcbiAgICAgICAgICByZXR1cm4gdmFsdWUgPT09IHNlbGVjdGlvbjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFoYXNTZWxlY3Rpb24pIHtcbiAgICAgICAgICBjb25zdCBuZXdTZWxlY3Rpb25zID0gWy4uLnRoaXMuc2VsZWN0ZWQsIHZhbHVlXTtcbiAgICAgICAgICB0aGlzLnNlbGVjdGlvbi5lbWl0KG5ld1NlbGVjdGlvbnMpO1xuICAgICAgICAgIChldmVudC50YXJnZXQgYXMgYW55KS52YWx1ZSA9ICcnO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSBlbHNlIGlmIChrZXkgPT09IChLZXlib2FyZEtleXMuRVNDQVBFIGFzIGFueSkpIHtcbiAgICAgIHRoaXMudG9nZ2xlLmVtaXQoKTtcbiAgICB9XG5cbiAgICB0aGlzLmtleXVwLmVtaXQoeyBldmVudCwgdmFsdWUgfSk7XG4gIH1cblxuICBvbktleURvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kaXNhYmxlRHJvcGRvd24pIHJldHVybjtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIGlmICghdGhpcy50YWdnaW5nKSB7XG4gICAgICB0aGlzLmtleXVwLmVtaXQoeyBldmVudCB9KTtcbiAgICB9XG4gIH1cblxuICBvbkNsaWNrKGV2ZW50OiBFdmVudCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmRpc2FibGVEcm9wZG93bikgcmV0dXJuO1xuICAgIHRoaXMuYWN0aXZhdGUuZW1pdChldmVudCk7XG5cbiAgICBpZiAodGhpcy50YWdnaW5nKSB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgfSwgNSk7XG4gICAgfVxuICB9XG5cbiAgb25PcHRpb25SZW1vdmUoZXZlbnQ6IEV2ZW50LCBvcHRpb246IFNlbGVjdERyb3Bkb3duT3B0aW9uKTogdm9pZCB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICBjb25zdCBuZXdTZWxlY3Rpb25zID0gdGhpcy5zZWxlY3RlZC5maWx0ZXIoc2VsZWN0aW9uID0+IHtcbiAgICAgIGlmICh0aGlzLmlkZW50aWZpZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gb3B0aW9uLnZhbHVlW3RoaXMuaWRlbnRpZmllcl0gIT09IHNlbGVjdGlvblt0aGlzLmlkZW50aWZpZXJdO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gb3B0aW9uLnZhbHVlICE9PSBzZWxlY3Rpb247XG4gICAgfSk7XG5cbiAgICB0aGlzLnNlbGVjdGlvbi5lbWl0KG5ld1NlbGVjdGlvbnMpO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjU2VsZWN0ZWRPcHRpb25zKHNlbGVjdGVkOiBhbnlbXSkge1xuICAgIGNvbnN0IHJlc3VsdHM6IFNlbGVjdERyb3Bkb3duT3B0aW9uW10gPSBbXTtcblxuICAgIC8vIHJlc3VsdCBvdXQgaWYgbm90aGluZyBoZXJlXG4gICAgaWYgKCFzZWxlY3RlZCkgcmV0dXJuIHJlc3VsdHM7XG5cbiAgICBmb3IgKGNvbnN0IHNlbGVjdGlvbiBvZiBzZWxlY3RlZCkge1xuICAgICAgbGV0IG1hdGNoOiBTZWxlY3REcm9wZG93bk9wdGlvbjtcblxuICAgICAgaWYgKHRoaXMub3B0aW9ucykge1xuICAgICAgICBtYXRjaCA9IHRoaXMub3B0aW9ucy5maW5kKG9wdGlvbiA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMuaWRlbnRpZmllcikge1xuICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGlvblt0aGlzLmlkZW50aWZpZXJdID09PSBvcHRpb24udmFsdWVbdGhpcy5pZGVudGlmaWVyXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gc2VsZWN0aW9uID09PSBvcHRpb24udmFsdWU7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoKHRoaXMudGFnZ2luZyB8fCB0aGlzLmFsbG93QWRkaXRpb25zKSAmJiAhbWF0Y2gpIHtcbiAgICAgICAgbWF0Y2ggPSB7IHZhbHVlOiBzZWxlY3Rpb24sIG5hbWU6IHNlbGVjdGlvbiB9O1xuICAgICAgfVxuXG4gICAgICBpZiAobWF0Y2gpIHJlc3VsdHMucHVzaChtYXRjaCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cbn1cbiJdfQ==