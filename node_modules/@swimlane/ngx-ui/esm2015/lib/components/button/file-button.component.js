import { __decorate, __metadata } from "tslib";
import { Component, Input, Output, EventEmitter, NgZone, ViewEncapsulation, OnInit, ContentChild, TemplateRef, ViewChild, ElementRef, ChangeDetectionStrategy } from '@angular/core';
import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { FileUploader } from '@swimlane/ng2-file-upload';
import { FileButtonStyleType } from './file-button-style.type';
let nextId = 0;
let FileButtonComponent = class FileButtonComponent {
    constructor(_ngZone) {
        this._ngZone = _ngZone;
        this.id = `input-${++nextId}`;
        this.styleType = FileButtonStyleType.standard;
        this.afterAddingFile = new EventEmitter();
        this.beforeUploadItem = new EventEmitter();
        this.successItem = new EventEmitter();
        this.errorItem = new EventEmitter();
        this.progressAll = new EventEmitter();
        this.FileButtonStyleType = FileButtonStyleType;
        this.progress = 0;
        this.fileName = '';
        this.fileOverDropzone = false;
        this._isItemSuccessful = false;
        this._disabled = false;
        this._multiple = false;
    }
    get disabled() {
        return this._disabled;
    }
    set disabled(disabled) {
        this._disabled = coerceBooleanProperty(disabled);
    }
    get multiple() {
        return this._multiple;
    }
    set multiple(multiple) {
        this._multiple = coerceBooleanProperty(multiple);
    }
    get isDisabled() {
        return this.disabled || this.uploader.isUploading;
    }
    get cssClasses() {
        return {
            'ngx-file-button': true,
            'standard-style': this.styleType === FileButtonStyleType.standard,
            'progress-style': this.styleType === FileButtonStyleType.progress,
            'show-progress': this.uploader && this.uploader.options.isHTML5,
            success: this._isItemSuccessful,
            active: this.uploader && this.uploader.isUploading
        };
    }
    ngOnInit() {
        this._ngZone.run(() => {
            if (!this.uploader && !this.options) {
                throw new Error('You must pass either an uploader instance or options.');
            }
            // if options were passed, init a new uploader
            if (!this.uploader && this.options) {
                this.uploader = new FileUploader(this.options);
            }
            // always remove after upload for this case
            this.uploader.options.removeAfterUpload = true;
            this.uploader.onAfterAddingFile = this.onAfterAddingFile.bind(this);
            this.uploader.onBeforeUploadItem = this.onBeforeUploadItem.bind(this);
            this.uploader.onProgressAll = this.onProgressAll.bind(this);
            this.uploader.onSuccessItem = this.onSuccessItem.bind(this);
            this.uploader.onErrorItem = this.onErrorItem.bind(this);
        });
    }
    onAfterAddingFile(fileItem) {
        this._ngZone.run(() => {
            this.fileName = fileItem.file.name;
            this.afterAddingFile.emit({ fileItem });
        });
    }
    onBeforeUploadItem(fileItem) {
        this._ngZone.run(() => {
            this.beforeUploadItem.emit({ fileItem });
        });
    }
    onErrorItem(response, status, headers) {
        this.errorItem.emit({ response, status, headers });
    }
    onProgressAll(progress) {
        this._ngZone.run(() => {
            this.progress = progress;
            this.progressAll.emit({ progress });
        });
    }
    onSuccessItem(item, response, status, headers) {
        this._ngZone.run(() => {
            this._isItemSuccessful = true;
            setTimeout(() => {
                this.fileName = '';
                this._isItemSuccessful = false;
            }, 2500);
            this.successItem.emit({ item, response, status, headers });
        });
    }
    fileOverBase(event) {
        this.fileOverDropzone = event;
    }
    clearInput() {
        this.fileInput.nativeElement.value = '';
    }
};
FileButtonComponent.ctorParameters = () => [
    { type: NgZone }
];
__decorate([
    Input(),
    __metadata("design:type", String)
], FileButtonComponent.prototype, "id", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], FileButtonComponent.prototype, "name", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], FileButtonComponent.prototype, "styleType", void 0);
__decorate([
    Input(),
    __metadata("design:type", FileUploader)
], FileButtonComponent.prototype, "uploader", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], FileButtonComponent.prototype, "options", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], FileButtonComponent.prototype, "disabled", null);
__decorate([
    Input(),
    __metadata("design:type", Object),
    __metadata("design:paramtypes", [Object])
], FileButtonComponent.prototype, "multiple", null);
__decorate([
    Output(),
    __metadata("design:type", Object)
], FileButtonComponent.prototype, "afterAddingFile", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], FileButtonComponent.prototype, "beforeUploadItem", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], FileButtonComponent.prototype, "successItem", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], FileButtonComponent.prototype, "errorItem", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], FileButtonComponent.prototype, "progressAll", void 0);
__decorate([
    ContentChild('dropzoneTemplate'),
    __metadata("design:type", TemplateRef)
], FileButtonComponent.prototype, "dropzoneTemplate", void 0);
__decorate([
    ViewChild('fileInput'),
    __metadata("design:type", ElementRef)
], FileButtonComponent.prototype, "fileInput", void 0);
FileButtonComponent = __decorate([
    Component({
        exportAs: 'ngxFileButton',
        selector: 'ngx-file-button',
        template: "<div\n  *ngIf=\"dropzoneTemplate\"\n  ng2FileDrop\n  [class.file-over]=\"fileOverDropzone\"\n  [uploader]=\"uploader\"\n  (fileOver)=\"fileOverBase($event)\"\n>\n  <ng-template ng2FileDrop [ngTemplateOutlet]=\"dropzoneTemplate\" [ngTemplateOutletContext]=\"{ $implicit: uploader }\">\n  </ng-template>\n</div>\n\n<div *ngIf=\"!dropzoneTemplate\" [ngClass]=\"cssClasses\">\n  <div class=\"ngx-file-button-button\">\n    <input\n      #fileInput\n      ng2FileSelect\n      type=\"file\"\n      class=\"ngx-file-button-input\"\n      [disabled]=\"isDisabled\"\n      [multiple]=\"multiple\"\n      [id]=\"id + '-input'\"\n      [name]=\"name + '-input'\"\n      [uploader]=\"uploader\"\n    />\n    <label\n      [class.disabled]=\"isDisabled\"\n      [class.btn]=\"styleType === FileButtonStyleType.standard\"\n      [attr.for]=\"id + '-input'\"\n      class=\"ngx-file-button-label\"\n    >\n      <ng-content></ng-content>\n    </label>\n    <span class=\"ngx-file-button-text\" *ngIf=\"fileName\">\n      {{ fileName }}\n    </span>\n  </div>\n  <div class=\"ngx-file-button-fill\" [style.width.%]=\"progress\"></div>\n  <span class=\"icon-check\"></span>\n</div>\n",
        encapsulation: ViewEncapsulation.None,
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: ["button{box-sizing:border-box;color:inherit;cursor:pointer;display:inline-block;position:relative;text-align:center;text-decoration:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;font:inherit;background:0 0;border:none;text-shadow:1px 1px rgba(0,0,0,.07)}button:active,button:focus{outline:0}.btn{box-sizing:border-box;color:#fff;display:inline-block;padding:.35em .55em;position:relative;text-align:center;text-decoration:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;font:inherit;font-size:.9em;font-weight:700;outline:0;line-height:1em;background:#455066;border:1px solid transparent;border-radius:2px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);-webkit-transition:background-color .2s,box-shadow .2s;transition:background-color .2s,box-shadow .2s}.btn .icon,.btn .ngx-icon{font-weight:400;vertical-align:middle;line-height:1em;font-size:.9em}.btn .icon:before,.btn .ngx-icon:before{font-weight:inherit}.btn .icon.has-text,.btn .icon.has-text-right,.btn .ngx-icon.has-text,.btn .ngx-icon.has-text-right{margin-right:.2em}.btn .icon.has-text-left,.btn .ngx-icon.has-text-left{margin-left:.2em}.btn::-moz-focus-inner{border:0;padding:0}.btn:focus{outline:0;box-shadow:0 1px 8px 0 rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 3px 3px -2px rgba(0,0,0,.12)}.btn:active:hover:focus:not(.disabled),.btn:active:hover:focus:not([disabled]){cursor:pointer;background:#313847}.btn:active:hover:focus:not(.disabled).btn-primary,.btn:active:hover:focus:not([disabled]).btn-primary{background-color:#1483ff}.btn:active:hover:focus:not(.disabled).btn-warning,.btn:active:hover:focus:not([disabled]).btn-warning{background-color:#ffa814}.btn:active:hover:focus:not(.disabled).btn-danger,.btn:active:hover:focus:not([disabled]).btn-danger{background-color:#ff4514}.btn:active:hover:focus:not(.disabled).btn-link,.btn:active:hover:focus:not([disabled]).btn-link{background-color:transparent}.btn:active:hover:focus:not(.disabled).btn-bordered,.btn:active:hover:focus:not([disabled]).btn-bordered{border-color:#94c6ff;color:#94c6ff}.btn:active,.btn:focus,.btn:hover{text-decoration:none}.btn.small{font-size:.6em}.btn.large{font-size:1.3em}.btn.btn-primary{background-color:#479eff}.btn.btn-primary.btn-primary-gradient{background:linear-gradient(125.43deg,#54cdfc 10.86%,#479eff 49.11%)}.btn.btn-warning{background-color:#ffbb47;color:#07080b}.btn.btn-danger{background-color:#ff6d47}.btn.btn-link{background-color:transparent;box-shadow:none}.btn.btn-bordered,.btn.btn-primary.btn-bordered{border:1px solid #479eff;color:#479eff;background-color:transparent;box-shadow:none}.btn.btn-bordered.disabled-button,.btn.btn-primary.btn-bordered.disabled-button{opacity:.5}.btn.btn-bordered.disabled-button .button,.btn.btn-primary.btn-bordered.disabled-button .button{opacity:1}.btn.btn-default.btn-bordered{border:1px solid #fff;color:#fff;background-color:transparent;box-shadow:none}.btn.btn-default.btn-bordered:hover{border-color:#1483ff!important;color:#1483ff!important}.btn.btn-default.btn-bordered.disabled-button{opacity:.5}.btn.btn-default.btn-bordered.disabled-button .button{opacity:1}.btn.btn-file{cursor:pointer;padding:0}.btn.btn-file label{display:block;cursor:pointer;padding:.35em .75em}.btn.btn-file[disabled] label{cursor:not-allowed}.btn.btn-file input[type=file]{pointer-events:none;position:absolute;left:-9999px}.ngx-file-button{display:inline-block;box-sizing:border-box;position:relative}.ngx-file-button .ngx-file-button-input{position:absolute;left:-9999px}.ngx-file-button .ngx-file-button-label{cursor:pointer}.ngx-file-button.standard-style .icon-check{display:none}.ngx-file-button.standard-style .ngx-file-button-text{font-size:.9rem;margin-left:8px;color:#696969}.ngx-file-button.progress-style{min-width:150px;text-align:center;-webkit-transition:.3s .3s;transition:.3s .3s;max-height:50px;overflow:hidden}.ngx-file-button.progress-style .ngx-file-button-button{width:100%;background:#455066;border:none;border-radius:50px;padding:5px 0;-webkit-transition:.3s;transition:.3s;position:relative;margin:0}.ngx-file-button.progress-style .ngx-file-button-button:focus:not(.disabled),.ngx-file-button.progress-style .ngx-file-button-button:focus:not([disabled]),.ngx-file-button.progress-style .ngx-file-button-button:hover:not(.disabled),.ngx-file-button.progress-style .ngx-file-button-button:hover:not([disabled]){background:#313847}.ngx-file-button.progress-style .ngx-file-button-button .ngx-file-button-label{color:#cfcfcf;font-size:18px;font-weight:400;line-height:40px;max-height:40px;-webkit-transition:.3s;transition:.3s;cursor:pointer;display:block}.ngx-file-button.progress-style .ngx-file-button-button.disabled .ngx-file-button-label,.ngx-file-button.progress-style .ngx-file-button-button[disabled] .ngx-file-button-label{cursor:not-allowed}.ngx-file-button.progress-style .ngx-file-button-button .ngx-file-button-text{display:none}.ngx-file-button.progress-style .ngx-file-button-fill{position:absolute;top:0;left:0;bottom:0;right:0;width:0%;background:#479eff;border-radius:50px;display:none}.ngx-file-button.progress-style .icon-check{font-size:25px;color:#cfcfcf;position:absolute;top:0;left:0;right:0;bottom:0;line-height:50px;-webkit-transform:scale(0);transform:scale(0)}.ngx-file-button.progress-style.active{padding:0}.ngx-file-button.progress-style.active .ngx-file-button-button{background:#696969;margin-top:25px}.ngx-file-button.progress-style.active .ngx-file-button-fill{display:block;margin-top:25px;-webkit-transition:.1s .1s;transition:.1s .1s}.ngx-file-button.progress-style.active .ngx-file-button-label{display:none}.ngx-file-button.progress-style.success .ngx-file-button-button{margin:0;padding:25px;width:50px;background:#479eff}.ngx-file-button.progress-style.success .ngx-file-button-fill,.ngx-file-button.progress-style.success .ngx-file-button-label{display:none}.ngx-file-button.progress-style.success .icon-check{-webkit-transform:scale(1);transform:scale(1);-webkit-transition:.3s .3s;transition:.3s .3s}"]
    }),
    __metadata("design:paramtypes", [NgZone])
], FileButtonComponent);
export { FileButtonComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1idXR0b24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHN3aW1sYW5lL25neC11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2J1dHRvbi9maWxlLWJ1dHRvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBQ1osTUFBTSxFQUNOLGlCQUFpQixFQUNqQixNQUFNLEVBQ04sWUFBWSxFQUNaLFdBQVcsRUFDWCxTQUFTLEVBQ1QsVUFBVSxFQUNWLHVCQUF1QixFQUN4QixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM5RCxPQUFPLEVBQXVCLFlBQVksRUFBWSxNQUFNLDJCQUEyQixDQUFDO0FBRXhGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRS9ELElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQztBQVVmLElBQWEsbUJBQW1CLEdBQWhDLE1BQWEsbUJBQW1CO0lBMkQ5QixZQUE2QixPQUFlO1FBQWYsWUFBTyxHQUFQLE9BQU8sQ0FBUTtRQTFEbkMsT0FBRSxHQUFXLFNBQVMsRUFBRSxNQUFNLEVBQUUsQ0FBQztRQUVqQyxjQUFTLEdBQUcsbUJBQW1CLENBQUMsUUFBUSxDQUFDO1FBb0J4QyxvQkFBZSxHQUFHLElBQUksWUFBWSxFQUEwQixDQUFDO1FBQzdELHFCQUFnQixHQUFHLElBQUksWUFBWSxFQUEwQixDQUFDO1FBQzlELGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQWlFLENBQUM7UUFDaEcsY0FBUyxHQUFHLElBQUksWUFBWSxFQUFzRCxDQUFDO1FBQ25GLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQXdCLENBQUM7UUF1QnhELHdCQUFtQixHQUFHLG1CQUFtQixDQUFDO1FBQ25ELGFBQVEsR0FBVyxDQUFDLENBQUM7UUFD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U0EvSFksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXIsXG4gIE5nWm9uZSxcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG4gIE9uSW5pdCxcbiAgQ29udGVudENoaWxkLFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkLFxuICBFbGVtZW50UmVmLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneVxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XG5pbXBvcnQgeyBGaWxlVXBsb2FkZXJPcHRpb25zLCBGaWxlVXBsb2FkZXIsIEZpbGVJdGVtIH0gZnJvbSAnQHN3aW1sYW5lL25nMi1maWxlLXVwbG9hZCc7XG5cbmltcG9ydCB7IEZpbGVCdXR0b25TdHlsZVR5cGUgfSBmcm9tICcuL2ZpbGUtYnV0dG9uLXN0eWxlLnR5cGUnO1xuXG5sZXQgbmV4dElkID0gMDtcblxuQENvbXBvbmVudCh7XG4gIGV4cG9ydEFzOiAnbmd4RmlsZUJ1dHRvbicsXG4gIHNlbGVjdG9yOiAnbmd4LWZpbGUtYnV0dG9uJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2ZpbGUtYnV0dG9uLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZmlsZS1idXR0b24uY29tcG9uZW50LnNjc3MnXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgRmlsZUJ1dHRvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgpIGlkOiBzdHJpbmcgPSBgaW5wdXQtJHsrK25leHRJZH1gO1xuICBASW5wdXQoKSBuYW1lOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHN0eWxlVHlwZSA9IEZpbGVCdXR0b25TdHlsZVR5cGUuc3RhbmRhcmQ7XG4gIEBJbnB1dCgpIHVwbG9hZGVyOiBGaWxlVXBsb2FkZXI7XG4gIEBJbnB1dCgpIG9wdGlvbnM6IEZpbGVVcGxvYWRlck9wdGlvbnM7XG5cbiAgQElucHV0KClcbiAgZ2V0IGRpc2FibGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9kaXNhYmxlZDtcbiAgfVxuICBzZXQgZGlzYWJsZWQoZGlzYWJsZWQpIHtcbiAgICB0aGlzLl9kaXNhYmxlZCA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eShkaXNhYmxlZCk7XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgbXVsdGlwbGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX211bHRpcGxlO1xuICB9XG4gIHNldCBtdWx0aXBsZShtdWx0aXBsZSkge1xuICAgIHRoaXMuX211bHRpcGxlID0gY29lcmNlQm9vbGVhblByb3BlcnR5KG11bHRpcGxlKTtcbiAgfVxuXG4gIEBPdXRwdXQoKSBhZnRlckFkZGluZ0ZpbGUgPSBuZXcgRXZlbnRFbWl0dGVyPHsgZmlsZUl0ZW06IEZpbGVJdGVtIH0+KCk7XG4gIEBPdXRwdXQoKSBiZWZvcmVVcGxvYWRJdGVtID0gbmV3IEV2ZW50RW1pdHRlcjx7IGZpbGVJdGVtOiBGaWxlSXRlbSB9PigpO1xuICBAT3V0cHV0KCkgc3VjY2Vzc0l0ZW0gPSBuZXcgRXZlbnRFbWl0dGVyPHsgaXRlbTogYW55OyByZXNwb25zZTogc3RyaW5nOyBzdGF0dXM6IG51bWJlcjsgaGVhZGVyczogYW55IH0+KCk7XG4gIEBPdXRwdXQoKSBlcnJvckl0ZW0gPSBuZXcgRXZlbnRFbWl0dGVyPHsgcmVzcG9uc2U6IHN0cmluZzsgc3RhdHVzOiBudW1iZXI7IGhlYWRlcnM6IGFueSB9PigpO1xuICBAT3V0cHV0KCkgcHJvZ3Jlc3NBbGwgPSBuZXcgRXZlbnRFbWl0dGVyPHsgcHJvZ3Jlc3M6IG51bWJlciB9PigpO1xuXG4gIEBDb250ZW50Q2hpbGQoJ2Ryb3B6b25lVGVtcGxhdGUnKVxuICByZWFkb25seSBkcm9wem9uZVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIEBWaWV3Q2hpbGQoJ2ZpbGVJbnB1dCcpXG4gIHJlYWRvbmx5IGZpbGVJbnB1dD86IEVsZW1lbnRSZWY8SFRNTElucHV0RWxlbWVudD47XG5cbiAgZ2V0IGlzRGlzYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQgfHwgdGhpcy51cGxvYWRlci5pc1VwbG9hZGluZztcbiAgfVxuXG4gIGdldCBjc3NDbGFzc2VzKCk6IGFueSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICduZ3gtZmlsZS1idXR0b24nOiB0cnVlLFxuICAgICAgJ3N0YW5kYXJkLXN0eWxlJzogdGhpcy5zdHlsZVR5cGUgPT09IEZpbGVCdXR0b25TdHlsZVR5cGUuc3RhbmRhcmQsXG4gICAgICAncHJvZ3Jlc3Mtc3R5bGUnOiB0aGlzLnN0eWxlVHlwZSA9PT0gRmlsZUJ1dHRvblN0eWxlVHlwZS5wcm9ncmVzcyxcbiAgICAgICdzaG93LXByb2dyZXNzJzogdGhpcy51cGxvYWRlciAmJiB0aGlzLnVwbG9hZGVyLm9wdGlvbnMuaXNIVE1MNSxcbiAgICAgIHN1Y2Nlc3M6IHRoaXMuX2lzSXRlbVN1Y2Nlc3NmdWwsXG4gICAgICBhY3RpdmU6IHRoaXMudXBsb2FkZXIgJiYgdGhpcy51cGxvYWRlci5pc1VwbG9hZGluZ1xuICAgIH07XG4gIH1cblxuICByZWFkb25seSBGaWxlQnV0dG9uU3R5bGVUeXBlID0gRmlsZUJ1dHRvblN0eWxlVHlwZTtcbiAgcHJvZ3Jlc3M6IG51bWJlciA9IDA7XG4gIGZpbGVOYW1lOiBzdHJpbmcgPSAnJztcbiAgZmlsZU92ZXJEcm9wem9uZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHByaXZhdGUgX2lzSXRlbVN1Y2Nlc3NmdWw6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfZGlzYWJsZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfbXVsdGlwbGU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IF9uZ1pvbmU6IE5nWm9uZSkge31cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLl9uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgIGlmICghdGhpcy51cGxvYWRlciAmJiAhdGhpcy5vcHRpb25zKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IG11c3QgcGFzcyBlaXRoZXIgYW4gdXBsb2FkZXIgaW5zdGFuY2Ugb3Igb3B0aW9ucy4nKTtcbiAgICAgIH1cblxuICAgICAgLy8gaWYgb3B0aW9ucyB3ZXJlIHBhc3NlZCwgaW5pdCBhIG5ldyB1cGxvYWRlclxuICAgICAgaWYgKCF0aGlzLnVwbG9hZGVyICYmIHRoaXMub3B0aW9ucykge1xuICAgICAgICB0aGlzLnVwbG9hZGVyID0gbmV3IEZpbGVVcGxvYWRlcih0aGlzLm9wdGlvbnMpO1xuICAgICAgfVxuXG4gICAgICAvLyBhbHdheXMgcmVtb3ZlIGFmdGVyIHVwbG9hZCBmb3IgdGhpcyBjYXNlXG4gICAgICB0aGlzLnVwbG9hZGVyLm9wdGlvbnMucmVtb3ZlQWZ0ZXJVcGxvYWQgPSB0cnVlO1xuXG4gICAgICB0aGlzLnVwbG9hZGVyLm9uQWZ0ZXJBZGRpbmdGaWxlID0gdGhpcy5vbkFmdGVyQWRkaW5nRmlsZS5iaW5kKHRoaXMpO1xuICAgICAgdGhpcy51cGxvYWRlci5vbkJlZm9yZVVwbG9hZEl0ZW0gPSB0aGlzLm9uQmVmb3JlVXBsb2FkSXRlbS5iaW5kKHRoaXMpO1xuICAgICAgdGhpcy51cGxvYWRlci5vblByb2dyZXNzQWxsID0gdGhpcy5vblByb2dyZXNzQWxsLmJpbmQodGhpcyk7XG4gICAgICB0aGlzLnVwbG9hZGVyLm9uU3VjY2Vzc0l0ZW0gPSB0aGlzLm9uU3VjY2Vzc0l0ZW0uYmluZCh0aGlzKTtcbiAgICAgIHRoaXMudXBsb2FkZXIub25FcnJvckl0ZW0gPSB0aGlzLm9uRXJyb3JJdGVtLmJpbmQodGhpcyk7XG4gICAgfSk7XG4gIH1cblxuICBvbkFmdGVyQWRkaW5nRmlsZShmaWxlSXRlbTogRmlsZUl0ZW0pOiB2b2lkIHtcbiAgICB0aGlzLl9uZ1pvbmUucnVuKCgpID0+IHtcbiAgICAgIHRoaXMuZmlsZU5hbWUgPSBmaWxlSXRlbS5maWxlLm5hbWU7XG4gICAgICB0aGlzLmFmdGVyQWRkaW5nRmlsZS5lbWl0KHsgZmlsZUl0ZW0gfSk7XG4gICAgfSk7XG4gIH1cblxuICBvbkJlZm9yZVVwbG9hZEl0ZW0oZmlsZUl0ZW06IEZpbGVJdGVtKSB7XG4gICAgdGhpcy5fbmdab25lLnJ1bigoKSA9PiB7XG4gICAgICB0aGlzLmJlZm9yZVVwbG9hZEl0ZW0uZW1pdCh7IGZpbGVJdGVtIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgb25FcnJvckl0ZW0ocmVzcG9uc2U6IHN0cmluZywgc3RhdHVzOiBudW1iZXIsIGhlYWRlcnM6IGFueSk6IHZvaWQge1xuICAgIHRoaXMuZXJyb3JJdGVtLmVtaXQoeyByZXNwb25zZSwgc3RhdHVzLCBoZWFkZXJzIH0pO1xuICB9XG5cbiAgb25Qcm9ncmVzc0FsbChwcm9ncmVzczogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5fbmdab25lLnJ1bigoKSA9PiB7XG4gICAgICB0aGlzLnByb2dyZXNzID0gcHJvZ3Jlc3M7XG4gICAgICB0aGlzLnByb2dyZXNzQWxsLmVtaXQoeyBwcm9ncmVzcyB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIG9uU3VjY2Vzc0l0ZW0oaXRlbTogYW55LCByZXNwb25zZTogc3RyaW5nLCBzdGF0dXM6IG51bWJlciwgaGVhZGVyczogYW55KTogdm9pZCB7XG4gICAgdGhpcy5fbmdab25lLnJ1bigoKSA9PiB7XG4gICAgICB0aGlzLl9pc0l0ZW1TdWNjZXNzZnVsID0gdHJ1ZTtcblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuZmlsZU5hbWUgPSAnJztcbiAgICAgICAgdGhpcy5faXNJdGVtU3VjY2Vzc2Z1bCA9IGZhbHNlO1xuICAgICAgfSwgMjUwMCk7XG5cbiAgICAgIHRoaXMuc3VjY2Vzc0l0ZW0uZW1pdCh7IGl0ZW0sIHJlc3BvbnNlLCBzdGF0dXMsIGhlYWRlcnMgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmaWxlT3ZlckJhc2UoZXZlbnQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmZpbGVPdmVyRHJvcHpvbmUgPSBldmVudDtcbiAgfVxuXG4gIGNsZWFySW5wdXQoKSB7XG4gICAgdGhpcy5maWxlSW5wdXQubmF0aXZlRWxlbWVudC52YWx1ZSA9ICcnO1xuICB9XG59XG4iXX0=