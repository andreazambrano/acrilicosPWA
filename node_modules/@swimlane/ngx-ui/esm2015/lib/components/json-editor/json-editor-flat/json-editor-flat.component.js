import { __decorate, __metadata } from "tslib";
import { Component, ContentChildren, QueryList, Input, ViewEncapsulation, ChangeDetectionStrategy, ViewChild, TemplateRef } from '@angular/core';
import { JsonEditorNodeFlatComponent } from './json-editor-node-flat/json-editor-node-flat.component';
import { SchemaValidatorService } from '../schema-validator.service';
import { JsonEditor } from '../json-editor';
import { jsonSchemaDataFormats } from '../json-editor.helper';
import { DialogService } from '../../dialog/dialog.service';
let JsonEditorFlatComponent = class JsonEditorFlatComponent extends JsonEditor {
    constructor(dialogService, schemaValidatorService) {
        super(schemaValidatorService);
        this.dialogService = dialogService;
        this.schemaValidatorService = schemaValidatorService;
        this.schemaBuilderMode = false;
        this.formats = [];
        this.compressed = false;
        this.hideRoot = false;
        this.customFormats = [];
    }
    ngOnInit() {
        this.schemaRef = JSON.parse(JSON.stringify(this.schema));
        if (this.formats.length && this.schemaBuilderMode) {
            this.buildCustomFormats();
        }
    }
    onPropertyConfig() {
        this.dialogService.create({
            template: this.propertyConfigTmpl,
            context: {
                property: this.schema,
                schema: this.schema,
                formats: this.customFormats
            },
            class: 'property-config-dialog'
        });
    }
    updateSchema(options) {
        const editedSchema = options.newProperty;
        if (editedSchema.title) {
            this.schema.title = editedSchema.title;
            this.schemaRef.title = editedSchema.title;
        }
        else {
            delete this.schema.title;
            delete this.schemaRef.title;
        }
        if (editedSchema.description) {
            this.schema.description = editedSchema.description;
            this.schemaRef.description = editedSchema.description;
        }
        else {
            delete this.schema.description;
            delete this.schemaRef.description;
        }
        this.schema = Object.assign({}, this.schema);
        this.schemaRef = Object.assign({}, this.schemaRef);
        this.schemaChange.emit(this.schemaRef);
    }
    buildCustomFormats() {
        this.formats.forEach(format => {
            const found = jsonSchemaDataFormats.find((dataFormat) => {
                return dataFormat.schema.format === format;
            });
            if (found) {
                this.customFormats.push(found);
            }
            else {
                this.customFormats.push({
                    name: format.charAt(0).toUpperCase() + format.slice(1),
                    defaultValue: () => '',
                    schema: {
                        type: 'string',
                        format
                    },
                    icon: 'field-text',
                    matchType: () => {
                        return false;
                    }
                });
            }
        });
    }
};
JsonEditorFlatComponent.ctorParameters = () => [
    { type: DialogService },
    { type: SchemaValidatorService }
];
__decorate([
    Input(),
    __metadata("design:type", Object)
], JsonEditorFlatComponent.prototype, "model", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], JsonEditorFlatComponent.prototype, "schema", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], JsonEditorFlatComponent.prototype, "typeCheckOverrides", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], JsonEditorFlatComponent.prototype, "schemaBuilderMode", void 0);
__decorate([
    Input(),
    __metadata("design:type", Array)
], JsonEditorFlatComponent.prototype, "formats", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], JsonEditorFlatComponent.prototype, "compressed", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], JsonEditorFlatComponent.prototype, "hideRoot", void 0);
__decorate([
    ContentChildren(JsonEditorNodeFlatComponent),
    __metadata("design:type", QueryList)
], JsonEditorFlatComponent.prototype, "nodeElms", void 0);
__decorate([
    ViewChild('propertyConfigTmpl'),
    __metadata("design:type", TemplateRef)
], JsonEditorFlatComponent.prototype, "propertyConfigTmpl", void 0);
JsonEditorFlatComponent = __decorate([
    Component({
        selector: 'ngx-json-editor-flat',
        template: "<div class=\"ngx-json-editor-flat\">\n  <ngx-json-editor-node-flat\n    [(model)]=\"model\"\n    [schema]=\"schema\"\n    [hideRoot]=\"hideRoot\"\n    [schemaRef]=\"schemaRef\"\n    (modelChange)=\"modelChangedCallback($event)\"\n    [errors]=\"errors\"\n    [typeCheckOverrides]=\"typeCheckOverrides\"\n    [label]=\"label\"\n    [compressed]=\"compressed\"\n    [formats]=\"customFormats\"\n    [schemaBuilderMode]=\"schemaBuilderMode\"\n    (schemaChange)=\"schemaChange.emit($event)\"\n  >\n    <div class=\"node-options\" node-options>\n      <button *ngIf=\"schemaBuilderMode\" type=\"button\" class=\"node-options-btn\" (click)=\"onPropertyConfig()\">\n        <i class=\"ngx-icon ngx-cog\"></i>\n      </button>\n    </div>\n  </ngx-json-editor-node-flat>\n</div>\n\n<!-- Property Config Dialog -->\n<ng-template #propertyConfigTmpl let-context=\"context\">\n  <ngx-property-config\n    [property]=\"context.property\"\n    [schema]=\"context.schema\"\n    [formats]=\"context.formats\"\n    [rootItem]=\"true\"\n    (updateSchema)=\"updateSchema($event)\"\n  >\n  </ngx-property-config>\n</ng-template>\n",
        changeDetection: ChangeDetectionStrategy.OnPush,
        encapsulation: ViewEncapsulation.None,
        styles: [".ngx-json-editor-flat{position:relative}.ngx-json-editor-flat .node-options .node-options-btn{color:#72819f;padding:1px 3px 2px}.ngx-json-editor-flat .node-options .ngx-dropdown{margin-left:10px}.property-config-dialog .ngx-dialog-content{padding:0!important;min-width:500px!important}"]
    }),
    __metadata("design:paramtypes", [DialogService, SchemaValidatorService])
], JsonEditorFlatComponent);
export { JsonEditorFlatComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianNvbi1lZGl0b3ItZmxhdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ac3dpbWxhbmUvbmd4LXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvanNvbi1lZGl0b3IvanNvbi1lZGl0b3ItZmxhdC9qc29uLWVkaXRvci1mbGF0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxlQUFlLEVBQ2YsU0FBUyxFQUNULEtBQUssRUFDTCxpQkFBaUIsRUFDakIsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxXQUFXLEVBQ1osTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0seURBQXlELENBQUM7QUFDdEcsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDckUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBd0MscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNwRyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFhNUQsSUFBYSx1QkFBdUIsR0FBcEMsTUFBYSx1QkFBd0IsU0FBUSxVQUFVO0lBdUJyRCxZQUFvQixhQUE0QixFQUFZLHNCQUE4QztRQUN4RyxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQURaLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQVksMkJBQXNCLEdBQXRCLHNCQUFzQixDQUF3QjtRQWhCakcsc0JBQWlCLEdBQWEsS0FBSyxDQUFDO1FBRXBDLFlBQU8sR0FBYyxFQUFFLENBQUM7UUFFeEIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUVuQixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBUTFCLGtCQUFhLEdBQXlCLEVBQUUsQ0FBQztJQUl6QyxDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBRXpELElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFO1lBQ2pELElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1NBQzNCO0lBQ0gsQ0FBQztJQUVELGdCQUFnQjtRQUNkLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDO1lBQ3hCLFFBQVEsRUFBRSxJQUFJLENBQUMsa0JBQWtCO1lBQ2pDLE9BQU8sRUFBRTtnQkFDUCxRQUFRLEVBQUUsSUFBSSxDQUFDLE1BQU07Z0JBQ3JCLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTTtnQkFDbkIsT0FBTyxFQUFFLElBQUksQ0FBQyxhQUFhO2FBQzVCO1lBQ0QsS0FBSyxFQUFFLHdCQUF3QjtTQUNoQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsWUFBWSxDQUFDLE9BQThCO1FBQ3pDLE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUM7UUFFekMsSUFBSSxZQUFZLENBQUMsS0FBSyxFQUFFO1lBQ3RCLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUM7WUFDdkMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQztTQUMzQzthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztZQUN6QixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDO1NBQzdCO1FBRUQsSUFBSSxZQUFZLENBQUMsV0FBVyxFQUFFO1lBQzVCLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxHQUFHLFlBQVksQ0FBQyxXQUFXLENBQUM7WUFDbkQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLEdBQUcsWUFBWSxDQUFDLFdBQVcsQ0FBQztTQUN2RDthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQztZQUMvQixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDO1NBQ25DO1FBRUQsSUFBSSxDQUFDLE1BQU0scUJBQVEsSUFBSSxDQUFDLE1BQU0sQ0FBRSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxTQUFTLHFCQUFRLElBQUksQ0FBQyxTQUFTLENBQUUsQ0FBQztRQUV2QyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUVPLGtCQUFrQjtRQUN4QixJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUM1QixNQUFNLEtBQUssR0FBRyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUE4QixFQUFFLEVBQUU7Z0JBQzFFLE9BQU8sVUFBVSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEtBQUssTUFBTSxDQUFDO1lBQzdDLENBQUMsQ0FBQyxDQUFDO1lBRUgsSUFBSSxLQUFLLEVBQUU7Z0JBQ1QsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDaEM7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUM7b0JBQ3RCLElBQUksRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO29CQUN0RCxZQUFZLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRTtvQkFDdEIsTUFBTSxFQUFFO3dCQUNOLElBQUksRUFBRSxRQUFRO3dCQUNkLE1BQU07cUJBQ1A7b0JBQ0QsSUFBSSxFQUFFLFlBQVk7b0JBQ2xCLFNBQVMsRUFBRSxHQUFZLEVBQUU7d0JBQ3ZCLE9BQU8sS0FBSyxDQUFDO29CQUNmLENBQUM7aUJBQ0YsQ0FBQyxDQUFDO2FBQ0o7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FDRixDQUFBOztZQXpFb0MsYUFBYTtZQUFvQyxzQkFBc0I7O0FBdEJqRztJQUFSLEtBQUssRUFBRTs7c0RBQVk7QUFFWDtJQUFSLEtBQUssRUFBRTs7dURBQTBCO0FBRXpCO0lBQVIsS0FBSyxFQUFFOzttRUFBMEI7QUFFekI7SUFBUixLQUFLLEVBQUU7O2tFQUFxQztBQUVwQztJQUFSLEtBQUssRUFBRTs7d0RBQXlCO0FBRXhCO0lBQVIsS0FBSyxFQUFFOzsyREFBb0I7QUFFbkI7SUFBUixLQUFLLEVBQUU7O3lEQUFrQjtBQUVvQjtJQUE3QyxlQUFlLENBQUMsMkJBQTJCLENBQUM7OEJBQVcsU0FBUzt5REFBOEI7QUFFOUQ7SUFBaEMsU0FBUyxDQUFDLG9CQUFvQixDQUFDOzhCQUFxQixXQUFXO21FQUEwQjtBQWpCL0UsdUJBQXVCO0lBUG5DLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxzQkFBc0I7UUFDaEMscW1DQUFnRDtRQUVoRCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtRQUMvQyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTs7S0FDdEMsQ0FBQztxQ0F3Qm1DLGFBQWEsRUFBb0Msc0JBQXNCO0dBdkIvRix1QkFBdUIsQ0FnR25DO1NBaEdZLHVCQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBRdWVyeUxpc3QsXG4gIElucHV0LFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIFZpZXdDaGlsZCxcbiAgVGVtcGxhdGVSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBKc29uRWRpdG9yTm9kZUZsYXRDb21wb25lbnQgfSBmcm9tICcuL2pzb24tZWRpdG9yLW5vZGUtZmxhdC9qc29uLWVkaXRvci1ub2RlLWZsYXQuY29tcG9uZW50JztcbmltcG9ydCB7IFNjaGVtYVZhbGlkYXRvclNlcnZpY2UgfSBmcm9tICcuLi9zY2hlbWEtdmFsaWRhdG9yLnNlcnZpY2UnO1xuaW1wb3J0IHsgSnNvbkVkaXRvciB9IGZyb20gJy4uL2pzb24tZWRpdG9yJztcbmltcG9ydCB7IEpTT05FZGl0b3JTY2hlbWEsIEpzb25TY2hlbWFEYXRhVHlwZSwganNvblNjaGVtYURhdGFGb3JtYXRzIH0gZnJvbSAnLi4vanNvbi1lZGl0b3IuaGVscGVyJztcbmltcG9ydCB7IERpYWxvZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9kaWFsb2cvZGlhbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgUHJvcGVydHlDb25maWdDb21wb25lbnQsXG4gIFByb3BlcnR5Q29uZmlnT3B0aW9uc1xufSBmcm9tICcuL2pzb24tZWRpdG9yLW5vZGUtZmxhdC9ub2RlLXR5cGVzL3Byb3BlcnR5LWNvbmZpZy9wcm9wZXJ0eS1jb25maWcuY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LWpzb24tZWRpdG9yLWZsYXQnLFxuICB0ZW1wbGF0ZVVybDogJy4vanNvbi1lZGl0b3ItZmxhdC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2pzb24tZWRpdG9yLWZsYXQuY29tcG9uZW50LnNjc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgSnNvbkVkaXRvckZsYXRDb21wb25lbnQgZXh0ZW5kcyBKc29uRWRpdG9yIHtcbiAgQElucHV0KCkgbW9kZWw6IGFueTtcblxuICBASW5wdXQoKSBzY2hlbWE6IEpTT05FZGl0b3JTY2hlbWE7XG5cbiAgQElucHV0KCkgdHlwZUNoZWNrT3ZlcnJpZGVzPzogYW55O1xuXG4gIEBJbnB1dCgpIHNjaGVtYUJ1aWxkZXJNb2RlPzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpIGZvcm1hdHM/OiBzdHJpbmdbXSA9IFtdO1xuXG4gIEBJbnB1dCgpIGNvbXByZXNzZWQgPSBmYWxzZTtcblxuICBASW5wdXQoKSBoaWRlUm9vdCA9IGZhbHNlO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oSnNvbkVkaXRvck5vZGVGbGF0Q29tcG9uZW50KSBub2RlRWxtczogUXVlcnlMaXN0PEpzb25FZGl0b3JOb2RlRmxhdENvbXBvbmVudD47XG5cbiAgQFZpZXdDaGlsZCgncHJvcGVydHlDb25maWdUbXBsJykgcHJvcGVydHlDb25maWdUbXBsOiBUZW1wbGF0ZVJlZjxQcm9wZXJ0eUNvbmZpZ0NvbXBvbmVudD47XG5cbiAgc2NoZW1hUmVmOiBKU09ORWRpdG9yU2NoZW1hO1xuXG4gIGN1c3RvbUZvcm1hdHM6IEpzb25TY2hlbWFEYXRhVHlwZVtdID0gW107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBkaWFsb2dTZXJ2aWNlOiBEaWFsb2dTZXJ2aWNlLCBwcm90ZWN0ZWQgc2NoZW1hVmFsaWRhdG9yU2VydmljZTogU2NoZW1hVmFsaWRhdG9yU2VydmljZSkge1xuICAgIHN1cGVyKHNjaGVtYVZhbGlkYXRvclNlcnZpY2UpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5zY2hlbWFSZWYgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuc2NoZW1hKSk7XG5cbiAgICBpZiAodGhpcy5mb3JtYXRzLmxlbmd0aCAmJiB0aGlzLnNjaGVtYUJ1aWxkZXJNb2RlKSB7XG4gICAgICB0aGlzLmJ1aWxkQ3VzdG9tRm9ybWF0cygpO1xuICAgIH1cbiAgfVxuXG4gIG9uUHJvcGVydHlDb25maWcoKTogdm9pZCB7XG4gICAgdGhpcy5kaWFsb2dTZXJ2aWNlLmNyZWF0ZSh7XG4gICAgICB0ZW1wbGF0ZTogdGhpcy5wcm9wZXJ0eUNvbmZpZ1RtcGwsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIHByb3BlcnR5OiB0aGlzLnNjaGVtYSxcbiAgICAgICAgc2NoZW1hOiB0aGlzLnNjaGVtYSxcbiAgICAgICAgZm9ybWF0czogdGhpcy5jdXN0b21Gb3JtYXRzXG4gICAgICB9LFxuICAgICAgY2xhc3M6ICdwcm9wZXJ0eS1jb25maWctZGlhbG9nJ1xuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlU2NoZW1hKG9wdGlvbnM6IFByb3BlcnR5Q29uZmlnT3B0aW9ucyk6IHZvaWQge1xuICAgIGNvbnN0IGVkaXRlZFNjaGVtYSA9IG9wdGlvbnMubmV3UHJvcGVydHk7XG5cbiAgICBpZiAoZWRpdGVkU2NoZW1hLnRpdGxlKSB7XG4gICAgICB0aGlzLnNjaGVtYS50aXRsZSA9IGVkaXRlZFNjaGVtYS50aXRsZTtcbiAgICAgIHRoaXMuc2NoZW1hUmVmLnRpdGxlID0gZWRpdGVkU2NoZW1hLnRpdGxlO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZWxldGUgdGhpcy5zY2hlbWEudGl0bGU7XG4gICAgICBkZWxldGUgdGhpcy5zY2hlbWFSZWYudGl0bGU7XG4gICAgfVxuXG4gICAgaWYgKGVkaXRlZFNjaGVtYS5kZXNjcmlwdGlvbikge1xuICAgICAgdGhpcy5zY2hlbWEuZGVzY3JpcHRpb24gPSBlZGl0ZWRTY2hlbWEuZGVzY3JpcHRpb247XG4gICAgICB0aGlzLnNjaGVtYVJlZi5kZXNjcmlwdGlvbiA9IGVkaXRlZFNjaGVtYS5kZXNjcmlwdGlvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgZGVsZXRlIHRoaXMuc2NoZW1hLmRlc2NyaXB0aW9uO1xuICAgICAgZGVsZXRlIHRoaXMuc2NoZW1hUmVmLmRlc2NyaXB0aW9uO1xuICAgIH1cblxuICAgIHRoaXMuc2NoZW1hID0geyAuLi50aGlzLnNjaGVtYSB9O1xuICAgIHRoaXMuc2NoZW1hUmVmID0geyAuLi50aGlzLnNjaGVtYVJlZiB9O1xuXG4gICAgdGhpcy5zY2hlbWFDaGFuZ2UuZW1pdCh0aGlzLnNjaGVtYVJlZik7XG4gIH1cblxuICBwcml2YXRlIGJ1aWxkQ3VzdG9tRm9ybWF0cygpOiB2b2lkIHtcbiAgICB0aGlzLmZvcm1hdHMuZm9yRWFjaChmb3JtYXQgPT4ge1xuICAgICAgY29uc3QgZm91bmQgPSBqc29uU2NoZW1hRGF0YUZvcm1hdHMuZmluZCgoZGF0YUZvcm1hdDogSnNvblNjaGVtYURhdGFUeXBlKSA9PiB7XG4gICAgICAgIHJldHVybiBkYXRhRm9ybWF0LnNjaGVtYS5mb3JtYXQgPT09IGZvcm1hdDtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgdGhpcy5jdXN0b21Gb3JtYXRzLnB1c2goZm91bmQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jdXN0b21Gb3JtYXRzLnB1c2goe1xuICAgICAgICAgIG5hbWU6IGZvcm1hdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGZvcm1hdC5zbGljZSgxKSxcbiAgICAgICAgICBkZWZhdWx0VmFsdWU6ICgpID0+ICcnLFxuICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICBmb3JtYXRcbiAgICAgICAgICB9LFxuICAgICAgICAgIGljb246ICdmaWVsZC10ZXh0JyxcbiAgICAgICAgICBtYXRjaFR5cGU6ICgpOiBib29sZWFuID0+IHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iXX0=