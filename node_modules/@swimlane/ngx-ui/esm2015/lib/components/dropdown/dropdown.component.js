import { __decorate, __metadata } from "tslib";
import { Component, Input, ContentChild, OnDestroy, AfterContentInit, Renderer2, ViewEncapsulation, ChangeDetectorRef, ChangeDetectionStrategy, HostListener } from '@angular/core';
import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { DropdownMenuDirective } from './dropdown-menu.directive';
import { DropdownToggleDirective } from './dropdown-toggle.directive';
let DropdownComponent = class DropdownComponent {
    constructor(renderer, cd) {
        this.renderer = renderer;
        this.cd = cd;
        this._open = false;
        this._showCaret = false;
        this._closeOnClick = true;
        this._closeOnOutsideClick = true;
        this._closeOnMouseLeave = false;
        this._leaveTimeout = null;
    }
    get open() {
        return this._open;
    }
    set open(open) {
        this._open = coerceBooleanProperty(open);
    }
    get showCaret() {
        return this._showCaret;
    }
    set showCaret(showCaret) {
        this._showCaret = coerceBooleanProperty(showCaret);
    }
    get closeOnClick() {
        return this._closeOnClick;
    }
    set closeOnClick(closeOnClick) {
        this._closeOnClick = coerceBooleanProperty(closeOnClick);
    }
    get closeOnOutsideClick() {
        return this._closeOnOutsideClick;
    }
    set closeOnOutsideClick(closeOnOutsideClick) {
        this._closeOnOutsideClick = coerceBooleanProperty(closeOnOutsideClick);
    }
    get closeOnMouseLeave() {
        return this._closeOnMouseLeave;
    }
    set closeOnMouseLeave(val) {
        this._closeOnMouseLeave = coerceBooleanProperty(val);
    }
    ngAfterContentInit() {
        if (this.dropdownToggle) {
            this.dropdownToggle.toggle.subscribe((ev) => this.onToggleClick(ev));
        }
    }
    ngOnDestroy() {
        if (this._documentListener)
            this._documentListener();
    }
    onDocumentClick(e) {
        if (this.open && this.closeOnOutsideClick) {
            const isToggling = this.dropdownToggle.element.contains(e.target);
            const isMenuClick = !this.closeOnClick && this.dropdownMenu.element.contains(e.target);
            if (!isToggling && !isMenuClick) {
                this.close();
            }
        }
    }
    onToggleClick(_) {
        this.open = !this.open;
        if (this.open) {
            this._documentListener = this.renderer.listen(document, 'click', this.onDocumentClick.bind(this));
        }
        else {
            this._documentListener();
        }
    }
    onMouseLeave() {
        if (this.closeOnMouseLeave) {
            this._leaveTimeout = setTimeout(() => {
                this.close();
            }, 1000);
        }
    }
    onMouseEnter() {
        if (this._leaveTimeout) {
            clearTimeout(this._leaveTimeout);
        }
    }
    close() {
        this.open = false;
        if (this._documentListener)
            this._documentListener();
        this.cd.markForCheck();
    }
};
DropdownComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ChangeDetectorRef }
];
__decorate([
    Input(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], DropdownComponent.prototype, "open", null);
__decorate([
    Input(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], DropdownComponent.prototype, "showCaret", null);
__decorate([
    Input(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], DropdownComponent.prototype, "closeOnClick", null);
__decorate([
    Input(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], DropdownComponent.prototype, "closeOnOutsideClick", null);
__decorate([
    Input(),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], DropdownComponent.prototype, "closeOnMouseLeave", null);
__decorate([
    ContentChild(DropdownToggleDirective),
    __metadata("design:type", DropdownToggleDirective)
], DropdownComponent.prototype, "dropdownToggle", void 0);
__decorate([
    ContentChild(DropdownMenuDirective),
    __metadata("design:type", DropdownMenuDirective)
], DropdownComponent.prototype, "dropdownMenu", void 0);
__decorate([
    HostListener('mouseleave'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], DropdownComponent.prototype, "onMouseLeave", null);
__decorate([
    HostListener('mouseenter'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], DropdownComponent.prototype, "onMouseEnter", null);
DropdownComponent = __decorate([
    Component({
        exportAs: 'ngxDropdown',
        selector: 'ngx-dropdown',
        template: `
    <ng-content></ng-content>
  `,
        host: {
            class: 'ngx-dropdown',
            '[class.open]': 'open',
            '[class.has-caret]': 'showCaret'
        },
        encapsulation: ViewEncapsulation.None,
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: [".ngx-dropdown{position:relative;padding-bottom:10px}.ngx-dropdown.open .ngx-dropdown-menu{display:block;opacity:1;-webkit-animation:.25s openAnimation;animation:.25s openAnimation}.ngx-dropdown.has-caret .ngx-dropdown-menu:before{display:block}.ngx-dropdown .ngx-dropdown-toggle{cursor:pointer;display:inline-block}.ngx-dropdown .ngx-dropdown-toggle.disabled,.ngx-dropdown .ngx-dropdown-toggle.disabled>a,.ngx-dropdown .ngx-dropdown-toggle.disabled>button{cursor:not-allowed}.ngx-dropdown .ngx-dropdown-menu{position:absolute;clear:left;top:100%;left:0;z-index:1000;min-width:180px;background:#313847;box-shadow:0 1px 8px 0 rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 3px 3px -2px rgba(0,0,0,.12);margin-top:0;opacity:0;display:none;-webkit-transition:visibility,opacity .25s ease-out;transition:visibility,opacity .25s ease-out}.ngx-dropdown .ngx-dropdown-menu::before{z-index:-1;content:' ';display:none;position:absolute;left:10px;top:-6px;width:12px;height:12px;background:#313847;-webkit-transform:rotate(45deg);transform:rotate(45deg);border-bottom:0;border-right:0}.ngx-dropdown .ngx-dropdown-menu.align-right{left:auto;right:0}.ngx-dropdown .ngx-dropdown-menu.align-right::before{left:auto;right:6px}.ngx-dropdown .ngx-dropdown-menu>ul>li>a,.ngx-dropdown .ngx-dropdown-menu>ul>li>button{padding:5px 20px;clear:both;line-height:1.42857143;white-space:nowrap;width:100%;text-align:left;background:0 0;box-shadow:none;color:#cfcfcf;font-size:.9em;display:block}.ngx-dropdown .ngx-dropdown-menu>ul>li:hover{background:#262c38}@-webkit-keyframes openAnimation{0%{-webkit-transform:translateY(-25px);transform:translateY(-25px)}100%{-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes openAnimation{0%{-webkit-transform:translateY(-25px);transform:translateY(-25px)}100%{-webkit-transform:translateY(0);transform:translateY(0)}}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-light-outline{background:#262c38;min-width:130px;font-size:13px;border:1px solid #505c75}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-light-outline:before{border-top:1px solid #505c75;border-left:1px solid #505c75;background:#262c38;z-index:10;top:-7px;-webkit-transform:translate(-1.8px,0) rotate(45deg);transform:translate(-1.8px,0) rotate(45deg)}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-light-outline>ul{padding:9.5px 0;margin:2px 0 0;list-style:none}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-light-outline>ul>li{padding-top:0!important;color:#fff}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-light-outline>ul>li>a,.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-light-outline>ul>li>button{cursor:pointer;height:26px;display:block;clear:both;font-weight:400;line-height:1.42857;white-space:nowrap;font-size:13px;color:#fff}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-light-outline>ul>li:hover{background:#1f242f}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-light-outline>ul>li.active{background:#479eff;color:#fff}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-light-outline>ul>li.active>a,.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-light-outline>ul>li.active>button{color:#fff}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-light-outline>ul>li.divider-label{height:initial;margin:8px 0;padding:0 20px;overflow:hidden;background-color:initial;color:#72819f}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-dark-outline{background:#222732;min-width:130px;font-size:13px;border:1px solid #505c75}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-dark-outline:before{border-top:1px solid #505c75;border-left:1px solid #505c75;background:#222732;z-index:10;top:-7px;-webkit-transform:translate(-1.8px,0) rotate(45deg);transform:translate(-1.8px,0) rotate(45deg)}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-dark-outline>ul{padding:9.5px 0;margin:2px 0 0;list-style:none}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-dark-outline>ul>li{padding-top:0!important;color:#afb7c8}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-dark-outline>ul>li>a,.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-dark-outline>ul>li>button{cursor:pointer;height:26px;display:block;clear:both;font-weight:400;line-height:1.42857;white-space:nowrap;font-size:13px;color:#afb7c8}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-dark-outline>ul>li:hover{background:#262c38}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-dark-outline>ul>li.active{background:#479eff;color:#afb7c8}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-dark-outline>ul>li.active>a,.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-dark-outline>ul>li.active>button{color:#fff}.ngx-dropdown .ngx-dropdown-menu.ngx-dropdown-dark-outline>ul>li.divider-label{height:initial;margin:8px 0;padding:0 20px;overflow:hidden;background-color:initial;color:#72819f}"]
    }),
    __metadata("design:paramtypes", [Renderer2, ChangeDetectorRef])
], DropdownComponent);
export { DropdownComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHN3aW1sYW5lL25neC11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2Ryb3Bkb3duL2Ryb3Bkb3duLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsWUFBWSxFQUNaLFNBQVMsRUFDVCxnQkFBZ0IsRUFDaEIsU0FBUyxFQUNULGlCQUFpQixFQUNqQixpQkFBaUIsRUFDakIsdUJBQXVCLEVBQ3ZCLFlBQVksRUFDYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUU5RCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQWlCdEUsSUFBYSxpQkFBaUIsR0FBOUIsTUFBYSxpQkFBaUI7SUFvRDVCLFlBQTZCLFFBQW1CLEVBQW1CLEVBQXFCO1FBQTNELGFBQVEsR0FBUixRQUFRLENBQVc7UUFBbUIsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFQaEYsVUFBSyxHQUFZLEtBQUssQ0FBQztRQUN2QixlQUFVLEdBQVksS0FBSyxDQUFDO1FBQzVCLGtCQUFhLEdBQVksSUFBSSxDQUFDO1FBQzlCLHlCQUFvQixHQUFZLElBQUksQ0FBQztRQUNyQyx1QkFBa0IsR0FBWSxLQUFLLENBQUM7UUFDcEMsa0JBQWEsR0FBRyxJQUFJLENBQUM7SUFFOEQsQ0FBQztJQWxENUYsSUFBSSxJQUFJO1FBQ04sT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3BCLENBQUM7SUFDRCxJQUFJLElBQUksQ0FBQyxJQUFhO1FBQ3BCLElBQUksQ0FBQyxLQUFLLEdBQUcscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUdELElBQUksU0FBUztR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QixJQUFJLElBQUksQ0FBQyxpQkFBaUI7WUFBRSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUNyRCxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3pCLENBQUM7Q0FDRixDQUFBOztZQXREd0MsU0FBUztZQUF1QixpQkFBaUI7O0FBbER4RjtJQURDLEtBQUssRUFBRTs7OzZDQUdQO0FBTUQ7SUFEQyxLQUFLLEVBQUU7OztrREFHUDtBQU1EO0lBREMsS0FBSyxFQUFFOzs7cURBR1A7QUFNRDtJQURDLEtBQUssRUFBRTs7OzREQUdQO0FBTUQ7SUFEQyxLQUFLLEVBQUU7OzswREFHUDtBQUtzQztJQUF0QyxZQUFZLENBQUMsdUJBQXVCLENBQUM7OEJBQTBCLHVCQUF1Qjt5REFBQztBQUNuRDtJQUFwQyxZQUFZLENBQUMscUJBQXFCLENBQUM7OEJBQXdCLHFCQUFxQjt1REFBQztBQTRDbEY7SUFEQyxZQUFZLENBQUMsWUFBWSxDQUFDOzs7O3FEQU8xQjtBQUdEO0lBREMsWUFBWSxDQUFDLFlBQVksQ0FBQzs7OztxREFLMUI7QUFuR1UsaUJBQWlCO0lBZjdCLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxhQUFhO1FBQ3ZCLFFBQVEsRUFBRSxjQUFjO1FBQ3hCLFFBQVEsRUFBRTs7R0FFVDtRQUVELElBQUksRUFBRTtZQUNKLEtBQUssRUFBRSxjQUFjO1lBQ3JCLGNBQWMsRUFBRSxNQUFNO1lBQ3RCLG1CQUFtQixFQUFFLFdBQVc7U0FDakM7UUFDRCxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtRQUNyQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7S0FDaEQsQ0FBQztxQ0FxRHVDLFNBQVMsRUFBdUIsaUJBQWlCO0dBcEQ3RSxpQkFBaUIsQ0EwRzdCO1NBMUdZLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIENvbnRlbnRDaGlsZCxcbiAgT25EZXN0cm95LFxuICBBZnRlckNvbnRlbnRJbml0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIEhvc3RMaXN0ZW5lclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XG5cbmltcG9ydCB7IERyb3Bkb3duTWVudURpcmVjdGl2ZSB9IGZyb20gJy4vZHJvcGRvd24tbWVudS5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgRHJvcGRvd25Ub2dnbGVEaXJlY3RpdmUgfSBmcm9tICcuL2Ryb3Bkb3duLXRvZ2dsZS5kaXJlY3RpdmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgZXhwb3J0QXM6ICduZ3hEcm9wZG93bicsXG4gIHNlbGVjdG9yOiAnbmd4LWRyb3Bkb3duJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gIGAsXG4gIHN0eWxlVXJsczogWycuL2Ryb3Bkb3duLmNvbXBvbmVudC5zY3NzJ10sXG4gIGhvc3Q6IHtcbiAgICBjbGFzczogJ25neC1kcm9wZG93bicsXG4gICAgJ1tjbGFzcy5vcGVuXSc6ICdvcGVuJyxcbiAgICAnW2NsYXNzLmhhcy1jYXJldF0nOiAnc2hvd0NhcmV0J1xuICB9LFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBEcm9wZG93bkNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgpXG4gIGdldCBvcGVuKCkge1xuICAgIHJldHVybiB0aGlzLl9vcGVuO1xuICB9XG4gIHNldCBvcGVuKG9wZW46IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9vcGVuID0gY29lcmNlQm9vbGVhblByb3BlcnR5KG9wZW4pO1xuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IHNob3dDYXJldCgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2hvd0NhcmV0O1xuICB9XG4gIHNldCBzaG93Q2FyZXQoc2hvd0NhcmV0OiBib29sZWFuKSB7XG4gICAgdGhpcy5fc2hvd0NhcmV0ID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHNob3dDYXJldCk7XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgY2xvc2VPbkNsaWNrKCkge1xuICAgIHJldHVybiB0aGlzLl9jbG9zZU9uQ2xpY2s7XG4gIH1cbiAgc2V0IGNsb3NlT25DbGljayhjbG9zZU9uQ2xpY2s6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9jbG9zZU9uQ2xpY2sgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkoY2xvc2VPbkNsaWNrKTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIGdldCBjbG9zZU9uT3V0c2lkZUNsaWNrKCkge1xuICAgIHJldHVybiB0aGlzLl9jbG9zZU9uT3V0c2lkZUNsaWNrO1xuICB9XG4gIHNldCBjbG9zZU9uT3V0c2lkZUNsaWNrKGNsb3NlT25PdXRzaWRlQ2xpY2s6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9jbG9zZU9uT3V0c2lkZUNsaWNrID0gY29lcmNlQm9vbGVhblByb3BlcnR5KGNsb3NlT25PdXRzaWRlQ2xpY2spO1xuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IGNsb3NlT25Nb3VzZUxlYXZlKCkge1xuICAgIHJldHVybiB0aGlzLl9jbG9zZU9uTW91c2VMZWF2ZTtcbiAgfVxuICBzZXQgY2xvc2VPbk1vdXNlTGVhdmUodmFsOiBib29sZWFuKSB7XG4gICAgdGhpcy5fY2xvc2VPbk1vdXNlTGVhdmUgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkodmFsKTtcbiAgfVxuXG4gIEBDb250ZW50Q2hpbGQoRHJvcGRvd25Ub2dnbGVEaXJlY3RpdmUpIHJlYWRvbmx5IGRyb3Bkb3duVG9nZ2xlOiBEcm9wZG93blRvZ2dsZURpcmVjdGl2ZTtcbiAgQENvbnRlbnRDaGlsZChEcm9wZG93bk1lbnVEaXJlY3RpdmUpIHJlYWRvbmx5IGRyb3Bkb3duTWVudTogRHJvcGRvd25NZW51RGlyZWN0aXZlO1xuXG4gIHByaXZhdGUgX2RvY3VtZW50TGlzdGVuZXI/OiAoKSA9PiB2b2lkO1xuICBwcml2YXRlIF9vcGVuOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgX3Nob3dDYXJldDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9jbG9zZU9uQ2xpY2s6IGJvb2xlYW4gPSB0cnVlO1xuICBwcml2YXRlIF9jbG9zZU9uT3V0c2lkZUNsaWNrOiBib29sZWFuID0gdHJ1ZTtcbiAgcHJpdmF0ZSBfY2xvc2VPbk1vdXNlTGVhdmU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfbGVhdmVUaW1lb3V0ID0gbnVsbDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHJlbmRlcmVyOiBSZW5kZXJlcjIsIHByaXZhdGUgcmVhZG9ubHkgY2Q6IENoYW5nZURldGVjdG9yUmVmKSB7fVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kcm9wZG93blRvZ2dsZSkge1xuICAgICAgdGhpcy5kcm9wZG93blRvZ2dsZS50b2dnbGUuc3Vic2NyaWJlKChldjogRXZlbnQpID0+IHRoaXMub25Ub2dnbGVDbGljayhldikpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9kb2N1bWVudExpc3RlbmVyKSB0aGlzLl9kb2N1bWVudExpc3RlbmVyKCk7XG4gIH1cblxuICBvbkRvY3VtZW50Q2xpY2soZTogRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5vcGVuICYmIHRoaXMuY2xvc2VPbk91dHNpZGVDbGljaykge1xuICAgICAgY29uc3QgaXNUb2dnbGluZyA9IHRoaXMuZHJvcGRvd25Ub2dnbGUuZWxlbWVudC5jb250YWlucyhlLnRhcmdldCBhcyBOb2RlKTtcbiAgICAgIGNvbnN0IGlzTWVudUNsaWNrID0gIXRoaXMuY2xvc2VPbkNsaWNrICYmIHRoaXMuZHJvcGRvd25NZW51LmVsZW1lbnQuY29udGFpbnMoZS50YXJnZXQgYXMgTm9kZSk7XG5cbiAgICAgIGlmICghaXNUb2dnbGluZyAmJiAhaXNNZW51Q2xpY2spIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG9uVG9nZ2xlQ2xpY2soXzogRXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLm9wZW4gPSAhdGhpcy5vcGVuO1xuXG4gICAgaWYgKHRoaXMub3Blbikge1xuICAgICAgdGhpcy5fZG9jdW1lbnRMaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKGRvY3VtZW50LCAnY2xpY2snLCB0aGlzLm9uRG9jdW1lbnRDbGljay5iaW5kKHRoaXMpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZG9jdW1lbnRMaXN0ZW5lcigpO1xuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlbGVhdmUnKVxuICBvbk1vdXNlTGVhdmUoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY2xvc2VPbk1vdXNlTGVhdmUpIHtcbiAgICAgIHRoaXMuX2xlYXZlVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9LCAxMDAwKTtcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdtb3VzZWVudGVyJylcbiAgb25Nb3VzZUVudGVyKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9sZWF2ZVRpbWVvdXQpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9sZWF2ZVRpbWVvdXQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2xvc2UoKSB7XG4gICAgdGhpcy5vcGVuID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuX2RvY3VtZW50TGlzdGVuZXIpIHRoaXMuX2RvY3VtZW50TGlzdGVuZXIoKTtcbiAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xuICB9XG59XG4iXX0=