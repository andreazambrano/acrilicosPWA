import { __decorate, __metadata } from "tslib";
import { Component, Input, Output, EventEmitter, forwardRef, OnInit, ViewEncapsulation, ChangeDetectionStrategy, ChangeDetectorRef, AfterViewInit } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import moment from 'moment-timezone';
import { getMonth, getDecadeStartYear } from './utils';
import { CalendarView } from './calendar-view.enum';
const CALENDAR_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => CalendarComponent),
    multi: true
};
let CalendarComponent = class CalendarComponent {
    constructor(cdr) {
        this.cdr = cdr;
        this.daysOfWeek = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
        this.inputFormats = ['L', `LT`, 'L LT', moment.ISO_8601];
        this.change = new EventEmitter();
        this.monthsList = moment.monthsShort();
        this.onTouchedCallback = () => {
            // placeholder
        };
        this.onChangeCallback = () => {
            // placeholder
        };
    }
    get minView() {
        return this._minView ? this._minView : CalendarView.Date;
    }
    set minView(val) {
        this._minView = val;
        this.validateView();
    }
    get defaultView() {
        return this._defaultView ? this._defaultView : this.minView;
    }
    set defaultView(val) {
        this._defaultView = val;
        this.validateView();
    }
    get value() {
        return this._value;
    }
    set value(val) {
        const date = this.createMoment(val);
        if (date.isValid()) {
            if (!date.isSame(this._value, 'day')) {
                this._value = val;
                this.onChangeCallback(this._value);
            }
            this.change.emit(this._value);
        }
    }
    get current() {
        return this._current;
    }
    ngOnInit() {
        this.activeDate = this.createMoment(this.value);
        this.weeks = getMonth(this.activeDate);
        this.monthsList = moment.monthsShort();
        this._current = this.activeDate;
        this.startYear = getDecadeStartYear(this._current.year());
        this.validateView();
    }
    ngAfterViewInit() {
        this.cdr.markForCheck();
    }
    changeViews() {
        if (this.currentView === CalendarView.Date) {
            this.currentView = CalendarView.Month;
        }
        else if (this.currentView === CalendarView.Month) {
            this.currentView = CalendarView.Year;
        }
        else {
            this.currentView = this.minView;
        }
        this.weeks = getMonth(this.activeDate);
    }
    validateView() {
        const viewsList = [CalendarView.Date, CalendarView.Month, CalendarView.Year];
        // date time picker precision validation
        if (!viewsList.includes(this.minView)) {
            this.minView = CalendarView.Date;
        }
        // defaultView cannot be below minView
        if (viewsList.indexOf(this.minView) > viewsList.indexOf(this.defaultView)) {
            this.defaultView = this.minView;
        }
        this.currentView = this.defaultView;
    }
    /**
     * Checks if `date` matches selected value
     */
    isDayActive(date) {
        return date.isSame(this.value, 'day');
    }
    /**
     * Checks if `month` matches selected value, in the viewed year
     */
    isMonthActive(month) {
        const date = this.createMoment(this.value).month(month);
        return date.isSame(this.value, 'month') && date.isSame(this.activeDate, 'year');
    }
    /**
     * Checks if `month` and year matches current
     */
    isCurrentMonth(month) {
        const date = this.activeDate.clone().month(month);
        return date.isSame(this._current, 'month') && date.isSame(this._current, 'year');
    }
    /**
     * Checks if `year` matches selected year
     */
    isYearActive(year) {
        const date = this.createMoment(this.value).year(year);
        return date.isSame(this.value, 'year');
    }
    /**
     * Checks if year matches current year
     */
    isCurrentYear(year) {
        const date = this.createMoment(this.value).year(year);
        return date.isSame(this._current, 'year');
    }
    isDisabled(value, type) {
        if (this.disabled)
            return true;
        if (!value)
            return false;
        let date;
        switch (type) {
            case 'day':
                date = value;
                break;
            case 'month':
                date = this.activeDate.clone().month(value);
                break;
            case 'year':
                date = this.activeDate.clone().year(value);
                break;
            default:
                return false;
        }
        const isBeforeMin = this.minDate && date.isBefore(this.parseDate(this.minDate), type);
        const isAfterMax = this.maxDate && date.isAfter(this.parseDate(this.maxDate), type);
        return isBeforeMin || isAfterMax;
    }
    onDayClick(day) {
        this.activeDate = day.date.clone();
        this.value = this.activeDate.toDate();
        if (day.prevMonth || day.nextMonth) {
            this.weeks = getMonth(this.activeDate);
        }
    }
    onMonthClick(month) {
        this.activeDate.month(month);
        this.value = this.activeDate.toDate();
        if (this.minView !== CalendarView.Month) {
            this.currentView = CalendarView.Date;
            this.weeks = getMonth(this.activeDate);
        }
    }
    onYearClick(year) {
        this.activeDate.year(year);
        this.value = this.activeDate.toDate();
        if (this.minView !== CalendarView.Year) {
            this.currentView = CalendarView.Month;
            this.weeks = getMonth(this.activeDate);
        }
    }
    prevMonth() {
        const date = this.activeDate.clone();
        this.activeDate = date.subtract(1, 'month');
        this.weeks = getMonth(this.activeDate);
    }
    nextMonth() {
        const date = this.activeDate.clone();
        this.activeDate = date.add(1, 'month');
        this.weeks = getMonth(this.activeDate);
    }
    prevYear() {
        const date = this.activeDate.clone();
        this.activeDate = date.subtract(1, 'year');
    }
    nextYear() {
        const date = this.activeDate.clone();
        this.activeDate = date.add(1, 'year');
    }
    prevTwoDecades() {
        this.startYear = this.startYear - 20;
    }
    nextTwoDecades() {
        this.startYear = this.startYear + 20;
    }
    writeValue(val) {
        const activeDate = this.createMoment(val);
        if (activeDate.isValid() && !activeDate.isSame(this.value, 'day')) {
            this.activeDate = activeDate;
            this.weeks = getMonth(this.activeDate);
            this._value = val;
            this.startYear = getDecadeStartYear(this.activeDate.year());
        }
        this.cdr.markForCheck();
    }
    registerOnChange(fn) {
        this.onChangeCallback = fn;
    }
    registerOnTouched(fn) {
        this.onTouchedCallback = fn;
    }
    parseDate(date) {
        date = date instanceof Date ? date.toISOString() : date;
        return this.timezone ? moment.tz(date, this.inputFormats, this.timezone) : moment(date, this.inputFormats);
    }
    createMoment(date) {
        const m = moment(date).clone();
        return this.timezone ? m.tz(this.timezone) : m;
    }
};
CalendarComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
__decorate([
    Input(),
    __metadata("design:type", Object)
], CalendarComponent.prototype, "minDate", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], CalendarComponent.prototype, "disabled", void 0);
__decorate([
    Input(),
    __metadata("design:type", Object)
], CalendarComponent.prototype, "maxDate", void 0);
__decorate([
    Input(),
    __metadata("design:type", Array)
], CalendarComponent.prototype, "daysOfWeek", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], CalendarComponent.prototype, "timezone", void 0);
__decorate([
    Input(),
    __metadata("design:type", Array)
], CalendarComponent.prototype, "inputFormats", void 0);
__decorate([
    Input('minView'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [String])
], CalendarComponent.prototype, "minView", null);
__decorate([
    Input('defaultView'),
    __metadata("design:type", String),
    __metadata("design:paramtypes", [String])
], CalendarComponent.prototype, "defaultView", null);
__decorate([
    Output(),
    __metadata("design:type", Object)
], CalendarComponent.prototype, "change", void 0);
CalendarComponent = __decorate([
    Component({
        selector: 'ngx-calendar',
        exportAs: 'ngxCalendar',
        template: "<div class=\"ngx-calendar-wrap\">\n  <div fxFlex=\"100%\" class=\"text-center\" [ngSwitch]=\"currentView\">\n    <div *ngSwitchCase=\"'date'\">\n      <div class=\"title-row\" fxLayout=\"row\" fxLayoutWrap=\"nowrap\" fxLayoutAlign=\"center center\">\n        <button type=\"button\" class=\"prev-month\" [disabled]=\"disabled\" title=\"Previous Month\" (click)=\"prevMonth()\">\n          <span class=\"icon-arrow-left\"></span>\n        </button>\n        <span class=\"title\" (click)=\"changeViews()\">\n          {{ activeDate | amTimeZone: timezone | amDateFormat: 'MMMM YYYY' }}\n        </span>\n        <button type=\"button\" class=\"next-month\" title=\"Next Month\" [disabled]=\"disabled\" (click)=\"nextMonth()\">\n          <span class=\"icon-arrow-right\"></span>\n        </button>\n      </div>\n      <div class=\"day-name-row\">\n        <div fxLayout=\"row\" fxLayoutWrap=\"nowrap\" fxFill>\n          <div class=\"day-name text-center\" fxFlex=\"30px\" *ngFor=\"let d of daysOfWeek\">\n            {{ d }}\n          </div>\n        </div>\n      </div>\n      <div class=\"day-container\">\n        <div *ngFor=\"let week of weeks\" class=\"day-row\" fxLayout=\"row\" fxLayoutWrap=\"nowrap\" fxFill>\n          <div *ngFor=\"let day of week\" class=\"day-cell text-center\" fxFlex=\"30px\">\n            <button\n              *ngIf=\"day.num\"\n              class=\"day\"\n              type=\"button\"\n              [title]=\"day.date | amTimeZone: timezone | amDateFormat: 'LL'\"\n              [class.active]=\"isDayActive(day.date)\"\n              [ngClass]=\"day.classes\"\n              [disabled]=\"isDisabled(day.date, 'day')\"\n              (click)=\"onDayClick(day)\"\n            >\n              {{ day.num }}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div *ngSwitchCase=\"'month'\">\n      <div class=\"title-row\" fxLayout=\"row\" fxLayoutWrap=\"nowrap\" fxLayoutAlign=\"center center\">\n        <button type=\"button\" class=\"prev-month\" [disabled]=\"disabled\" title=\"Previous Year\" (click)=\"prevYear()\">\n          <span class=\"icon-arrow-left\"></span>\n        </button>\n        <span class=\"title\" (click)=\"changeViews()\">\n          {{ activeDate | amTimeZone: timezone | amDateFormat: 'YYYY' }}\n        </span>\n        <button type=\"button\" class=\"next-month\" title=\"Next Year\" [disabled]=\"disabled\" (click)=\"nextYear()\">\n          <span class=\"icon-arrow-right\"></span>\n        </button>\n      </div>\n      <div class=\"months-container\">\n        <div class=\"months-row\">\n          <button\n            class=\"month\"\n            type=\"button\"\n            [class.active]=\"isMonthActive(month)\"\n            [class.current]=\"isCurrentMonth(month)\"\n            *ngFor=\"let month of monthsList\"\n            (click)=\"onMonthClick(month)\"\n            [disabled]=\"isDisabled(month, 'month')\"\n          >\n            {{ month }}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div *ngSwitchCase=\"'year'\">\n      <div class=\"title-row\" fxLayout=\"row\" fxLayoutWrap=\"nowrap\" fxLayoutAlign=\"center center\">\n        <button\n          type=\"button\"\n          class=\"prev-month\"\n          [disabled]=\"disabled\"\n          title=\"Previous Two Decades\"\n          (click)=\"prevTwoDecades()\"\n        >\n          <span class=\"icon-arrow-left\"></span>\n        </button>\n        <span class=\"title\" (click)=\"changeViews()\"> {{ startYear }} - {{ startYear + 20 }} </span>\n        <button\n          type=\"button\"\n          class=\"next-month\"\n          title=\"Next Two Decades\"\n          [disabled]=\"disabled\"\n          (click)=\"nextTwoDecades()\"\n        >\n          <span class=\"icon-arrow-right\"></span>\n        </button>\n      </div>\n      <div class=\"years-container\">\n        <div class=\"years-row\">\n          <button\n            class=\"year\"\n            type=\"button\"\n            *ngFor=\"let dummy of ' '.repeat(20).split(''); let x = index\"\n            [class.active]=\"isYearActive(x + startYear)\"\n            [class.current]=\"isCurrentYear(x + startYear)\"\n            (click)=\"onYearClick(x + startYear)\"\n            [disabled]=\"isDisabled(x + startYear, 'year')\"\n          >\n            {{ x + startYear }}\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n",
        host: {
            class: 'ngx-calendar',
            tabindex: '1',
            '(blur)': 'onTouchedCallback()'
        },
        providers: [CALENDAR_VALUE_ACCESSOR],
        encapsulation: ViewEncapsulation.None,
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: [".ngx-calendar{position:relative;font-size:.9rem;box-shadow:0 1px 8px 0 rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 3px 3px -2px rgba(0,0,0,.12);background:#1c2029;display:inline-block;border:1px solid #313847;width:270px;padding:.5rem;height:270px}.ngx-calendar:focus{outline:0}.ngx-calendar .title-row{background:#1c2029;color:#e9e9e9;padding:.69rem 0;font-weight:600;line-height:0}.ngx-calendar .title-row .title{color:#479eff;min-width:100px;cursor:pointer}.ngx-calendar .title-row button{color:#818fa9;font-size:.6rem}.ngx-calendar .day-name-row{color:#818fa9;font-weight:600}.ngx-calendar .day-cell,.ngx-calendar .day-name{margin:.1rem .2rem;line-height:1.8rem;text-align:center;width:1.8rem;height:1.8rem}.ngx-calendar .day-container{margin-top:0}.ngx-calendar .day-container .day{color:#e9e9e9;height:100%;width:100%;max-height:30px;max-width:30px;line-height:100%;border-radius:50%;text-align:center;-webkit-transition:background .2s;transition:background .2s;padding:0}.ngx-calendar .day-container .day.next-month,.ngx-calendar .day-container .day.prev-month{color:#818fa9;opacity:.2}.ngx-calendar .day-container .day.today{background:#262c38}.ngx-calendar .day-container .day.active{background:#479eff;color:#e9e9e9}.ngx-calendar .day-container .day:hover:not(.active):hover:not([disabled]){background:#479eff;color:#e9e9e9;opacity:1}.ngx-calendar .months-container,.ngx-calendar .years-container{margin:.5rem;border:1px solid #313847;border-bottom:0;color:#e9e9e9}.ngx-calendar .months-container .months-row,.ngx-calendar .months-container .years-row,.ngx-calendar .years-container .months-row,.ngx-calendar .years-container .years-row{display:-ms-grid;display:grid}.ngx-calendar .months-container .month,.ngx-calendar .months-container .year,.ngx-calendar .years-container .month,.ngx-calendar .years-container .year{border-right:1px solid #313847;border-bottom:1px solid #313847;grid-auto-rows:auto;text-transform:uppercase;text-align:center;font-size:14px}.ngx-calendar .months-container .month.active,.ngx-calendar .months-container .year.active,.ngx-calendar .years-container .month.active,.ngx-calendar .years-container .year.active{background-color:#479eff}.ngx-calendar .months-container .month.current:not(.active),.ngx-calendar .months-container .year.current:not(.active),.ngx-calendar .years-container .month.current:not(.active),.ngx-calendar .years-container .year.current:not(.active){background-color:#262c38}.ngx-calendar .months-container .month:hover:not(.active):hover:not([disabled]),.ngx-calendar .months-container .year:hover:not(.active):hover:not([disabled]),.ngx-calendar .years-container .month:hover:not(.active):hover:not([disabled]),.ngx-calendar .years-container .year:hover:not(.active):hover:not([disabled]){background:#479eff;color:#e9e9e9;opacity:1}.ngx-calendar .months-container .months-row{-ms-grid-columns:(1fr)[3];grid-template-columns:repeat(3,1fr)}.ngx-calendar .months-container .month{padding:.75rem}.ngx-calendar .months-container .month:nth-child(3n){border-right:0}.ngx-calendar .years-container .years-row{-ms-grid-columns:(1fr)[4];grid-template-columns:repeat(4,1fr)}.ngx-calendar .years-container .year{padding:.475rem}.ngx-calendar .years-container .year:nth-child(4n){border-right:0}"]
    }),
    __metadata("design:paramtypes", [ChangeDetectorRef])
], CalendarComponent);
export { CalendarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHN3aW1sYW5lL25neC11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2NhbGVuZGFyL2NhbGVuZGFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixVQUFVLEVBQ1YsTUFBTSxFQUNOLGlCQUFpQixFQUNqQix1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLGFBQWEsRUFDZCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxNQUFNLE1BQU0saUJBQWlCLENBQUM7QUFFckMsT0FBTyxFQUFFLFFBQVEsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUd2RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFcEQsTUFBTSx1QkFBdUIsR0FBRztJQUM5QixPQUFPLEVBQUUsaUJBQWlCO0lBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsaUJBQWlCLENBQUM7SUFDaEQsS0FBSyxFQUFFLElBQUk7Q0FDWixDQUFDO0FBZ0JGLElBQWEsaUJBQWlCLEdBQTlCLE1BQWEsaUJBQWlCO0lBMkQ1QixZQUE2QixHQUFzQjtRQUF0QixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQXZEMUMsZUFBVSxHQUFhLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFFM0QsaUJBQVksR0FBK0MsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7UUFvQi9GLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBUSxD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VCxRQUFRLEVBQUUsY0FBYztRQUN4QixRQUFRLEVBQUUsYUFBYTtRQUN2QixpMklBQXdDO1FBRXhDLElBQUksRUFBRTtZQUNKLEtBQUssRUFBRSxjQUFjO1lBQ3JCLFFBQVEsRUFBRSxHQUFHO1lBQ2IsUUFBUSxFQUFFLHFCQUFxQjtTQUNoQztRQUNELFNBQVMsRUFBRSxDQUFDLHVCQUF1QixDQUFDO1FBQ3BDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO1FBQ3JDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOztLQUNoRCxDQUFDO3FDQTREa0MsaUJBQWlCO0dBM0R4QyxpQkFBaUIsQ0F3UTdCO1NBeFFZLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBmb3J3YXJkUmVmLFxuICBPbkluaXQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIEFmdGVyVmlld0luaXRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudC10aW1lem9uZSc7XG5cbmltcG9ydCB7IGdldE1vbnRoLCBnZXREZWNhZGVTdGFydFllYXIgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IENhbGVuZGFyRGF5IH0gZnJvbSAnLi9jYWxlbmRhci1kYXkuaW50ZXJmYWNlJztcbmltcG9ydCB7IENhbGVuZGFyTW9udGggfSBmcm9tICcuL2NhbGVuZGFyLW1vbnRoLnR5cGUnO1xuaW1wb3J0IHsgQ2FsZW5kYXJWaWV3IH0gZnJvbSAnLi9jYWxlbmRhci12aWV3LmVudW0nO1xuXG5jb25zdCBDQUxFTkRBUl9WQUxVRV9BQ0NFU1NPUiA9IHtcbiAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IENhbGVuZGFyQ29tcG9uZW50KSxcbiAgbXVsdGk6IHRydWVcbn07XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25neC1jYWxlbmRhcicsXG4gIGV4cG9ydEFzOiAnbmd4Q2FsZW5kYXInLFxuICB0ZW1wbGF0ZVVybDogJy4vY2FsZW5kYXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9jYWxlbmRhci5jb21wb25lbnQuc2NzcyddLFxuICBob3N0OiB7XG4gICAgY2xhc3M6ICduZ3gtY2FsZW5kYXInLFxuICAgIHRhYmluZGV4OiAnMScsXG4gICAgJyhibHVyKSc6ICdvblRvdWNoZWRDYWxsYmFjaygpJ1xuICB9LFxuICBwcm92aWRlcnM6IFtDQUxFTkRBUl9WQUxVRV9BQ0NFU1NPUl0sXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIENhbGVuZGFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciB7XG4gIEBJbnB1dCgpIG1pbkRhdGU6IERhdGUgfCBzdHJpbmc7XG4gIEBJbnB1dCgpIGRpc2FibGVkOiBib29sZWFuO1xuICBASW5wdXQoKSBtYXhEYXRlOiBEYXRlIHwgc3RyaW5nO1xuICBASW5wdXQoKSBkYXlzT2ZXZWVrOiBzdHJpbmdbXSA9IFsnUycsICdNJywgJ1QnLCAnVycsICdUJywgJ0YnLCAnUyddO1xuICBASW5wdXQoKSB0aW1lem9uZTogc3RyaW5nO1xuICBASW5wdXQoKSBpbnB1dEZvcm1hdHM6IEFycmF5PHN0cmluZyB8IG1vbWVudC5Nb21lbnRCdWlsdGluRm9ybWF0PiA9IFsnTCcsIGBMVGAsICdMIExUJywgbW9tZW50LklTT184NjAxXTtcblxuICBASW5wdXQoJ21pblZpZXcnKVxuICBnZXQgbWluVmlldygpIHtcbiAgICByZXR1cm4gdGhpcy5fbWluVmlldyA/IHRoaXMuX21pblZpZXcgOiBDYWxlbmRhclZpZXcuRGF0ZTtcbiAgfVxuICBzZXQgbWluVmlldyh2YWw6IENhbGVuZGFyVmlldykge1xuICAgIHRoaXMuX21pblZpZXcgPSB2YWw7XG4gICAgdGhpcy52YWxpZGF0ZVZpZXcoKTtcbiAgfVxuXG4gIEBJbnB1dCgnZGVmYXVsdFZpZXcnKVxuICBnZXQgZGVmYXVsdFZpZXcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2RlZmF1bHRWaWV3ID8gdGhpcy5fZGVmYXVsdFZpZXcgOiB0aGlzLm1pblZpZXc7XG4gIH1cbiAgc2V0IGRlZmF1bHRWaWV3KHZhbDogQ2FsZW5kYXJWaWV3KSB7XG4gICAgdGhpcy5fZGVmYXVsdFZpZXcgPSB2YWw7XG4gICAgdGhpcy52YWxpZGF0ZVZpZXcoKTtcbiAgfVxuXG4gIEBPdXRwdXQoKSBjaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGU+KCk7XG5cbiAgZ2V0IHZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuICBzZXQgdmFsdWUodmFsOiBEYXRlKSB7XG4gICAgY29uc3QgZGF0ZSA9IHRoaXMuY3JlYXRlTW9tZW50KHZhbCk7XG5cbiAgICBpZiAoZGF0ZS5pc1ZhbGlkKCkpIHtcbiAgICAgIGlmICghZGF0ZS5pc1NhbWUodGhpcy5fdmFsdWUsICdkYXknKSkge1xuICAgICAgICB0aGlzLl92YWx1ZSA9IHZhbDtcbiAgICAgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrKHRoaXMuX3ZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jaGFuZ2UuZW1pdCh0aGlzLl92YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGN1cnJlbnQoKTogbW9tZW50Lk1vbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuX2N1cnJlbnQ7XG4gIH1cblxuICBhY3RpdmVEYXRlOiBtb21lbnQuTW9tZW50O1xuICB3ZWVrczogQ2FsZW5kYXJNb250aDtcbiAgY3VycmVudFZpZXc6IENhbGVuZGFyVmlldztcbiAgbW9udGhzTGlzdCA9IG1vbWVudC5tb250aHNTaG9ydCgpO1xuICBzdGFydFllYXI6IG51bWJlcjtcblxuICBwcml2YXRlIF92YWx1ZTogRGF0ZTtcbiAgcHJpdmF0ZSBfY3VycmVudDogbW9tZW50Lk1vbWVudDtcbiAgcHJpdmF0ZSBfbWluVmlldzogQ2FsZW5kYXJWaWV3O1xuICBwcml2YXRlIF9kZWZhdWx0VmlldzogQ2FsZW5kYXJWaWV3O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZikge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmFjdGl2ZURhdGUgPSB0aGlzLmNyZWF0ZU1vbWVudCh0aGlzLnZhbHVlKTtcbiAgICB0aGlzLndlZWtzID0gZ2V0TW9udGgodGhpcy5hY3RpdmVEYXRlKTtcbiAgICB0aGlzLm1vbnRoc0xpc3QgPSBtb21lbnQubW9udGhzU2hvcnQoKTtcbiAgICB0aGlzLl9jdXJyZW50ID0gdGhpcy5hY3RpdmVEYXRlO1xuICAgIHRoaXMuc3RhcnRZZWFyID0gZ2V0RGVjYWRlU3RhcnRZZWFyKHRoaXMuX2N1cnJlbnQueWVhcigpKTtcbiAgICB0aGlzLnZhbGlkYXRlVmlldygpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgY2hhbmdlVmlld3MoKSB7XG4gICAgaWYgKHRoaXMuY3VycmVudFZpZXcgPT09IENhbGVuZGFyVmlldy5EYXRlKSB7XG4gICAgICB0aGlzLmN1cnJlbnRWaWV3ID0gQ2FsZW5kYXJWaWV3Lk1vbnRoO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jdXJyZW50VmlldyA9PT0gQ2FsZW5kYXJWaWV3Lk1vbnRoKSB7XG4gICAgICB0aGlzLmN1cnJlbnRWaWV3ID0gQ2FsZW5kYXJWaWV3LlllYXI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY3VycmVudFZpZXcgPSB0aGlzLm1pblZpZXc7XG4gICAgfVxuXG4gICAgdGhpcy53ZWVrcyA9IGdldE1vbnRoKHRoaXMuYWN0aXZlRGF0ZSk7XG4gIH1cblxuICB2YWxpZGF0ZVZpZXcoKSB7XG4gICAgY29uc3Qgdmlld3NMaXN0ID0gW0NhbGVuZGFyVmlldy5EYXRlLCBDYWxlbmRhclZpZXcuTW9udGgsIENhbGVuZGFyVmlldy5ZZWFyXTtcblxuICAgIC8vIGRhdGUgdGltZSBwaWNrZXIgcHJlY2lzaW9uIHZhbGlkYXRpb25cbiAgICBpZiAoIXZpZXdzTGlzdC5pbmNsdWRlcyh0aGlzLm1pblZpZXcpKSB7XG4gICAgICB0aGlzLm1pblZpZXcgPSBDYWxlbmRhclZpZXcuRGF0ZTtcbiAgICB9XG5cbiAgICAvLyBkZWZhdWx0VmlldyBjYW5ub3QgYmUgYmVsb3cgbWluVmlld1xuICAgIGlmICh2aWV3c0xpc3QuaW5kZXhPZih0aGlzLm1pblZpZXcpID4gdmlld3NMaXN0LmluZGV4T2YodGhpcy5kZWZhdWx0VmlldykpIHtcbiAgICAgIHRoaXMuZGVmYXVsdFZpZXcgPSB0aGlzLm1pblZpZXc7XG4gICAgfVxuXG4gICAgdGhpcy5jdXJyZW50VmlldyA9IHRoaXMuZGVmYXVsdFZpZXc7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGBkYXRlYCBtYXRjaGVzIHNlbGVjdGVkIHZhbHVlXG4gICAqL1xuICBpc0RheUFjdGl2ZShkYXRlOiBtb21lbnQuTW9tZW50KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGRhdGUuaXNTYW1lKHRoaXMudmFsdWUsICdkYXknKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYG1vbnRoYCBtYXRjaGVzIHNlbGVjdGVkIHZhbHVlLCBpbiB0aGUgdmlld2VkIHllYXJcbiAgICovXG4gIGlzTW9udGhBY3RpdmUobW9udGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGRhdGUgPSB0aGlzLmNyZWF0ZU1vbWVudCh0aGlzLnZhbHVlKS5tb250aChtb250aCk7XG4gICAgcmV0dXJuIGRhdGUuaXNTYW1lKHRoaXMudmFsdWUsICdtb250aCcpICYmIGRhdGUuaXNTYW1lKHRoaXMuYWN0aXZlRGF0ZSwgJ3llYXInKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYG1vbnRoYCBhbmQgeWVhciBtYXRjaGVzIGN1cnJlbnRcbiAgICovXG4gIGlzQ3VycmVudE1vbnRoKG1vbnRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBjb25zdCBkYXRlID0gdGhpcy5hY3RpdmVEYXRlLmNsb25lKCkubW9udGgobW9udGgpO1xuICAgIHJldHVybiBkYXRlLmlzU2FtZSh0aGlzLl9jdXJyZW50LCAnbW9udGgnKSAmJiBkYXRlLmlzU2FtZSh0aGlzLl9jdXJyZW50LCAneWVhcicpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBgeWVhcmAgbWF0Y2hlcyBzZWxlY3RlZCB5ZWFyXG4gICAqL1xuICBpc1llYXJBY3RpdmUoeWVhcjogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZGF0ZSA9IHRoaXMuY3JlYXRlTW9tZW50KHRoaXMudmFsdWUpLnllYXIoeWVhcik7XG4gICAgcmV0dXJuIGRhdGUuaXNTYW1lKHRoaXMudmFsdWUsICd5ZWFyJyk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIHllYXIgbWF0Y2hlcyBjdXJyZW50IHllYXJcbiAgICovXG4gIGlzQ3VycmVudFllYXIoeWVhcjogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZGF0ZSA9IHRoaXMuY3JlYXRlTW9tZW50KHRoaXMudmFsdWUpLnllYXIoeWVhcik7XG4gICAgcmV0dXJuIGRhdGUuaXNTYW1lKHRoaXMuX2N1cnJlbnQsICd5ZWFyJyk7XG4gIH1cblxuICBpc0Rpc2FibGVkKHZhbHVlOiBhbnksIHR5cGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmRpc2FibGVkKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoIXZhbHVlKSByZXR1cm4gZmFsc2U7XG5cbiAgICBsZXQgZGF0ZTogbW9tZW50Lk1vbWVudDtcblxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgZGF0ZSA9IHZhbHVlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgZGF0ZSA9IHRoaXMuYWN0aXZlRGF0ZS5jbG9uZSgpLm1vbnRoKHZhbHVlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgZGF0ZSA9IHRoaXMuYWN0aXZlRGF0ZS5jbG9uZSgpLnllYXIodmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBpc0JlZm9yZU1pbiA9IHRoaXMubWluRGF0ZSAmJiBkYXRlLmlzQmVmb3JlKHRoaXMucGFyc2VEYXRlKHRoaXMubWluRGF0ZSksIHR5cGUpO1xuICAgIGNvbnN0IGlzQWZ0ZXJNYXggPSB0aGlzLm1heERhdGUgJiYgZGF0ZS5pc0FmdGVyKHRoaXMucGFyc2VEYXRlKHRoaXMubWF4RGF0ZSksIHR5cGUpO1xuXG4gICAgcmV0dXJuIGlzQmVmb3JlTWluIHx8IGlzQWZ0ZXJNYXg7XG4gIH1cblxuICBvbkRheUNsaWNrKGRheTogQ2FsZW5kYXJEYXkpIHtcbiAgICB0aGlzLmFjdGl2ZURhdGUgPSBkYXkuZGF0ZS5jbG9uZSgpO1xuICAgIHRoaXMudmFsdWUgPSB0aGlzLmFjdGl2ZURhdGUudG9EYXRlKCk7XG5cbiAgICBpZiAoZGF5LnByZXZNb250aCB8fCBkYXkubmV4dE1vbnRoKSB7XG4gICAgICB0aGlzLndlZWtzID0gZ2V0TW9udGgodGhpcy5hY3RpdmVEYXRlKTtcbiAgICB9XG4gIH1cblxuICBvbk1vbnRoQ2xpY2sobW9udGg6IHN0cmluZykge1xuICAgIHRoaXMuYWN0aXZlRGF0ZS5tb250aChtb250aCk7XG4gICAgdGhpcy52YWx1ZSA9IHRoaXMuYWN0aXZlRGF0ZS50b0RhdGUoKTtcblxuICAgIGlmICh0aGlzLm1pblZpZXcgIT09IENhbGVuZGFyVmlldy5Nb250aCkge1xuICAgICAgdGhpcy5jdXJyZW50VmlldyA9IENhbGVuZGFyVmlldy5EYXRlO1xuICAgICAgdGhpcy53ZWVrcyA9IGdldE1vbnRoKHRoaXMuYWN0aXZlRGF0ZSk7XG4gICAgfVxuICB9XG5cbiAgb25ZZWFyQ2xpY2soeWVhcjogbnVtYmVyKSB7XG4gICAgdGhpcy5hY3RpdmVEYXRlLnllYXIoeWVhcik7XG4gICAgdGhpcy52YWx1ZSA9IHRoaXMuYWN0aXZlRGF0ZS50b0RhdGUoKTtcblxuICAgIGlmICh0aGlzLm1pblZpZXcgIT09IENhbGVuZGFyVmlldy5ZZWFyKSB7XG4gICAgICB0aGlzLmN1cnJlbnRWaWV3ID0gQ2FsZW5kYXJWaWV3Lk1vbnRoO1xuICAgICAgdGhpcy53ZWVrcyA9IGdldE1vbnRoKHRoaXMuYWN0aXZlRGF0ZSk7XG4gICAgfVxuICB9XG5cbiAgcHJldk1vbnRoKCkge1xuICAgIGNvbnN0IGRhdGUgPSB0aGlzLmFjdGl2ZURhdGUuY2xvbmUoKTtcbiAgICB0aGlzLmFjdGl2ZURhdGUgPSBkYXRlLnN1YnRyYWN0KDEsICdtb250aCcpO1xuICAgIHRoaXMud2Vla3MgPSBnZXRNb250aCh0aGlzLmFjdGl2ZURhdGUpO1xuICB9XG5cbiAgbmV4dE1vbnRoKCkge1xuICAgIGNvbnN0IGRhdGUgPSB0aGlzLmFjdGl2ZURhdGUuY2xvbmUoKTtcbiAgICB0aGlzLmFjdGl2ZURhdGUgPSBkYXRlLmFkZCgxLCAnbW9udGgnKTtcbiAgICB0aGlzLndlZWtzID0gZ2V0TW9udGgodGhpcy5hY3RpdmVEYXRlKTtcbiAgfVxuXG4gIHByZXZZZWFyKCkge1xuICAgIGNvbnN0IGRhdGUgPSB0aGlzLmFjdGl2ZURhdGUuY2xvbmUoKTtcbiAgICB0aGlzLmFjdGl2ZURhdGUgPSBkYXRlLnN1YnRyYWN0KDEsICd5ZWFyJyk7XG4gIH1cblxuICBuZXh0WWVhcigpIHtcbiAgICBjb25zdCBkYXRlID0gdGhpcy5hY3RpdmVEYXRlLmNsb25lKCk7XG4gICAgdGhpcy5hY3RpdmVEYXRlID0gZGF0ZS5hZGQoMSwgJ3llYXInKTtcbiAgfVxuXG4gIHByZXZUd29EZWNhZGVzKCkge1xuICAgIHRoaXMuc3RhcnRZZWFyID0gdGhpcy5zdGFydFllYXIgLSAyMDtcbiAgfVxuXG4gIG5leHRUd29EZWNhZGVzKCkge1xuICAgIHRoaXMuc3RhcnRZZWFyID0gdGhpcy5zdGFydFllYXIgKyAyMDtcbiAgfVxuXG4gIHdyaXRlVmFsdWUodmFsOiBhbnkpIHtcbiAgICBjb25zdCBhY3RpdmVEYXRlID0gdGhpcy5jcmVhdGVNb21lbnQodmFsKTtcblxuICAgIGlmIChhY3RpdmVEYXRlLmlzVmFsaWQoKSAmJiAhYWN0aXZlRGF0ZS5pc1NhbWUodGhpcy52YWx1ZSwgJ2RheScpKSB7XG4gICAgICB0aGlzLmFjdGl2ZURhdGUgPSBhY3RpdmVEYXRlO1xuICAgICAgdGhpcy53ZWVrcyA9IGdldE1vbnRoKHRoaXMuYWN0aXZlRGF0ZSk7XG4gICAgICB0aGlzLl92YWx1ZSA9IHZhbDtcbiAgICAgIHRoaXMuc3RhcnRZZWFyID0gZ2V0RGVjYWRlU3RhcnRZZWFyKHRoaXMuYWN0aXZlRGF0ZS55ZWFyKCkpO1xuICAgIH1cblxuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjayA9IGZuO1xuICB9XG5cbiAgb25Ub3VjaGVkQ2FsbGJhY2s6ICgpID0+IHZvaWQgPSAoKSA9PiB7XG4gICAgLy8gcGxhY2Vob2xkZXJcbiAgfTtcblxuICBwcml2YXRlIG9uQ2hhbmdlQ2FsbGJhY2s6IChfOiBhbnkpID0+IHZvaWQgPSAoKSA9PiB7XG4gICAgLy8gcGxhY2Vob2xkZXJcbiAgfTtcblxuICBwcml2YXRlIHBhcnNlRGF0ZShkYXRlOiBzdHJpbmcgfCBEYXRlKTogbW9tZW50Lk1vbWVudCB7XG4gICAgZGF0ZSA9IGRhdGUgaW5zdGFuY2VvZiBEYXRlID8gZGF0ZS50b0lTT1N0cmluZygpIDogZGF0ZTtcbiAgICByZXR1cm4gdGhpcy50aW1lem9uZSA/IG1vbWVudC50eihkYXRlLCB0aGlzLmlucHV0Rm9ybWF0cywgdGhpcy50aW1lem9uZSkgOiBtb21lbnQoZGF0ZSwgdGhpcy5pbnB1dEZvcm1hdHMpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVNb21lbnQoZGF0ZTogc3RyaW5nIHwgRGF0ZSB8IG1vbWVudC5Nb21lbnQpOiBtb21lbnQuTW9tZW50IHtcbiAgICBjb25zdCBtID0gbW9tZW50KGRhdGUpLmNsb25lKCk7XG4gICAgcmV0dXJuIHRoaXMudGltZXpvbmUgPyBtLnR6KHRoaXMudGltZXpvbmUpIDogbTtcbiAgfVxufVxuIl19