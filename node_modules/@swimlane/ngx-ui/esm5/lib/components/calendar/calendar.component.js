import { __decorate, __metadata } from "tslib";
import { Component, Input, Output, EventEmitter, forwardRef, OnInit, ViewEncapsulation, ChangeDetectionStrategy, ChangeDetectorRef, AfterViewInit } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import moment from 'moment-timezone';
import { getMonth, getDecadeStartYear } from './utils';
import { CalendarView } from './calendar-view.enum';
var CALENDAR_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(function () { return CalendarComponent; }),
    multi: true
};
var CalendarComponent = /** @class */ (function () {
    function CalendarComponent(cdr) {
        this.cdr = cdr;
        this.daysOfWeek = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
        this.inputFormats = ['L', "LT", 'L LT', moment.ISO_8601];
        this.change = new EventEmitter();
        this.monthsList = moment.monthsShort();
        this.onTouchedCallback = function () {
            // placeholder
        };
        this.onChangeCallback = function () {
            // placeholder
        };
    }
    Object.defineProperty(CalendarComponent.prototype, "minView", {
        get: function () {
            return this._minView ? this._minView : CalendarView.Date;
        },
        set: function (val) {
            this._minView = val;
            this.validateView();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarComponent.prototype, "defaultView", {
        get: function () {
            return this._defaultView ? this._defaultView : this.minView;
        },
        set: function (val) {
            this._defaultView = val;
            this.validateView();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarComponent.prototype, "value", {
        get: function () {
            return this._value;
        },
        set: function (val) {
            var date = this.createMoment(val);
            if (date.isValid()) {
                if (!date.isSame(this._value, 'day')) {
                    this._value = val;
                    this.onChangeCallback(this._value);
                }
                this.change.emit(this._value);
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarComponent.prototype, "current", {
        get: function () {
            return this._current;
        },
        enumerable: true,
        configurable: true
    });
    CalendarComponent.prototype.ngOnInit = function () {
        this.activeDate = this.createMoment(this.value);
        this.weeks = getMonth(this.activeDate);
        this.monthsList = moment.monthsShort();
        this._current = this.activeDate;
        this.startYear = getDecadeStartYear(this._current.year());
        this.validateView();
    };
    CalendarComponent.prototype.ngAfterViewInit = function () {
        this.cdr.markForCheck();
    };
    CalendarComponent.prototype.changeViews = function () {
        if (this.currentView === CalendarView.Date) {
            this.currentView = CalendarView.Month;
        }
        else if (this.currentView === CalendarView.Month) {
            this.currentView = CalendarView.Year;
        }
        else {
            this.currentView = this.minView;
        }
        this.weeks = getMonth(this.activeDate);
    };
    CalendarComponent.prototype.validateView = function () {
        var viewsList = [CalendarView.Date, CalendarView.Month, CalendarView.Year];
        // date time picker precision validation
        if (!viewsList.includes(this.minView)) {
            this.minView = CalendarView.Date;
        }
        // defaultView cannot be below minView
        if (viewsList.indexOf(this.minView) > viewsList.indexOf(this.defaultView)) {
            this.defaultView = this.minView;
        }
        this.currentView = this.defaultView;
    };
    /**
     * Checks if `date` matches selected value
     */
    CalendarComponent.prototype.isDayActive = function (date) {
        return date.isSame(this.value, 'day');
    };
    /**
     * Checks if `month` matches selected value, in the viewed year
     */
    CalendarComponent.prototype.isMonthActive = function (month) {
        var date = this.createMoment(this.value).month(month);
        return date.isSame(this.value, 'month') && date.isSame(this.activeDate, 'year');
    };
    /**
     * Checks if `month` and year matches current
     */
    CalendarComponent.prototype.isCurrentMonth = function (month) {
        var date = this.activeDate.clone().month(month);
        return date.isSame(this._current, 'month') && date.isSame(this._current, 'year');
    };
    /**
     * Checks if `year` matches selected year
     */
    CalendarComponent.prototype.isYearActive = function (year) {
        var date = this.createMoment(this.value).year(year);
        return date.isSame(this.value, 'year');
    };
    /**
     * Checks if year matches current year
     */
    CalendarComponent.prototype.isCurrentYear = function (year) {
        var date = this.createMoment(this.value).year(year);
        return date.isSame(this._current, 'year');
    };
    CalendarComponent.prototype.isDisabled = function (value, type) {
        if (this.disabled)
            return true;
        if (!value)
            return false;
        var date;
        switch (type) {
            case 'day':
                date = value;
                break;
            case 'month':
                date = this.activeDate.clone().month(value);
                break;
            case 'year':
                date = this.activeDate.clone().year(value);
                break;
            default:
                return false;
        }
        var isBeforeMin = this.minDate && date.isBefore(this.parseDate(this.minDate), type);
        var isAfterMax = this.maxDate && date.isAfter(this.parseDate(this.maxDate), type);
        return isBeforeMin || isAfterMax;
    };
    CalendarComponent.prototype.onDayClick = function (day) {
        this.activeDate = day.date.clone();
        this.value = this.activeDate.toDate();
        if (day.prevMonth || day.nextMonth) {
            this.weeks = getMonth(this.activeDate);
        }
    };
    CalendarComponent.prototype.onMonthClick = function (month) {
        this.activeDate.month(month);
        this.value = this.activeDate.toDate();
        if (this.minView !== CalendarView.Month) {
            this.currentView = CalendarView.Date;
            this.weeks = getMonth(this.activeDate);
        }
    };
    CalendarComponent.prototype.onYearClick = function (year) {
        this.activeDate.year(year);
        this.value = this.activeDate.toDate();
        if (this.minView !== CalendarView.Year) {
            this.currentView = CalendarView.Month;
            this.weeks = getMonth(this.activeDate);
        }
    };
    CalendarComponent.prototype.prevMonth = function () {
        var date = this.activeDate.clone();
        this.activeDate = date.subtract(1, 'month');
        this.weeks = getMonth(this.activeDate);
    };
    CalendarComponent.prototype.nextMonth = function () {
        var date = this.activeDate.clone();
        this.activeDate = date.add(1, 'month');
        this.weeks = getMonth(this.activeDate);
    };
    CalendarComponent.prototype.prevYear = function () {
        var date = this.activeDate.clone();
        this.activeDate = date.subtract(1, 'year');
    };
    CalendarComponent.prototype.nextYear = function () {
        var date = this.activeDate.clone();
        this.activeDate = date.add(1, 'year');
    };
    CalendarComponent.prototype.prevTwoDecades = function () {
        this.startYear = this.startYear - 20;
    };
    CalendarComponent.prototype.nextTwoDecades = function () {
        this.startYear = this.startYear + 20;
    };
    CalendarComponent.prototype.writeValue = function (val) {
        var activeDate = this.createMoment(val);
        if (activeDate.isValid() && !activeDate.isSame(this.value, 'day')) {
            this.activeDate = activeDate;
            this.weeks = getMonth(this.activeDate);
            this._value = val;
            this.startYear = getDecadeStartYear(this.activeDate.year());
        }
        this.cdr.markForCheck();
    };
    CalendarComponent.prototype.registerOnChange = function (fn) {
        this.onChangeCallback = fn;
    };
    CalendarComponent.prototype.registerOnTouched = function (fn) {
        this.onTouchedCallback = fn;
    };
    CalendarComponent.prototype.parseDate = function (date) {
        date = date instanceof Date ? date.toISOString() : date;
        return this.timezone ? moment.tz(date, this.inputFormats, this.timezone) : moment(date, this.inputFormats);
    };
    CalendarComponent.prototype.createMoment = function (date) {
        var m = moment(date).clone();
        return this.timezone ? m.tz(this.timezone) : m;
    };
    CalendarComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], CalendarComponent.prototype, "minDate", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], CalendarComponent.prototype, "disabled", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], CalendarComponent.prototype, "maxDate", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], CalendarComponent.prototype, "daysOfWeek", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], CalendarComponent.prototype, "timezone", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], CalendarComponent.prototype, "inputFormats", void 0);
    __decorate([
        Input('minView'),
        __metadata("design:type", String),
        __metadata("design:paramtypes", [String])
    ], CalendarComponent.prototype, "minView", null);
    __decorate([
        Input('defaultView'),
        __metadata("design:type", String),
        __metadata("design:paramtypes", [String])
    ], CalendarComponent.prototype, "defaultView", null);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], CalendarComponent.prototype, "change", void 0);
    CalendarComponent = __decorate([
        Component({
            selector: 'ngx-calendar',
            exportAs: 'ngxCalendar',
            template: "<div class=\"ngx-calendar-wrap\">\n  <div fxFlex=\"100%\" class=\"text-center\" [ngSwitch]=\"currentView\">\n    <div *ngSwitchCase=\"'date'\">\n      <div class=\"title-row\" fxLayout=\"row\" fxLayoutWrap=\"nowrap\" fxLayoutAlign=\"center center\">\n        <button type=\"button\" class=\"prev-month\" [disabled]=\"disabled\" title=\"Previous Month\" (click)=\"prevMonth()\">\n          <span class=\"icon-arrow-left\"></span>\n        </button>\n        <span class=\"title\" (click)=\"changeViews()\">\n          {{ activeDate | amTimeZone: timezone | amDateFormat: 'MMMM YYYY' }}\n        </span>\n        <button type=\"button\" class=\"next-month\" title=\"Next Month\" [disabled]=\"disabled\" (click)=\"nextMonth()\">\n          <span class=\"icon-arrow-right\"></span>\n        </button>\n      </div>\n      <div class=\"day-name-row\">\n        <div fxLayout=\"row\" fxLayoutWrap=\"nowrap\" fxFill>\n          <div class=\"day-name text-center\" fxFlex=\"30px\" *ngFor=\"let d of daysOfWeek\">\n            {{ d }}\n          </div>\n        </div>\n      </div>\n      <div class=\"day-container\">\n        <div *ngFor=\"let week of weeks\" class=\"day-row\" fxLayout=\"row\" fxLayoutWrap=\"nowrap\" fxFill>\n          <div *ngFor=\"let day of week\" class=\"day-cell text-center\" fxFlex=\"30px\">\n            <button\n              *ngIf=\"day.num\"\n              class=\"day\"\n              type=\"button\"\n              [title]=\"day.date | amTimeZone: timezone | amDateFormat: 'LL'\"\n              [class.active]=\"isDayActive(day.date)\"\n              [ngClass]=\"day.classes\"\n              [disabled]=\"isDisabled(day.date, 'day')\"\n              (click)=\"onDayClick(day)\"\n            >\n              {{ day.num }}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div *ngSwitchCase=\"'month'\">\n      <div class=\"title-row\" fxLayout=\"row\" fxLayoutWrap=\"nowrap\" fxLayoutAlign=\"center center\">\n        <button type=\"button\" class=\"prev-month\" [disabled]=\"disabled\" title=\"Previous Year\" (click)=\"prevYear()\">\n          <span class=\"icon-arrow-left\"></span>\n        </button>\n        <span class=\"title\" (click)=\"changeViews()\">\n          {{ activeDate | amTimeZone: timezone | amDateFormat: 'YYYY' }}\n        </span>\n        <button type=\"button\" class=\"next-month\" title=\"Next Year\" [disabled]=\"disabled\" (click)=\"nextYear()\">\n          <span class=\"icon-arrow-right\"></span>\n        </button>\n      </div>\n      <div class=\"months-container\">\n        <div class=\"months-row\">\n          <button\n            class=\"month\"\n            type=\"button\"\n            [class.active]=\"isMonthActive(month)\"\n            [class.current]=\"isCurrentMonth(month)\"\n            *ngFor=\"let month of monthsList\"\n            (click)=\"onMonthClick(month)\"\n            [disabled]=\"isDisabled(month, 'month')\"\n          >\n            {{ month }}\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div *ngSwitchCase=\"'year'\">\n      <div class=\"title-row\" fxLayout=\"row\" fxLayoutWrap=\"nowrap\" fxLayoutAlign=\"center center\">\n        <button\n          type=\"button\"\n          class=\"prev-month\"\n          [disabled]=\"disabled\"\n          title=\"Previous Two Decades\"\n          (click)=\"prevTwoDecades()\"\n        >\n          <span class=\"icon-arrow-left\"></span>\n        </button>\n        <span class=\"title\" (click)=\"changeViews()\"> {{ startYear }} - {{ startYear + 20 }} </span>\n        <button\n          type=\"button\"\n          class=\"next-month\"\n          title=\"Next Two Decades\"\n          [disabled]=\"disabled\"\n          (click)=\"nextTwoDecades()\"\n        >\n          <span class=\"icon-arrow-right\"></span>\n        </button>\n      </div>\n      <div class=\"years-container\">\n        <div class=\"years-row\">\n          <button\n            class=\"year\"\n            type=\"button\"\n            *ngFor=\"let dummy of ' '.repeat(20).split(''); let x = index\"\n            [class.active]=\"isYearActive(x + startYear)\"\n            [class.current]=\"isCurrentYear(x + startYear)\"\n            (click)=\"onYearClick(x + startYear)\"\n            [disabled]=\"isDisabled(x + startYear, 'year')\"\n          >\n            {{ x + startYear }}\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n",
            host: {
                class: 'ngx-calendar',
                tabindex: '1',
                '(blur)': 'onTouchedCallback()'
            },
            providers: [CALENDAR_VALUE_ACCESSOR],
            encapsulation: ViewEncapsulation.None,
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: [".ngx-calendar{position:relative;font-size:.9rem;box-shadow:0 1px 8px 0 rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 3px 3px -2px rgba(0,0,0,.12);background:#1c2029;display:inline-block;border:1px solid #313847;width:270px;padding:.5rem;height:270px}.ngx-calendar:focus{outline:0}.ngx-calendar .title-row{background:#1c2029;color:#e9e9e9;padding:.69rem 0;font-weight:600;line-height:0}.ngx-calendar .title-row .title{color:#479eff;min-width:100px;cursor:pointer}.ngx-calendar .title-row button{color:#818fa9;font-size:.6rem}.ngx-calendar .day-name-row{color:#818fa9;font-weight:600}.ngx-calendar .day-cell,.ngx-calendar .day-name{margin:.1rem .2rem;line-height:1.8rem;text-align:center;width:1.8rem;height:1.8rem}.ngx-calendar .day-container{margin-top:0}.ngx-calendar .day-container .day{color:#e9e9e9;height:100%;width:100%;max-height:30px;max-width:30px;line-height:100%;border-radius:50%;text-align:center;-webkit-transition:background .2s;transition:background .2s;padding:0}.ngx-calendar .day-container .day.next-month,.ngx-calendar .day-container .day.prev-month{color:#818fa9;opacity:.2}.ngx-calendar .day-container .day.today{background:#262c38}.ngx-calendar .day-container .day.active{background:#479eff;color:#e9e9e9}.ngx-calendar .day-container .day:hover:not(.active):hover:not([disabled]){background:#479eff;color:#e9e9e9;opacity:1}.ngx-calendar .months-container,.ngx-calendar .years-container{margin:.5rem;border:1px solid #313847;border-bottom:0;color:#e9e9e9}.ngx-calendar .months-container .months-row,.ngx-calendar .months-container .years-row,.ngx-calendar .years-container .months-row,.ngx-calendar .years-container .years-row{display:-ms-grid;display:grid}.ngx-calendar .months-container .month,.ngx-calendar .months-container .year,.ngx-calendar .years-container .month,.ngx-calendar .years-container .year{border-right:1px solid #313847;border-bottom:1px solid #313847;grid-auto-rows:auto;text-transform:uppercase;text-align:center;font-size:14px}.ngx-calendar .months-container .month.active,.ngx-calendar .months-container .year.active,.ngx-calendar .years-container .month.active,.ngx-calendar .years-container .year.active{background-color:#479eff}.ngx-calendar .months-container .month.current:not(.active),.ngx-calendar .months-container .year.current:not(.active),.ngx-calendar .years-container .month.current:not(.active),.ngx-calendar .years-container .year.current:not(.active){background-color:#262c38}.ngx-calendar .months-container .month:hover:not(.active):hover:not([disabled]),.ngx-calendar .months-container .year:hover:not(.active):hover:not([disabled]),.ngx-calendar .years-container .month:hover:not(.active):hover:not([disabled]),.ngx-calendar .years-container .year:hover:not(.active):hover:not([disabled]){background:#479eff;color:#e9e9e9;opacity:1}.ngx-calendar .months-container .months-row{-ms-grid-columns:(1fr)[3];grid-template-columns:repeat(3,1fr)}.ngx-calendar .months-container .month{padding:.75rem}.ngx-calendar .months-container .month:nth-child(3n){border-right:0}.ngx-calendar .years-container .years-row{-ms-grid-columns:(1fr)[4];grid-template-columns:repeat(4,1fr)}.ngx-calendar .years-container .year{padding:.475rem}.ngx-calendar .years-container .year:nth-child(4n){border-right:0}"]
        }),
        __metadata("design:paramtypes", [ChangeDetectorRef])
    ], CalendarComponent);
    return CalendarComponent;
}());
export { CalendarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHN3aW1sYW5lL25neC11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2NhbGVuZGFyL2NhbGVuZGFyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixVQUFVLEVBQ1YsTUFBTSxFQUNOLGlCQUFpQixFQUNqQix1QkFBdUIsRUFDdkIsaUJBQWlCLEVBQ2pCLGFBQWEsRUFDZCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXdCLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsT0FBTyxNQUFNLE1BQU0saUJBQWlCLENBQUM7QUFFckMsT0FBTyxFQUFFLFFBQVEsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUd2RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFcEQsSUFBTSx1QkFBdUIsR0FBRztJQUM5QixPQUFPLEVBQUUsaUJBQWlCO0lBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsY0FBTSxPQUFBLGlCQUFpQixFQUFqQixDQUFpQixDQUFDO0lBQ2hELEtBQUssRUFBRSxJQUFJO0NBQ1osQ0FBQztBQWdCRjtJQTJERSwyQkFBNkIsR0FBc0I7UUFBdEIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUF2RDFDLGVBQVUsR0FBYSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBRTNELGlCQUFZLEdBQStDLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBb0IvRixXQUFNLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQXlCNUMsZUFBVSxHQUFHLE1B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QUFLLENBQUMsU0FBUyxDQUFDOzs7b0RBR2hCO0lBT0Q7UUFEQyxLQUFLLENBQUMsYUFBYSxDQUFDOzs7d0RBR3BCO0lBTVM7UUFBVCxNQUFNLEVBQUU7O3FEQUFtQztJQTFCakMsaUJBQWlCO1FBZDdCLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxjQUFjO1lBQ3hCLFFBQVEsRUFBRSxhQUFhO1lBQ3ZCLGkySUFBd0M7WUFFeEMsSUFBSSxFQUFFO2dCQUNKLEtBQUssRUFBRSxjQUFjO2dCQUNyQixRQUFRLEVBQUUsR0FBRztnQkFDYixRQUFRLEVBQUUscUJBQXFCO2FBQ2hDO1lBQ0QsU0FBUyxFQUFFLENBQUMsdUJBQXVCLENBQUM7WUFDcEMsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7WUFDckMsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07O1NBQ2hELENBQUM7eUNBNERrQyxpQkFBaUI7T0EzRHhDLGlCQUFpQixDQXdRN0I7SUFBRCx3QkFBQztDQUFBLEFBeFFELElBd1FDO1NBeFFZLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBmb3J3YXJkUmVmLFxuICBPbkluaXQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIEFmdGVyVmlld0luaXRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250cm9sVmFsdWVBY2Nlc3NvciwgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudC10aW1lem9uZSc7XG5cbmltcG9ydCB7IGdldE1vbnRoLCBnZXREZWNhZGVTdGFydFllYXIgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IENhbGVuZGFyRGF5IH0gZnJvbSAnLi9jYWxlbmRhci1kYXkuaW50ZXJmYWNlJztcbmltcG9ydCB7IENhbGVuZGFyTW9udGggfSBmcm9tICcuL2NhbGVuZGFyLW1vbnRoLnR5cGUnO1xuaW1wb3J0IHsgQ2FsZW5kYXJWaWV3IH0gZnJvbSAnLi9jYWxlbmRhci12aWV3LmVudW0nO1xuXG5jb25zdCBDQUxFTkRBUl9WQUxVRV9BQ0NFU1NPUiA9IHtcbiAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IENhbGVuZGFyQ29tcG9uZW50KSxcbiAgbXVsdGk6IHRydWVcbn07XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25neC1jYWxlbmRhcicsXG4gIGV4cG9ydEFzOiAnbmd4Q2FsZW5kYXInLFxuICB0ZW1wbGF0ZVVybDogJy4vY2FsZW5kYXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9jYWxlbmRhci5jb21wb25lbnQuc2NzcyddLFxuICBob3N0OiB7XG4gICAgY2xhc3M6ICduZ3gtY2FsZW5kYXInLFxuICAgIHRhYmluZGV4OiAnMScsXG4gICAgJyhibHVyKSc6ICdvblRvdWNoZWRDYWxsYmFjaygpJ1xuICB9LFxuICBwcm92aWRlcnM6IFtDQUxFTkRBUl9WQUxVRV9BQ0NFU1NPUl0sXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIENhbGVuZGFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciB7XG4gIEBJbnB1dCgpIG1pbkRhdGU6IERhdGUgfCBzdHJpbmc7XG4gIEBJbnB1dCgpIGRpc2FibGVkOiBib29sZWFuO1xuICBASW5wdXQoKSBtYXhEYXRlOiBEYXRlIHwgc3RyaW5nO1xuICBASW5wdXQoKSBkYXlzT2ZXZWVrOiBzdHJpbmdbXSA9IFsnUycsICdNJywgJ1QnLCAnVycsICdUJywgJ0YnLCAnUyddO1xuICBASW5wdXQoKSB0aW1lem9uZTogc3RyaW5nO1xuICBASW5wdXQoKSBpbnB1dEZvcm1hdHM6IEFycmF5PHN0cmluZyB8IG1vbWVudC5Nb21lbnRCdWlsdGluRm9ybWF0PiA9IFsnTCcsIGBMVGAsICdMIExUJywgbW9tZW50LklTT184NjAxXTtcblxuICBASW5wdXQoJ21pblZpZXcnKVxuICBnZXQgbWluVmlldygpIHtcbiAgICByZXR1cm4gdGhpcy5fbWluVmlldyA/IHRoaXMuX21pblZpZXcgOiBDYWxlbmRhclZpZXcuRGF0ZTtcbiAgfVxuICBzZXQgbWluVmlldyh2YWw6IENhbGVuZGFyVmlldykge1xuICAgIHRoaXMuX21pblZpZXcgPSB2YWw7XG4gICAgdGhpcy52YWxpZGF0ZVZpZXcoKTtcbiAgfVxuXG4gIEBJbnB1dCgnZGVmYXVsdFZpZXcnKVxuICBnZXQgZGVmYXVsdFZpZXcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2RlZmF1bHRWaWV3ID8gdGhpcy5fZGVmYXVsdFZpZXcgOiB0aGlzLm1pblZpZXc7XG4gIH1cbiAgc2V0IGRlZmF1bHRWaWV3KHZhbDogQ2FsZW5kYXJWaWV3KSB7XG4gICAgdGhpcy5fZGVmYXVsdFZpZXcgPSB2YWw7XG4gICAgdGhpcy52YWxpZGF0ZVZpZXcoKTtcbiAgfVxuXG4gIEBPdXRwdXQoKSBjaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGU+KCk7XG5cbiAgZ2V0IHZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuICBzZXQgdmFsdWUodmFsOiBEYXRlKSB7XG4gICAgY29uc3QgZGF0ZSA9IHRoaXMuY3JlYXRlTW9tZW50KHZhbCk7XG5cbiAgICBpZiAoZGF0ZS5pc1ZhbGlkKCkpIHtcbiAgICAgIGlmICghZGF0ZS5pc1NhbWUodGhpcy5fdmFsdWUsICdkYXknKSkge1xuICAgICAgICB0aGlzLl92YWx1ZSA9IHZhbDtcbiAgICAgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrKHRoaXMuX3ZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jaGFuZ2UuZW1pdCh0aGlzLl92YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGN1cnJlbnQoKTogbW9tZW50Lk1vbWVudCB7XG4gICAgcmV0dXJuIHRoaXMuX2N1cnJlbnQ7XG4gIH1cblxuICBhY3RpdmVEYXRlOiBtb21lbnQuTW9tZW50O1xuICB3ZWVrczogQ2FsZW5kYXJNb250aDtcbiAgY3VycmVudFZpZXc6IENhbGVuZGFyVmlldztcbiAgbW9udGhzTGlzdCA9IG1vbWVudC5tb250aHNTaG9ydCgpO1xuICBzdGFydFllYXI6IG51bWJlcjtcblxuICBwcml2YXRlIF92YWx1ZTogRGF0ZTtcbiAgcHJpdmF0ZSBfY3VycmVudDogbW9tZW50Lk1vbWVudDtcbiAgcHJpdmF0ZSBfbWluVmlldzogQ2FsZW5kYXJWaWV3O1xuICBwcml2YXRlIF9kZWZhdWx0VmlldzogQ2FsZW5kYXJWaWV3O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZikge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmFjdGl2ZURhdGUgPSB0aGlzLmNyZWF0ZU1vbWVudCh0aGlzLnZhbHVlKTtcbiAgICB0aGlzLndlZWtzID0gZ2V0TW9udGgodGhpcy5hY3RpdmVEYXRlKTtcbiAgICB0aGlzLm1vbnRoc0xpc3QgPSBtb21lbnQubW9udGhzU2hvcnQoKTtcbiAgICB0aGlzLl9jdXJyZW50ID0gdGhpcy5hY3RpdmVEYXRlO1xuICAgIHRoaXMuc3RhcnRZZWFyID0gZ2V0RGVjYWRlU3RhcnRZZWFyKHRoaXMuX2N1cnJlbnQueWVhcigpKTtcbiAgICB0aGlzLnZhbGlkYXRlVmlldygpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgY2hhbmdlVmlld3MoKSB7XG4gICAgaWYgKHRoaXMuY3VycmVudFZpZXcgPT09IENhbGVuZGFyVmlldy5EYXRlKSB7XG4gICAgICB0aGlzLmN1cnJlbnRWaWV3ID0gQ2FsZW5kYXJWaWV3Lk1vbnRoO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jdXJyZW50VmlldyA9PT0gQ2FsZW5kYXJWaWV3Lk1vbnRoKSB7XG4gICAgICB0aGlzLmN1cnJlbnRWaWV3ID0gQ2FsZW5kYXJWaWV3LlllYXI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY3VycmVudFZpZXcgPSB0aGlzLm1pblZpZXc7XG4gICAgfVxuXG4gICAgdGhpcy53ZWVrcyA9IGdldE1vbnRoKHRoaXMuYWN0aXZlRGF0ZSk7XG4gIH1cblxuICB2YWxpZGF0ZVZpZXcoKSB7XG4gICAgY29uc3Qgdmlld3NMaXN0ID0gW0NhbGVuZGFyVmlldy5EYXRlLCBDYWxlbmRhclZpZXcuTW9udGgsIENhbGVuZGFyVmlldy5ZZWFyXTtcblxuICAgIC8vIGRhdGUgdGltZSBwaWNrZXIgcHJlY2lzaW9uIHZhbGlkYXRpb25cbiAgICBpZiAoIXZpZXdzTGlzdC5pbmNsdWRlcyh0aGlzLm1pblZpZXcpKSB7XG4gICAgICB0aGlzLm1pblZpZXcgPSBDYWxlbmRhclZpZXcuRGF0ZTtcbiAgICB9XG5cbiAgICAvLyBkZWZhdWx0VmlldyBjYW5ub3QgYmUgYmVsb3cgbWluVmlld1xuICAgIGlmICh2aWV3c0xpc3QuaW5kZXhPZih0aGlzLm1pblZpZXcpID4gdmlld3NMaXN0LmluZGV4T2YodGhpcy5kZWZhdWx0VmlldykpIHtcbiAgICAgIHRoaXMuZGVmYXVsdFZpZXcgPSB0aGlzLm1pblZpZXc7XG4gICAgfVxuXG4gICAgdGhpcy5jdXJyZW50VmlldyA9IHRoaXMuZGVmYXVsdFZpZXc7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGBkYXRlYCBtYXRjaGVzIHNlbGVjdGVkIHZhbHVlXG4gICAqL1xuICBpc0RheUFjdGl2ZShkYXRlOiBtb21lbnQuTW9tZW50KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGRhdGUuaXNTYW1lKHRoaXMudmFsdWUsICdkYXknKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYG1vbnRoYCBtYXRjaGVzIHNlbGVjdGVkIHZhbHVlLCBpbiB0aGUgdmlld2VkIHllYXJcbiAgICovXG4gIGlzTW9udGhBY3RpdmUobW9udGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGRhdGUgPSB0aGlzLmNyZWF0ZU1vbWVudCh0aGlzLnZhbHVlKS5tb250aChtb250aCk7XG4gICAgcmV0dXJuIGRhdGUuaXNTYW1lKHRoaXMudmFsdWUsICdtb250aCcpICYmIGRhdGUuaXNTYW1lKHRoaXMuYWN0aXZlRGF0ZSwgJ3llYXInKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgYG1vbnRoYCBhbmQgeWVhciBtYXRjaGVzIGN1cnJlbnRcbiAgICovXG4gIGlzQ3VycmVudE1vbnRoKG1vbnRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBjb25zdCBkYXRlID0gdGhpcy5hY3RpdmVEYXRlLmNsb25lKCkubW9udGgobW9udGgpO1xuICAgIHJldHVybiBkYXRlLmlzU2FtZSh0aGlzLl9jdXJyZW50LCAnbW9udGgnKSAmJiBkYXRlLmlzU2FtZSh0aGlzLl9jdXJyZW50LCAneWVhcicpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBgeWVhcmAgbWF0Y2hlcyBzZWxlY3RlZCB5ZWFyXG4gICAqL1xuICBpc1llYXJBY3RpdmUoeWVhcjogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZGF0ZSA9IHRoaXMuY3JlYXRlTW9tZW50KHRoaXMudmFsdWUpLnllYXIoeWVhcik7XG4gICAgcmV0dXJuIGRhdGUuaXNTYW1lKHRoaXMudmFsdWUsICd5ZWFyJyk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIHllYXIgbWF0Y2hlcyBjdXJyZW50IHllYXJcbiAgICovXG4gIGlzQ3VycmVudFllYXIoeWVhcjogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZGF0ZSA9IHRoaXMuY3JlYXRlTW9tZW50KHRoaXMudmFsdWUpLnllYXIoeWVhcik7XG4gICAgcmV0dXJuIGRhdGUuaXNTYW1lKHRoaXMuX2N1cnJlbnQsICd5ZWFyJyk7XG4gIH1cblxuICBpc0Rpc2FibGVkKHZhbHVlOiBhbnksIHR5cGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmRpc2FibGVkKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoIXZhbHVlKSByZXR1cm4gZmFsc2U7XG5cbiAgICBsZXQgZGF0ZTogbW9tZW50Lk1vbWVudDtcblxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgZGF0ZSA9IHZhbHVlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgZGF0ZSA9IHRoaXMuYWN0aXZlRGF0ZS5jbG9uZSgpLm1vbnRoKHZhbHVlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgZGF0ZSA9IHRoaXMuYWN0aXZlRGF0ZS5jbG9uZSgpLnllYXIodmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBpc0JlZm9yZU1pbiA9IHRoaXMubWluRGF0ZSAmJiBkYXRlLmlzQmVmb3JlKHRoaXMucGFyc2VEYXRlKHRoaXMubWluRGF0ZSksIHR5cGUpO1xuICAgIGNvbnN0IGlzQWZ0ZXJNYXggPSB0aGlzLm1heERhdGUgJiYgZGF0ZS5pc0FmdGVyKHRoaXMucGFyc2VEYXRlKHRoaXMubWF4RGF0ZSksIHR5cGUpO1xuXG4gICAgcmV0dXJuIGlzQmVmb3JlTWluIHx8IGlzQWZ0ZXJNYXg7XG4gIH1cblxuICBvbkRheUNsaWNrKGRheTogQ2FsZW5kYXJEYXkpIHtcbiAgICB0aGlzLmFjdGl2ZURhdGUgPSBkYXkuZGF0ZS5jbG9uZSgpO1xuICAgIHRoaXMudmFsdWUgPSB0aGlzLmFjdGl2ZURhdGUudG9EYXRlKCk7XG5cbiAgICBpZiAoZGF5LnByZXZNb250aCB8fCBkYXkubmV4dE1vbnRoKSB7XG4gICAgICB0aGlzLndlZWtzID0gZ2V0TW9udGgodGhpcy5hY3RpdmVEYXRlKTtcbiAgICB9XG4gIH1cblxuICBvbk1vbnRoQ2xpY2sobW9udGg6IHN0cmluZykge1xuICAgIHRoaXMuYWN0aXZlRGF0ZS5tb250aChtb250aCk7XG4gICAgdGhpcy52YWx1ZSA9IHRoaXMuYWN0aXZlRGF0ZS50b0RhdGUoKTtcblxuICAgIGlmICh0aGlzLm1pblZpZXcgIT09IENhbGVuZGFyVmlldy5Nb250aCkge1xuICAgICAgdGhpcy5jdXJyZW50VmlldyA9IENhbGVuZGFyVmlldy5EYXRlO1xuICAgICAgdGhpcy53ZWVrcyA9IGdldE1vbnRoKHRoaXMuYWN0aXZlRGF0ZSk7XG4gICAgfVxuICB9XG5cbiAgb25ZZWFyQ2xpY2soeWVhcjogbnVtYmVyKSB7XG4gICAgdGhpcy5hY3RpdmVEYXRlLnllYXIoeWVhcik7XG4gICAgdGhpcy52YWx1ZSA9IHRoaXMuYWN0aXZlRGF0ZS50b0RhdGUoKTtcblxuICAgIGlmICh0aGlzLm1pblZpZXcgIT09IENhbGVuZGFyVmlldy5ZZWFyKSB7XG4gICAgICB0aGlzLmN1cnJlbnRWaWV3ID0gQ2FsZW5kYXJWaWV3Lk1vbnRoO1xuICAgICAgdGhpcy53ZWVrcyA9IGdldE1vbnRoKHRoaXMuYWN0aXZlRGF0ZSk7XG4gICAgfVxuICB9XG5cbiAgcHJldk1vbnRoKCkge1xuICAgIGNvbnN0IGRhdGUgPSB0aGlzLmFjdGl2ZURhdGUuY2xvbmUoKTtcbiAgICB0aGlzLmFjdGl2ZURhdGUgPSBkYXRlLnN1YnRyYWN0KDEsICdtb250aCcpO1xuICAgIHRoaXMud2Vla3MgPSBnZXRNb250aCh0aGlzLmFjdGl2ZURhdGUpO1xuICB9XG5cbiAgbmV4dE1vbnRoKCkge1xuICAgIGNvbnN0IGRhdGUgPSB0aGlzLmFjdGl2ZURhdGUuY2xvbmUoKTtcbiAgICB0aGlzLmFjdGl2ZURhdGUgPSBkYXRlLmFkZCgxLCAnbW9udGgnKTtcbiAgICB0aGlzLndlZWtzID0gZ2V0TW9udGgodGhpcy5hY3RpdmVEYXRlKTtcbiAgfVxuXG4gIHByZXZZZWFyKCkge1xuICAgIGNvbnN0IGRhdGUgPSB0aGlzLmFjdGl2ZURhdGUuY2xvbmUoKTtcbiAgICB0aGlzLmFjdGl2ZURhdGUgPSBkYXRlLnN1YnRyYWN0KDEsICd5ZWFyJyk7XG4gIH1cblxuICBuZXh0WWVhcigpIHtcbiAgICBjb25zdCBkYXRlID0gdGhpcy5hY3RpdmVEYXRlLmNsb25lKCk7XG4gICAgdGhpcy5hY3RpdmVEYXRlID0gZGF0ZS5hZGQoMSwgJ3llYXInKTtcbiAgfVxuXG4gIHByZXZUd29EZWNhZGVzKCkge1xuICAgIHRoaXMuc3RhcnRZZWFyID0gdGhpcy5zdGFydFllYXIgLSAyMDtcbiAgfVxuXG4gIG5leHRUd29EZWNhZGVzKCkge1xuICAgIHRoaXMuc3RhcnRZZWFyID0gdGhpcy5zdGFydFllYXIgKyAyMDtcbiAgfVxuXG4gIHdyaXRlVmFsdWUodmFsOiBhbnkpIHtcbiAgICBjb25zdCBhY3RpdmVEYXRlID0gdGhpcy5jcmVhdGVNb21lbnQodmFsKTtcblxuICAgIGlmIChhY3RpdmVEYXRlLmlzVmFsaWQoKSAmJiAhYWN0aXZlRGF0ZS5pc1NhbWUodGhpcy52YWx1ZSwgJ2RheScpKSB7XG4gICAgICB0aGlzLmFjdGl2ZURhdGUgPSBhY3RpdmVEYXRlO1xuICAgICAgdGhpcy53ZWVrcyA9IGdldE1vbnRoKHRoaXMuYWN0aXZlRGF0ZSk7XG4gICAgICB0aGlzLl92YWx1ZSA9IHZhbDtcbiAgICAgIHRoaXMuc3RhcnRZZWFyID0gZ2V0RGVjYWRlU3RhcnRZZWFyKHRoaXMuYWN0aXZlRGF0ZS55ZWFyKCkpO1xuICAgIH1cblxuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjayA9IGZuO1xuICB9XG5cbiAgb25Ub3VjaGVkQ2FsbGJhY2s6ICgpID0+IHZvaWQgPSAoKSA9PiB7XG4gICAgLy8gcGxhY2Vob2xkZXJcbiAgfTtcblxuICBwcml2YXRlIG9uQ2hhbmdlQ2FsbGJhY2s6IChfOiBhbnkpID0+IHZvaWQgPSAoKSA9PiB7XG4gICAgLy8gcGxhY2Vob2xkZXJcbiAgfTtcblxuICBwcml2YXRlIHBhcnNlRGF0ZShkYXRlOiBzdHJpbmcgfCBEYXRlKTogbW9tZW50Lk1vbWVudCB7XG4gICAgZGF0ZSA9IGRhdGUgaW5zdGFuY2VvZiBEYXRlID8gZGF0ZS50b0lTT1N0cmluZygpIDogZGF0ZTtcbiAgICByZXR1cm4gdGhpcy50aW1lem9uZSA/IG1vbWVudC50eihkYXRlLCB0aGlzLmlucHV0Rm9ybWF0cywgdGhpcy50aW1lem9uZSkgOiBtb21lbnQoZGF0ZSwgdGhpcy5pbnB1dEZvcm1hdHMpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVNb21lbnQoZGF0ZTogc3RyaW5nIHwgRGF0ZSB8IG1vbWVudC5Nb21lbnQpOiBtb21lbnQuTW9tZW50IHtcbiAgICBjb25zdCBtID0gbW9tZW50KGRhdGUpLmNsb25lKCk7XG4gICAgcmV0dXJuIHRoaXMudGltZXpvbmUgPyBtLnR6KHRoaXMudGltZXpvbmUpIDogbTtcbiAgfVxufVxuIl19