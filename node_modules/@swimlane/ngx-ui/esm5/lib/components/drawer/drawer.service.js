import { __decorate, __extends, __metadata } from "tslib";
import { Injectable, ComponentRef, Renderer2, RendererFactory2 } from '@angular/core';
import { InjectionService } from '../../services/injection/injection.service';
import { InjectionRegistryService } from '../../services/injection-registry/injection-registry.service';
import { DrawerComponent } from './drawer.component';
import { OverlayService } from '../overlay/overlay.service';
import { DrawerDirection } from './drawer-direction.enum';
var DrawerService = /** @class */ (function (_super) {
    __extends(DrawerService, _super);
    function DrawerService(injectionService, overlayService, rendererFactory) {
        var _this = _super.call(this, injectionService) || this;
        _this.injectionService = injectionService;
        _this.overlayService = overlayService;
        _this.rendererFactory = rendererFactory;
        _this.type = DrawerComponent;
        _this.defaults = {
            inputs: {
                direction: DrawerDirection.Left
            }
        };
        _this.zIndex = 995;
        _this.size = 80;
        _this.renderer = _this.rendererFactory.createRenderer(null, null);
        return _this;
    }
    DrawerService.prototype.create = function (options) {
        var component = _super.prototype.create.call(this, options);
        this.createSubscriptions(component, options.isRoot, options.parentContainer);
        return component;
    };
    DrawerService.prototype.destroy = function (component) {
        var _this = this;
        // race case clicking fast errors here
        if (component && component.instance) {
            component.instance.size = 0;
        }
        setTimeout(function () {
            _this.zIndex = _this.zIndex - 2;
            _this.size = _this.size + 10;
            _this.overlayService.removeTriggerComponent(component);
            _super.prototype.destroy.call(_this, component);
        }, 10);
    };
    DrawerService.prototype.assignDefaults = function (options) {
        options = _super.prototype.assignDefaults.call(this, options);
        if (!options.inputs.zIndex) {
            this.zIndex = this.overlayService.instance
                ? this.overlayService.instance.zIndex + 3
                : /* istanbul ignore next */ this.zIndex + 2;
            options.inputs.zIndex = this.zIndex;
        }
        this.size = this.size - 10;
        if (!options.inputs.size) {
            options.inputs.size = this.size;
        }
        return options;
    };
    DrawerService.prototype.createSubscriptions = function (component, isRoot, parentContainer) {
        var _this = this;
        if (isRoot === void 0) { isRoot = true; }
        if (isRoot) {
            this.overlayService.show({
                triggerComponent: component,
                zIndex: this.zIndex
            });
        }
        var closeSub;
        var overlaySub;
        var kill = function (c) {
            /* istanbul ignore if */
            if (component !== c) {
                return;
            }
            closeSub.unsubscribe();
            if (overlaySub) {
                overlaySub.unsubscribe();
            }
            if (_this.parentListenerFunc && _this.components.get(_this.type).length === 1) {
                _this.parentListenerFunc();
            }
            _this.destroy(component);
        };
        closeSub = component.instance.close.subscribe(kill.bind(this, component));
        if (component.instance.closeOnOutsideClick) {
            if (isRoot) {
                overlaySub = this.overlayService.click.subscribe(kill);
            }
            else {
                var components_1 = this.components.get(this.type);
                this.parentListenerFunc = this.renderer.listen(parentContainer, 'click', function (evt) {
                    /* istanbul ignore else */
                    if (evt.target === parentContainer) {
                        kill(components_1[components_1.length - 1]);
                    }
                });
            }
        }
    };
    DrawerService.ctorParameters = function () { return [
        { type: InjectionService },
        { type: OverlayService },
        { type: RendererFactory2 }
    ]; };
    DrawerService = __decorate([
        Injectable(),
        __metadata("design:paramtypes", [InjectionService,
            OverlayService,
            RendererFactory2])
    ], DrawerService);
    return DrawerService;
}(InjectionRegistryService));
export { DrawerService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ac3dpbWxhbmUvbmd4LXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvZHJhd2VyL2RyYXdlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHdEYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sNENBQTRDLENBQUM7QUFDOUUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sOERBQThELENBQUM7QUFDeEcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFJMUQ7SUFBbUMsaUNBQXlDO0lBYzFFLHVCQUNXLGdCQUFrQyxFQUMxQixjQUE4QixFQUM5QixlQUFpQztRQUhwRCxZQUtFLGtCQUFNLGdCQUFnQixDQUFDLFNBRXhCO1FBTlUsc0JBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUMxQixvQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIscUJBQWUsR0FBZixlQUFlLENBQWtCO1FBaEJwRCxVQUFJLEdBQVEsZUFBZSxDQUFDO1FBRW5CLGNBQVEsR0FBa0I7WUFDakMsTUFBTSxFQUFFO2dCQUNOLFNBQVMsRUFBRSxlQUFlLENBQUMsSUFBSTthQUNoQztTQUNGLENBQUM7UUFHTSxZQUFNLEdBQVcsR0FBRyxDQUFDO1FBQ3JCLFVBQUksR0FBVyxFQUFFLENBQUM7UUFTeEIsS0FBSSxDQUFDLFFBQVEsR0FBRyxLQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7O0lBQ2xFLENBQUM7SUFFRCw4QkFBTSxHQUFOLFVB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USxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUMxRSxJQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUMsbUJBQW1CLEVBQUU7WUFDMUMsSUFBSSxNQUFNLEVBQUU7Z0JBQ1YsVUFBVSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN4RDtpQkFBTTtnQkFDTCxJQUFNLFlBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBRWxELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsT0FBTyxFQUFFLFVBQUEsR0FBRztvQkFDMUUsMEJBQTBCO29CQUMxQixJQUFJLEdBQUcsQ0FBQyxNQUFNLEtBQUssZUFBZSxFQUFFO3dCQUNsQyxJQUFJLENBQUMsWUFBVSxDQUFDLFlBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztxQkFDekM7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7YUFDSjtTQUNGO0lBQ0gsQ0FBQzs7Z0JBeEY0QixnQkFBZ0I7Z0JBQ1YsY0FBYztnQkFDYixnQkFBZ0I7O0lBakJ6QyxhQUFhO1FBRHpCLFVBQVUsRUFBRTt5Q0FnQmtCLGdCQUFnQjtZQUNWLGNBQWM7WUFDYixnQkFBZ0I7T0FqQnpDLGFBQWEsQ0F3R3pCO0lBQUQsb0JBQUM7Q0FBQSxBQXhHRCxDQUFtQyx3QkFBd0IsR0F3RzFEO1NBeEdZLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBDb21wb25lbnRSZWYsIFJlbmRlcmVyMiwgUmVuZGVyZXJGYWN0b3J5MiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IEluamVjdGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9pbmplY3Rpb24vaW5qZWN0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgSW5qZWN0aW9uUmVnaXN0cnlTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvaW5qZWN0aW9uLXJlZ2lzdHJ5L2luamVjdGlvbi1yZWdpc3RyeS5zZXJ2aWNlJztcbmltcG9ydCB7IERyYXdlckNvbXBvbmVudCB9IGZyb20gJy4vZHJhd2VyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBPdmVybGF5U2VydmljZSB9IGZyb20gJy4uL292ZXJsYXkvb3ZlcmxheS5zZXJ2aWNlJztcbmltcG9ydCB7IERyYXdlckRpcmVjdGlvbiB9IGZyb20gJy4vZHJhd2VyLWRpcmVjdGlvbi5lbnVtJztcbmltcG9ydCB7IERyYXdlck9wdGlvbnMgfSBmcm9tICcuL2RyYXdlci1vcHRpb25zLmludGVyZmFjZSc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBEcmF3ZXJTZXJ2aWNlIGV4dGVuZHMgSW5qZWN0aW9uUmVnaXN0cnlTZXJ2aWNlPERyYXdlckNvbXBvbmVudD4ge1xuICB0eXBlOiBhbnkgPSBEcmF3ZXJDb21wb25lbnQ7XG5cbiAgcmVhZG9ubHkgZGVmYXVsdHM6IERyYXdlck9wdGlvbnMgPSB7XG4gICAgaW5wdXRzOiB7XG4gICAgICBkaXJlY3Rpb246IERyYXdlckRpcmVjdGlvbi5MZWZ0XG4gICAgfVxuICB9O1xuXG4gIHJlYWRvbmx5IHJlbmRlcmVyOiBSZW5kZXJlcjI7XG4gIHByaXZhdGUgekluZGV4OiBudW1iZXIgPSA5OTU7XG4gIHByaXZhdGUgc2l6ZTogbnVtYmVyID0gODA7XG4gIHByaXZhdGUgcGFyZW50TGlzdGVuZXJGdW5jOiAoKSA9PiB2b2lkO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHJlYWRvbmx5IGluamVjdGlvblNlcnZpY2U6IEluamVjdGlvblNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBvdmVybGF5U2VydmljZTogT3ZlcmxheVNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSByZW5kZXJlckZhY3Rvcnk6IFJlbmRlcmVyRmFjdG9yeTJcbiAgKSB7XG4gICAgc3VwZXIoaW5qZWN0aW9uU2VydmljZSk7XG4gICAgdGhpcy5yZW5kZXJlciA9IHRoaXMucmVuZGVyZXJGYWN0b3J5LmNyZWF0ZVJlbmRlcmVyKG51bGwsIG51bGwpO1xuICB9XG5cbiAgY3JlYXRlKG9wdGlvbnM6IERyYXdlck9wdGlvbnMpIHtcbiAgICBjb25zdCBjb21wb25lbnQgPSBzdXBlci5jcmVhdGUob3B0aW9ucyk7XG4gICAgdGhpcy5jcmVhdGVTdWJzY3JpcHRpb25zKGNvbXBvbmVudCwgb3B0aW9ucy5pc1Jvb3QsIG9wdGlvbnMucGFyZW50Q29udGFpbmVyKTtcbiAgICByZXR1cm4gY29tcG9uZW50O1xuICB9XG5cbiAgZGVzdHJveShjb21wb25lbnQ6IENvbXBvbmVudFJlZjxEcmF3ZXJDb21wb25lbnQ+KTogdm9pZCB7XG4gICAgLy8gcmFjZSBjYXNlIGNsaWNraW5nIGZhc3QgZXJyb3JzIGhlcmVcbiAgICBpZiAoY29tcG9uZW50ICYmIGNvbXBvbmVudC5pbnN0YW5jZSkge1xuICAgICAgY29tcG9uZW50Lmluc3RhbmNlLnNpemUgPSAwO1xuICAgIH1cblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy56SW5kZXggPSB0aGlzLnpJbmRleCAtIDI7XG4gICAgICB0aGlzLnNpemUgPSB0aGlzLnNpemUgKyAxMDtcbiAgICAgIHRoaXMub3ZlcmxheVNlcnZpY2UucmVtb3ZlVHJpZ2dlckNvbXBvbmVudChjb21wb25lbnQpO1xuICAgICAgc3VwZXIuZGVzdHJveShjb21wb25lbnQpO1xuICAgIH0sIDEwKTtcbiAgfVxuXG4gIGFzc2lnbkRlZmF1bHRzKG9wdGlvbnM6IERyYXdlck9wdGlvbnMpOiBhbnkge1xuICAgIG9wdGlvbnMgPSBzdXBlci5hc3NpZ25EZWZhdWx0cyhvcHRpb25zKTtcblxuICAgIGlmICghb3B0aW9ucy5pbnB1dHMuekluZGV4KSB7XG4gICAgICB0aGlzLnpJbmRleCA9IHRoaXMub3ZlcmxheVNlcnZpY2UuaW5zdGFuY2VcbiAgICAgICAgPyB0aGlzLm92ZXJsYXlTZXJ2aWNlLmluc3RhbmNlLnpJbmRleCArIDNcbiAgICAgICAgOiAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLyB0aGlzLnpJbmRleCArIDI7XG4gICAgICBvcHRpb25zLmlucHV0cy56SW5kZXggPSB0aGlzLnpJbmRleDtcbiAgICB9XG5cbiAgICB0aGlzLnNpemUgPSB0aGlzLnNpemUgLSAxMDtcbiAgICBpZiAoIW9wdGlvbnMuaW5wdXRzLnNpemUpIHtcbiAgICAgIG9wdGlvbnMuaW5wdXRzLnNpemUgPSB0aGlzLnNpemU7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9wdGlvbnM7XG4gIH1cblxuICBjcmVhdGVTdWJzY3JpcHRpb25zKGNvbXBvbmVudDogQ29tcG9uZW50UmVmPERyYXdlckNvbXBvbmVudD4sIGlzUm9vdCA9IHRydWUsIHBhcmVudENvbnRhaW5lcj8pIHtcbiAgICBpZiAoaXNSb290KSB7XG4gICAgICB0aGlzLm92ZXJsYXlTZXJ2aWNlLnNob3coe1xuICAgICAgICB0cmlnZ2VyQ29tcG9uZW50OiBjb21wb25lbnQsXG4gICAgICAgIHpJbmRleDogdGhpcy56SW5kZXhcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGxldCBjbG9zZVN1YjogU3Vic2NyaXB0aW9uO1xuICAgIGxldCBvdmVybGF5U3ViOiBTdWJzY3JpcHRpb247XG5cbiAgICBjb25zdCBraWxsID0gKGM6IENvbXBvbmVudFJlZjxEcmF3ZXJDb21wb25lbnQ+KSA9PiB7XG4gICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi9cbiAgICAgIGlmIChjb21wb25lbnQgIT09IGMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjbG9zZVN1Yi51bnN1YnNjcmliZSgpO1xuICAgICAgaWYgKG92ZXJsYXlTdWIpIHtcbiAgICAgICAgb3ZlcmxheVN1Yi51bnN1YnNjcmliZSgpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMucGFyZW50TGlzdGVuZXJGdW5jICYmIHRoaXMuY29tcG9uZW50cy5nZXQodGhpcy50eXBlKS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgdGhpcy5wYXJlbnRMaXN0ZW5lckZ1bmMoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZGVzdHJveShjb21wb25lbnQpO1xuICAgIH07XG5cbiAgICBjbG9zZVN1YiA9IGNvbXBvbmVudC5pbnN0YW5jZS5jbG9zZS5zdWJzY3JpYmUoa2lsbC5iaW5kKHRoaXMsIGNvbXBvbmVudCkpO1xuICAgIGlmIChjb21wb25lbnQuaW5zdGFuY2UuY2xvc2VPbk91dHNpZGVDbGljaykge1xuICAgICAgaWYgKGlzUm9vdCkge1xuICAgICAgICBvdmVybGF5U3ViID0gdGhpcy5vdmVybGF5U2VydmljZS5jbGljay5zdWJzY3JpYmUoa2lsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjb21wb25lbnRzID0gdGhpcy5jb21wb25lbnRzLmdldCh0aGlzLnR5cGUpO1xuXG4gICAgICAgIHRoaXMucGFyZW50TGlzdGVuZXJGdW5jID0gdGhpcy5yZW5kZXJlci5saXN0ZW4ocGFyZW50Q29udGFpbmVyLCAnY2xpY2snLCBldnQgPT4ge1xuICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovXG4gICAgICAgICAgaWYgKGV2dC50YXJnZXQgPT09IHBhcmVudENvbnRhaW5lcikge1xuICAgICAgICAgICAga2lsbChjb21wb25lbnRzW2NvbXBvbmVudHMubGVuZ3RoIC0gMV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0=