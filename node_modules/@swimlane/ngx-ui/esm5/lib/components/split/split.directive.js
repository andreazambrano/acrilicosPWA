import { __decorate, __metadata, __read } from "tslib";
import { Input, ContentChildren, AfterContentInit, QueryList, ElementRef, Directive, OnChanges } from '@angular/core';
import { SplitAreaDirective } from './split-area.directive';
import { SplitHandleComponent } from './split-handle.component';
import { SplitDirection } from './split-direction.enum';
import { getMinMaxPct } from './get-min-max-pct.util';
import { basisToValue } from './basis-to-value.util';
import { isPercent } from './is-percent.util';
import { resizeAreaBy } from './resize-area-by.util';
var SplitDirective = /** @class */ (function () {
    function SplitDirective(elementRef) {
        this.elementRef = elementRef;
        this.direction = SplitDirection.Row;
    }
    Object.defineProperty(SplitDirective.prototype, "rowCss", {
        get: function () {
            return this.direction === SplitDirection.Row;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitDirective.prototype, "columnCss", {
        get: function () {
            return this.direction === SplitDirection.Column;
        },
        enumerable: true,
        configurable: true
    });
    SplitDirective.prototype.ngAfterContentInit = function () {
        var _this = this;
        this.handles.forEach(function (d) { return d.drag.subscribe(function (ev) { return _this.onDrag(ev); }); });
        this.handles.forEach(function (d) { return d.dblclick.subscribe(function () { return _this.onDblClick(); }); });
        this.updateHandles();
    };
    SplitDirective.prototype.ngOnChanges = function () {
        this.updateHandles();
    };
    SplitDirective.prototype.updateHandles = function () {
        var _this = this;
        if (this.handles) {
            this.handles.forEach(function (d) { return (d.direction = _this.direction); });
        }
    };
    SplitDirective.prototype.onDblClick = function () {
        var basisToPx = (this.rowCss ? this.elementRef.nativeElement.clientWidth : this.elementRef.nativeElement.clientHeight) / 100;
        var area = this.areas.first;
        /* istanbul ignore if */
        if (!area)
            return;
        var _a = __read(area.currentFlexBasis, 3), grow = _a[0], shrink = _a[1], basis = _a[2];
        var isPct = isPercent(basis);
        var basisValue = basisToValue(basis);
        // get basis in px and %
        var basisPx = isPct ? basisValue * basisToPx : basisValue;
        var basisPct = basisPx / basisToPx;
        // get baseBasis in percent
        var baseBasis = area.initialFlexBasis[2];
        var baseBasisPct = basisToValue(baseBasis) / (isPercent(baseBasis) ? basisToPx : 1);
        var _b = __read(getMinMaxPct(area.minBasis, area.maxBasis, grow, shrink, baseBasisPct, basisToPx), 2), minBasisPct = _b[0], maxBasisPct = _b[1];
        // max and min deltas
        var deltaMin = basisPct - minBasisPct;
        var deltaMax = maxBasisPct - basisPct;
        var delta = deltaMin < deltaMax ? deltaMax : -deltaMin;
        var deltaPx = delta * basisToPx;
        this.resize(deltaPx);
    };
    SplitDirective.prototype.onDrag = function (_a) {
        var movementX = _a.movementX, movementY = _a.movementY;
        var deltaPx = this.direction === SplitDirection.Row ? movementX : movementY;
        this.resize(deltaPx);
    };
    SplitDirective.prototype.resize = function (delta) {
        var basisToPx = (this.rowCss ? this.elementRef.nativeElement.clientWidth : this.elementRef.nativeElement.clientHeight) / 100;
        var areas = this.areas.toArray();
        // for now assuming splitter is after first area
        var _a = __read(areas), first = _a[0], rest = _a.slice(1);
        [first].forEach(function (area) { return (delta = resizeAreaBy(area, delta, basisToPx)); });
        // delta is distributed left to right
        rest.forEach(function (area) { return (delta += resizeAreaBy(area, -delta, basisToPx)); });
    };
    SplitDirective.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    __decorate([
        Input('ngxSplit'),
        __metadata("design:type", Object)
    ], SplitDirective.prototype, "direction", void 0);
    __decorate([
        ContentChildren(SplitHandleComponent, { descendants: false }),
        __metadata("design:type", QueryList)
    ], SplitDirective.prototype, "handles", void 0);
    __decorate([
        ContentChildren(SplitAreaDirective, { descendants: false }),
        __metadata("design:type", QueryList)
    ], SplitDirective.prototype, "areas", void 0);
    SplitDirective = __decorate([
        Directive({
            exportAs: 'ngxSplit',
            selector: '[ngxSplit]',
            host: {
                class: 'ngx-split',
                '[class.row-split]': 'rowCss',
                '[class.column-split]': 'columnCss'
            }
        }),
        __metadata("design:paramtypes", [ElementRef])
    ], SplitDirective);
    return SplitDirective;
}());
export { SplitDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BsaXQuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHN3aW1sYW5lL25neC11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3NwbGl0L3NwbGl0LmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXRILE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzVELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN4RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3JELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM5QyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFXckQ7SUFpQkUsd0JBQTZCLFVBQXNCO1FBQXRCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFoQmhDLGNBQVMsR0FBRyxjQUFjLENBQUMsR0FBRyxDQUFDO0lBZ0JJLENBQUM7SUFkdkQsc0JBQUksa0NBQU07YUFBVjtZQUNFLE9BQU8sSUFBSSxDQUFDLFNBQVMsS0FBSyxjQUFjLENBQUMsR0FBRyxDQUFDO1FBQy9DLENBQUM7OztPQUFBO0lBRUQsc0JBQUkscUNBQVM7YUFBYjtZQUNFLE9BQU8sSUFBSSxDQUFDLFNBQVMsS0FBSyxjQUFjLENBQUMsTUFBTSxDQUFDO1FBQ2xELENBQUM7OztPQUFBO0lBVUQsMkNBQWtCLEdBQWxCO1FBQUEsaUJBSUM7UUFIQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQUMsRUFBYyxJQUFLLE9BQUEsS0FBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBZixDQUFlLENBQUMsRUFBckQsQ0FBcUQsQ0FBQyxDQUFDO1FBQ2pGLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsY0FBTSxPQUFBLEtBQUksQ0FBQyxVQUFVLEVBQUUsRUFBakIsQ0FBaUIsQ0FBQyxFQUE3QyxDQUE2QyxDQUFDLENBQUM7UUFDekUsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxvQ0FBVyxHQUFYO1FBQ0UsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxzQ0FBYSxHQUFiO1FBQUEsaUJBSUM7UUFIQyxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDaEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsS0FBSSxDQUFDLFNBQVMsQ0FBQyxFQUE5QixDQUE4QixDQUFDLENBQUM7U0FDM0Q7SUFDSCxDQUFDO0lBRUQsbUNBQVUsR0FBVjtRQUNFLElBQU0sU0FBUyxHQUNiLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsR0FBRyxHQUFHLENBQUM7UUFFL0csSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7UUFFOUIsd0JBQXdCO1FBQ3hCLElBQUksQ0FBQyxJQUFJO1lBQUUsT0FBTztRQUVaLElBQUEscUNBQTZDLEVBQTVDLFlBQUksRUFBRSxjQUFNLEVBQUUsYUFBOEIsQ0FBQztRQUNwRCxJQUFNLEtBQUssR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0IsSUFBTSxVQUFVLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXZDLHdCQUF3QjtRQUN4QixJQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQztRQUM1RCxJQUFNLFFBQVEsR0FBRyxPQUFPLEdBQUcsU0FBUyxDQUFDO1FBRXJDLDJCQUEyQjtRQUMzQixJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0MsSUFBTSxZQUFZLEdBQUcsWUFBWSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRWhGLElBQUEsaUdBT0wsRUFQTSxtQkFBVyxFQUFFLG1CQU9uQixDQUFDO1FBRUYscUJBQXFCO1FBQ3JCLElBQU0sUUFBUSxHQUFHLFFBQVEsR0FBRyxXQUFXLENBQUM7UUFDeEMsSUFBTSxRQUFRLEdBQUcsV0FBVyxHQUFHLFFBQVEsQ0FBQztRQUV4QyxJQUFNLEtBQUssR0FBRyxRQUFRLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO1FBQ3pELElBQU0sT0FBTyxHQUFHLEtBQUssR0FBRyxTQUFTLENBQUM7UUFFbEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN2QixDQUFDO0lBRUQsK0JBQU0sR0FBTixVQUFPLEVBQW9DO1lBQWxDLHdCQUFTLEVBQUUsd0JBQVM7UUFDM0IsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsS0FBSyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUM5RSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7SUFFRCwrQkFBTSxHQUFOLFVBQU8sS0FBYTtRQUNsQixJQUFNLFNBQVMsR0FDYixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBRS9HLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFbkMsZ0RBQWdEO1FBQzFDLElBQUEsa0JBQXdCLEVBQXZCLGFBQUssRUFBRSxrQkFBZ0IsQ0FBQztRQUMvQixDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLENBQUMsS0FBSyxHQUFHLFlBQVksQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDLEVBQTlDLENBQThDLENBQUMsQ0FBQztRQUV4RSxxQ0FBcUM7UUFDckMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLENBQUMsS0FBSyxJQUFJLFlBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUMsRUFBaEQsQ0FBZ0QsQ0FBQyxDQUFDO0lBQ3pFLENBQUM7O2dCQTNFd0MsVUFBVTs7SUFoQmhDO1FBQWxCLEtBQUssQ0FBQyxVQUFVLENBQUM7O3FEQUFnQztJQVdsRDtRQURDLGVBQWUsQ0FBQyxvQkFBb0IsRUFBRSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsQ0FBQztrQ0FDNUMsU0FBUzttREFBdUI7SUFHbEQ7UUFEQyxlQUFlLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLENBQUM7a0NBQzVDLFNBQVM7aURBQXFCO0lBZm5DLGNBQWM7UUFUMUIsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLFVBQVU7WUFDcEIsUUFBUSxFQUFFLFlBQVk7WUFDdEIsSUFBSSxFQUFFO2dCQUNKLEtBQUssRUFBRSxXQUFXO2dCQUNsQixtQkFBbUIsRUFBRSxRQUFRO2dCQUM3QixzQkFBc0IsRUFBRSxXQUFXO2FBQ3BDO1NBQ0YsQ0FBQzt5Q0FrQnlDLFVBQVU7T0FqQnhDLGNBQWMsQ0E2RjFCO0lBQUQscUJBQUM7Q0FBQSxBQTdGRCxJQTZGQztTQTdGWSxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5wdXQsIENvbnRlbnRDaGlsZHJlbiwgQWZ0ZXJDb250ZW50SW5pdCwgUXVlcnlMaXN0LCBFbGVtZW50UmVmLCBEaXJlY3RpdmUsIE9uQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBTcGxpdEFyZWFEaXJlY3RpdmUgfSBmcm9tICcuL3NwbGl0LWFyZWEuZGlyZWN0aXZlJztcbmltcG9ydCB7IFNwbGl0SGFuZGxlQ29tcG9uZW50IH0gZnJvbSAnLi9zcGxpdC1oYW5kbGUuY29tcG9uZW50JztcbmltcG9ydCB7IFNwbGl0RGlyZWN0aW9uIH0gZnJvbSAnLi9zcGxpdC1kaXJlY3Rpb24uZW51bSc7XG5pbXBvcnQgeyBnZXRNaW5NYXhQY3QgfSBmcm9tICcuL2dldC1taW4tbWF4LXBjdC51dGlsJztcbmltcG9ydCB7IGJhc2lzVG9WYWx1ZSB9IGZyb20gJy4vYmFzaXMtdG8tdmFsdWUudXRpbCc7XG5pbXBvcnQgeyBpc1BlcmNlbnQgfSBmcm9tICcuL2lzLXBlcmNlbnQudXRpbCc7XG5pbXBvcnQgeyByZXNpemVBcmVhQnkgfSBmcm9tICcuL3Jlc2l6ZS1hcmVhLWJ5LnV0aWwnO1xuXG5ARGlyZWN0aXZlKHtcbiAgZXhwb3J0QXM6ICduZ3hTcGxpdCcsXG4gIHNlbGVjdG9yOiAnW25neFNwbGl0XScsXG4gIGhvc3Q6IHtcbiAgICBjbGFzczogJ25neC1zcGxpdCcsXG4gICAgJ1tjbGFzcy5yb3ctc3BsaXRdJzogJ3Jvd0NzcycsXG4gICAgJ1tjbGFzcy5jb2x1bW4tc3BsaXRdJzogJ2NvbHVtbkNzcydcbiAgfVxufSlcbmV4cG9ydCBjbGFzcyBTcGxpdERpcmVjdGl2ZSBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIE9uQ2hhbmdlcyB7XG4gIEBJbnB1dCgnbmd4U3BsaXQnKSBkaXJlY3Rpb24gPSBTcGxpdERpcmVjdGlvbi5Sb3c7XG5cbiAgZ2V0IHJvd0NzcygpIHtcbiAgICByZXR1cm4gdGhpcy5kaXJlY3Rpb24gPT09IFNwbGl0RGlyZWN0aW9uLlJvdztcbiAgfVxuXG4gIGdldCBjb2x1bW5Dc3MoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uID09PSBTcGxpdERpcmVjdGlvbi5Db2x1bW47XG4gIH1cblxuICBAQ29udGVudENoaWxkcmVuKFNwbGl0SGFuZGxlQ29tcG9uZW50LCB7IGRlc2NlbmRhbnRzOiBmYWxzZSB9KVxuICByZWFkb25seSBoYW5kbGVzOiBRdWVyeUxpc3Q8U3BsaXRIYW5kbGVDb21wb25lbnQ+O1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oU3BsaXRBcmVhRGlyZWN0aXZlLCB7IGRlc2NlbmRhbnRzOiBmYWxzZSB9KVxuICByZWFkb25seSBhcmVhczogUXVlcnlMaXN0PFNwbGl0QXJlYURpcmVjdGl2ZT47XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7fVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmhhbmRsZXMuZm9yRWFjaChkID0+IGQuZHJhZy5zdWJzY3JpYmUoKGV2OiBNb3VzZUV2ZW50KSA9PiB0aGlzLm9uRHJhZyhldikpKTtcbiAgICB0aGlzLmhhbmRsZXMuZm9yRWFjaChkID0+IGQuZGJsY2xpY2suc3Vic2NyaWJlKCgpID0+IHRoaXMub25EYmxDbGljaygpKSk7XG4gICAgdGhpcy51cGRhdGVIYW5kbGVzKCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcygpIHtcbiAgICB0aGlzLnVwZGF0ZUhhbmRsZXMoKTtcbiAgfVxuXG4gIHVwZGF0ZUhhbmRsZXMoKSB7XG4gICAgaWYgKHRoaXMuaGFuZGxlcykge1xuICAgICAgdGhpcy5oYW5kbGVzLmZvckVhY2goZCA9PiAoZC5kaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbikpO1xuICAgIH1cbiAgfVxuXG4gIG9uRGJsQ2xpY2soKTogdm9pZCB7XG4gICAgY29uc3QgYmFzaXNUb1B4ID1cbiAgICAgICh0aGlzLnJvd0NzcyA/IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoIDogdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2xpZW50SGVpZ2h0KSAvIDEwMDtcblxuICAgIGNvbnN0IGFyZWEgPSB0aGlzLmFyZWFzLmZpcnN0O1xuXG4gICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovXG4gICAgaWYgKCFhcmVhKSByZXR1cm47XG5cbiAgICBjb25zdCBbZ3Jvdywgc2hyaW5rLCBiYXNpc10gPSBhcmVhLmN1cnJlbnRGbGV4QmFzaXM7XG4gICAgY29uc3QgaXNQY3QgPSBpc1BlcmNlbnQoYmFzaXMpO1xuICAgIGNvbnN0IGJhc2lzVmFsdWUgPSBiYXNpc1RvVmFsdWUoYmFzaXMpO1xuXG4gICAgLy8gZ2V0IGJhc2lzIGluIHB4IGFuZCAlXG4gICAgY29uc3QgYmFzaXNQeCA9IGlzUGN0ID8gYmFzaXNWYWx1ZSAqIGJhc2lzVG9QeCA6IGJhc2lzVmFsdWU7XG4gICAgY29uc3QgYmFzaXNQY3QgPSBiYXNpc1B4IC8gYmFzaXNUb1B4O1xuXG4gICAgLy8gZ2V0IGJhc2VCYXNpcyBpbiBwZXJjZW50XG4gICAgY29uc3QgYmFzZUJhc2lzID0gYXJlYS5pbml0aWFsRmxleEJhc2lzWzJdO1xuICAgIGNvbnN0IGJhc2VCYXNpc1BjdCA9IGJhc2lzVG9WYWx1ZShiYXNlQmFzaXMpIC8gKGlzUGVyY2VudChiYXNlQmFzaXMpID8gYmFzaXNUb1B4IDogMSk7XG5cbiAgICBjb25zdCBbbWluQmFzaXNQY3QsIG1heEJhc2lzUGN0XSA9IGdldE1pbk1heFBjdChcbiAgICAgIGFyZWEubWluQmFzaXMsXG4gICAgICBhcmVhLm1heEJhc2lzLFxuICAgICAgZ3JvdyxcbiAgICAgIHNocmluayxcbiAgICAgIGJhc2VCYXNpc1BjdCxcbiAgICAgIGJhc2lzVG9QeFxuICAgICk7XG5cbiAgICAvLyBtYXggYW5kIG1pbiBkZWx0YXNcbiAgICBjb25zdCBkZWx0YU1pbiA9IGJhc2lzUGN0IC0gbWluQmFzaXNQY3Q7XG4gICAgY29uc3QgZGVsdGFNYXggPSBtYXhCYXNpc1BjdCAtIGJhc2lzUGN0O1xuXG4gICAgY29uc3QgZGVsdGEgPSBkZWx0YU1pbiA8IGRlbHRhTWF4ID8gZGVsdGFNYXggOiAtZGVsdGFNaW47XG4gICAgY29uc3QgZGVsdGFQeCA9IGRlbHRhICogYmFzaXNUb1B4O1xuXG4gICAgdGhpcy5yZXNpemUoZGVsdGFQeCk7XG4gIH1cblxuICBvbkRyYWcoeyBtb3ZlbWVudFgsIG1vdmVtZW50WSB9OiBNb3VzZUV2ZW50KTogdm9pZCB7XG4gICAgY29uc3QgZGVsdGFQeCA9IHRoaXMuZGlyZWN0aW9uID09PSBTcGxpdERpcmVjdGlvbi5Sb3cgPyBtb3ZlbWVudFggOiBtb3ZlbWVudFk7XG4gICAgdGhpcy5yZXNpemUoZGVsdGFQeCk7XG4gIH1cblxuICByZXNpemUoZGVsdGE6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IGJhc2lzVG9QeCA9XG4gICAgICAodGhpcy5yb3dDc3MgPyB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aCA6IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodCkgLyAxMDA7XG5cbiAgICBjb25zdCBhcmVhcyA9IHRoaXMuYXJlYXMudG9BcnJheSgpO1xuXG4gICAgLy8gZm9yIG5vdyBhc3N1bWluZyBzcGxpdHRlciBpcyBhZnRlciBmaXJzdCBhcmVhXG4gICAgY29uc3QgW2ZpcnN0LCAuLi5yZXN0XSA9IGFyZWFzO1xuICAgIFtmaXJzdF0uZm9yRWFjaChhcmVhID0+IChkZWx0YSA9IHJlc2l6ZUFyZWFCeShhcmVhLCBkZWx0YSwgYmFzaXNUb1B4KSkpO1xuXG4gICAgLy8gZGVsdGEgaXMgZGlzdHJpYnV0ZWQgbGVmdCB0byByaWdodFxuICAgIHJlc3QuZm9yRWFjaChhcmVhID0+IChkZWx0YSArPSByZXNpemVBcmVhQnkoYXJlYSwgLWRlbHRhLCBiYXNpc1RvUHgpKSk7XG4gIH1cbn1cbiJdfQ==