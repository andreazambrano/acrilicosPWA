import { __assign, __decorate, __extends, __metadata } from "tslib";
import { Component, ContentChildren, QueryList, Input, ViewEncapsulation, ChangeDetectionStrategy, ViewChild, TemplateRef } from '@angular/core';
import { JsonEditorNodeFlatComponent } from './json-editor-node-flat/json-editor-node-flat.component';
import { SchemaValidatorService } from '../schema-validator.service';
import { JsonEditor } from '../json-editor';
import { jsonSchemaDataFormats } from '../json-editor.helper';
import { DialogService } from '../../dialog/dialog.service';
var JsonEditorFlatComponent = /** @class */ (function (_super) {
    __extends(JsonEditorFlatComponent, _super);
    function JsonEditorFlatComponent(dialogService, schemaValidatorService) {
        var _this = _super.call(this, schemaValidatorService) || this;
        _this.dialogService = dialogService;
        _this.schemaValidatorService = schemaValidatorService;
        _this.schemaBuilderMode = false;
        _this.formats = [];
        _this.compressed = false;
        _this.hideRoot = false;
        _this.customFormats = [];
        return _this;
    }
    JsonEditorFlatComponent.prototype.ngOnInit = function () {
        this.schemaRef = JSON.parse(JSON.stringify(this.schema));
        if (this.formats.length && this.schemaBuilderMode) {
            this.buildCustomFormats();
        }
    };
    JsonEditorFlatComponent.prototype.onPropertyConfig = function () {
        this.dialogService.create({
            template: this.propertyConfigTmpl,
            context: {
                property: this.schema,
                schema: this.schema,
                formats: this.customFormats
            },
            class: 'property-config-dialog'
        });
    };
    JsonEditorFlatComponent.prototype.updateSchema = function (options) {
        var editedSchema = options.newProperty;
        if (editedSchema.title) {
            this.schema.title = editedSchema.title;
            this.schemaRef.title = editedSchema.title;
        }
        else {
            delete this.schema.title;
            delete this.schemaRef.title;
        }
        if (editedSchema.description) {
            this.schema.description = editedSchema.description;
            this.schemaRef.description = editedSchema.description;
        }
        else {
            delete this.schema.description;
            delete this.schemaRef.description;
        }
        this.schema = __assign({}, this.schema);
        this.schemaRef = __assign({}, this.schemaRef);
        this.schemaChange.emit(this.schemaRef);
    };
    JsonEditorFlatComponent.prototype.buildCustomFormats = function () {
        var _this = this;
        this.formats.forEach(function (format) {
            var found = jsonSchemaDataFormats.find(function (dataFormat) {
                return dataFormat.schema.format === format;
            });
            if (found) {
                _this.customFormats.push(found);
            }
            else {
                _this.customFormats.push({
                    name: format.charAt(0).toUpperCase() + format.slice(1),
                    defaultValue: function () { return ''; },
                    schema: {
                        type: 'string',
                        format: format
                    },
                    icon: 'field-text',
                    matchType: function () {
                        return false;
                    }
                });
            }
        });
    };
    JsonEditorFlatComponent.ctorParameters = function () { return [
        { type: DialogService },
        { type: SchemaValidatorService }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], JsonEditorFlatComponent.prototype, "model", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], JsonEditorFlatComponent.prototype, "schema", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], JsonEditorFlatComponent.prototype, "typeCheckOverrides", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], JsonEditorFlatComponent.prototype, "schemaBuilderMode", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], JsonEditorFlatComponent.prototype, "formats", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], JsonEditorFlatComponent.prototype, "compressed", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], JsonEditorFlatComponent.prototype, "hideRoot", void 0);
    __decorate([
        ContentChildren(JsonEditorNodeFlatComponent),
        __metadata("design:type", QueryList)
    ], JsonEditorFlatComponent.prototype, "nodeElms", void 0);
    __decorate([
        ViewChild('propertyConfigTmpl'),
        __metadata("design:type", TemplateRef)
    ], JsonEditorFlatComponent.prototype, "propertyConfigTmpl", void 0);
    JsonEditorFlatComponent = __decorate([
        Component({
            selector: 'ngx-json-editor-flat',
            template: "<div class=\"ngx-json-editor-flat\">\n  <ngx-json-editor-node-flat\n    [(model)]=\"model\"\n    [schema]=\"schema\"\n    [hideRoot]=\"hideRoot\"\n    [schemaRef]=\"schemaRef\"\n    (modelChange)=\"modelChangedCallback($event)\"\n    [errors]=\"errors\"\n    [typeCheckOverrides]=\"typeCheckOverrides\"\n    [label]=\"label\"\n    [compressed]=\"compressed\"\n    [formats]=\"customFormats\"\n    [schemaBuilderMode]=\"schemaBuilderMode\"\n    (schemaChange)=\"schemaChange.emit($event)\"\n  >\n    <div class=\"node-options\" node-options>\n      <button *ngIf=\"schemaBuilderMode\" type=\"button\" class=\"node-options-btn\" (click)=\"onPropertyConfig()\">\n        <i class=\"ngx-icon ngx-cog\"></i>\n      </button>\n    </div>\n  </ngx-json-editor-node-flat>\n</div>\n\n<!-- Property Config Dialog -->\n<ng-template #propertyConfigTmpl let-context=\"context\">\n  <ngx-property-config\n    [property]=\"context.property\"\n    [schema]=\"context.schema\"\n    [formats]=\"context.formats\"\n    [rootItem]=\"true\"\n    (updateSchema)=\"updateSchema($event)\"\n  >\n  </ngx-property-config>\n</ng-template>\n",
            changeDetection: ChangeDetectionStrategy.OnPush,
            encapsulation: ViewEncapsulation.None,
            styles: [".ngx-json-editor-flat{position:relative}.ngx-json-editor-flat .node-options .node-options-btn{color:#72819f;padding:1px 3px 2px}.ngx-json-editor-flat .node-options .ngx-dropdown{margin-left:10px}.property-config-dialog .ngx-dialog-content{padding:0!important;min-width:500px!important}"]
        }),
        __metadata("design:paramtypes", [DialogService, SchemaValidatorService])
    ], JsonEditorFlatComponent);
    return JsonEditorFlatComponent;
}(JsonEditor));
export { JsonEditorFlatComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianNvbi1lZGl0b3ItZmxhdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ac3dpbWxhbmUvbmd4LXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvanNvbi1lZGl0b3IvanNvbi1lZGl0b3ItZmxhdC9qc29uLWVkaXRvci1mbGF0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxlQUFlLEVBQ2YsU0FBUyxFQUNULEtBQUssRUFDTCxpQkFBaUIsRUFDakIsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxXQUFXLEVBQ1osTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0seURBQXlELENBQUM7QUFDdEcsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDckUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBd0MscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNwRyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFhNUQ7SUFBNkMsMkNBQVU7SUF1QnJELGlDQUFvQixhQUE0QixFQUFZLHNCQUE4QztRQUExRyxZQUNFLGtCQUFNLHNCQUFzQixDQUFDLFNBQzlCO1FBRm1CLG1CQUFhLEdBQWIsYUFBYSxDQUFlO1FBQVksNEJBQXNCLEdBQXRCLHNCQUFzQixDQUF3QjtRQWhCakcsdUJBQWlCLEdBQWEsS0FBSyxDQUFDO1FBRXBDLGFBQU8sR0FBYyxFQUFFLENBQUM7UUFFeEIsZ0JBQVUsR0FBRyxLQUFLLENBQUM7UUFFbkIsY0FBUSxHQUFHLEtBQUssQ0FBQztRQVExQixtQkFBYSxHQUF5QixFQUFFLENBQUM7O0lBSXpDLENBQUM7SUFFRCwwQ0FBUSxHQUFSO1FBQ0UsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FB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SUF0QmpHO1FBQVIsS0FBSyxFQUFFOzswREFBWTtJQUVYO1FBQVIsS0FBSyxFQUFFOzsyREFBMEI7SUFFekI7UUFBUixLQUFLLEVBQUU7O3VFQUEwQjtJQUV6QjtRQUFSLEtBQUssRUFBRTs7c0VBQXFDO0lBRXBDO1FBQVIsS0FBSyxFQUFFOzs0REFBeUI7SUFFeEI7UUFBUixLQUFLLEVBQUU7OytEQUFvQjtJQUVuQjtRQUFSLEtBQUssRUFBRTs7NkRBQWtCO0lBRW9CO1FBQTdDLGVBQWUsQ0FBQywyQkFBMkIsQ0FBQztrQ0FBVyxTQUFTOzZEQUE4QjtJQUU5RDtRQUFoQyxTQUFTLENBQUMsb0JBQW9CLENBQUM7a0NBQXFCLFdBQVc7dUVBQTBCO0lBakIvRSx1QkFBdUI7UUFQbkMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLHNCQUFzQjtZQUNoQyxxbUNBQWdEO1lBRWhELGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO1lBQy9DLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOztTQUN0QyxDQUFDO3lDQXdCbUMsYUFBYSxFQUFvQyxzQkFBc0I7T0F2Qi9GLHVCQUF1QixDQWdHbkM7SUFBRCw4QkFBQztDQUFBLEFBaEdELENBQTZDLFVBQVUsR0FnR3REO1NBaEdZLHVCQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBRdWVyeUxpc3QsXG4gIElucHV0LFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIFZpZXdDaGlsZCxcbiAgVGVtcGxhdGVSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBKc29uRWRpdG9yTm9kZUZsYXRDb21wb25lbnQgfSBmcm9tICcuL2pzb24tZWRpdG9yLW5vZGUtZmxhdC9qc29uLWVkaXRvci1ub2RlLWZsYXQuY29tcG9uZW50JztcbmltcG9ydCB7IFNjaGVtYVZhbGlkYXRvclNlcnZpY2UgfSBmcm9tICcuLi9zY2hlbWEtdmFsaWRhdG9yLnNlcnZpY2UnO1xuaW1wb3J0IHsgSnNvbkVkaXRvciB9IGZyb20gJy4uL2pzb24tZWRpdG9yJztcbmltcG9ydCB7IEpTT05FZGl0b3JTY2hlbWEsIEpzb25TY2hlbWFEYXRhVHlwZSwganNvblNjaGVtYURhdGFGb3JtYXRzIH0gZnJvbSAnLi4vanNvbi1lZGl0b3IuaGVscGVyJztcbmltcG9ydCB7IERpYWxvZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9kaWFsb2cvZGlhbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgUHJvcGVydHlDb25maWdDb21wb25lbnQsXG4gIFByb3BlcnR5Q29uZmlnT3B0aW9uc1xufSBmcm9tICcuL2pzb24tZWRpdG9yLW5vZGUtZmxhdC9ub2RlLXR5cGVzL3Byb3BlcnR5LWNvbmZpZy9wcm9wZXJ0eS1jb25maWcuY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LWpzb24tZWRpdG9yLWZsYXQnLFxuICB0ZW1wbGF0ZVVybDogJy4vanNvbi1lZGl0b3ItZmxhdC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2pzb24tZWRpdG9yLWZsYXQuY29tcG9uZW50LnNjc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgSnNvbkVkaXRvckZsYXRDb21wb25lbnQgZXh0ZW5kcyBKc29uRWRpdG9yIHtcbiAgQElucHV0KCkgbW9kZWw6IGFueTtcblxuICBASW5wdXQoKSBzY2hlbWE6IEpTT05FZGl0b3JTY2hlbWE7XG5cbiAgQElucHV0KCkgdHlwZUNoZWNrT3ZlcnJpZGVzPzogYW55O1xuXG4gIEBJbnB1dCgpIHNjaGVtYUJ1aWxkZXJNb2RlPzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpIGZvcm1hdHM/OiBzdHJpbmdbXSA9IFtdO1xuXG4gIEBJbnB1dCgpIGNvbXByZXNzZWQgPSBmYWxzZTtcblxuICBASW5wdXQoKSBoaWRlUm9vdCA9IGZhbHNlO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oSnNvbkVkaXRvck5vZGVGbGF0Q29tcG9uZW50KSBub2RlRWxtczogUXVlcnlMaXN0PEpzb25FZGl0b3JOb2RlRmxhdENvbXBvbmVudD47XG5cbiAgQFZpZXdDaGlsZCgncHJvcGVydHlDb25maWdUbXBsJykgcHJvcGVydHlDb25maWdUbXBsOiBUZW1wbGF0ZVJlZjxQcm9wZXJ0eUNvbmZpZ0NvbXBvbmVudD47XG5cbiAgc2NoZW1hUmVmOiBKU09ORWRpdG9yU2NoZW1hO1xuXG4gIGN1c3RvbUZvcm1hdHM6IEpzb25TY2hlbWFEYXRhVHlwZVtdID0gW107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBkaWFsb2dTZXJ2aWNlOiBEaWFsb2dTZXJ2aWNlLCBwcm90ZWN0ZWQgc2NoZW1hVmFsaWRhdG9yU2VydmljZTogU2NoZW1hVmFsaWRhdG9yU2VydmljZSkge1xuICAgIHN1cGVyKHNjaGVtYVZhbGlkYXRvclNlcnZpY2UpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5zY2hlbWFSZWYgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuc2NoZW1hKSk7XG5cbiAgICBpZiAodGhpcy5mb3JtYXRzLmxlbmd0aCAmJiB0aGlzLnNjaGVtYUJ1aWxkZXJNb2RlKSB7XG4gICAgICB0aGlzLmJ1aWxkQ3VzdG9tRm9ybWF0cygpO1xuICAgIH1cbiAgfVxuXG4gIG9uUHJvcGVydHlDb25maWcoKTogdm9pZCB7XG4gICAgdGhpcy5kaWFsb2dTZXJ2aWNlLmNyZWF0ZSh7XG4gICAgICB0ZW1wbGF0ZTogdGhpcy5wcm9wZXJ0eUNvbmZpZ1RtcGwsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIHByb3BlcnR5OiB0aGlzLnNjaGVtYSxcbiAgICAgICAgc2NoZW1hOiB0aGlzLnNjaGVtYSxcbiAgICAgICAgZm9ybWF0czogdGhpcy5jdXN0b21Gb3JtYXRzXG4gICAgICB9LFxuICAgICAgY2xhc3M6ICdwcm9wZXJ0eS1jb25maWctZGlhbG9nJ1xuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlU2NoZW1hKG9wdGlvbnM6IFByb3BlcnR5Q29uZmlnT3B0aW9ucyk6IHZvaWQge1xuICAgIGNvbnN0IGVkaXRlZFNjaGVtYSA9IG9wdGlvbnMubmV3UHJvcGVydHk7XG5cbiAgICBpZiAoZWRpdGVkU2NoZW1hLnRpdGxlKSB7XG4gICAgICB0aGlzLnNjaGVtYS50aXRsZSA9IGVkaXRlZFNjaGVtYS50aXRsZTtcbiAgICAgIHRoaXMuc2NoZW1hUmVmLnRpdGxlID0gZWRpdGVkU2NoZW1hLnRpdGxlO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZWxldGUgdGhpcy5zY2hlbWEudGl0bGU7XG4gICAgICBkZWxldGUgdGhpcy5zY2hlbWFSZWYudGl0bGU7XG4gICAgfVxuXG4gICAgaWYgKGVkaXRlZFNjaGVtYS5kZXNjcmlwdGlvbikge1xuICAgICAgdGhpcy5zY2hlbWEuZGVzY3JpcHRpb24gPSBlZGl0ZWRTY2hlbWEuZGVzY3JpcHRpb247XG4gICAgICB0aGlzLnNjaGVtYVJlZi5kZXNjcmlwdGlvbiA9IGVkaXRlZFNjaGVtYS5kZXNjcmlwdGlvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgZGVsZXRlIHRoaXMuc2NoZW1hLmRlc2NyaXB0aW9uO1xuICAgICAgZGVsZXRlIHRoaXMuc2NoZW1hUmVmLmRlc2NyaXB0aW9uO1xuICAgIH1cblxuICAgIHRoaXMuc2NoZW1hID0geyAuLi50aGlzLnNjaGVtYSB9O1xuICAgIHRoaXMuc2NoZW1hUmVmID0geyAuLi50aGlzLnNjaGVtYVJlZiB9O1xuXG4gICAgdGhpcy5zY2hlbWFDaGFuZ2UuZW1pdCh0aGlzLnNjaGVtYVJlZik7XG4gIH1cblxuICBwcml2YXRlIGJ1aWxkQ3VzdG9tRm9ybWF0cygpOiB2b2lkIHtcbiAgICB0aGlzLmZvcm1hdHMuZm9yRWFjaChmb3JtYXQgPT4ge1xuICAgICAgY29uc3QgZm91bmQgPSBqc29uU2NoZW1hRGF0YUZvcm1hdHMuZmluZCgoZGF0YUZvcm1hdDogSnNvblNjaGVtYURhdGFUeXBlKSA9PiB7XG4gICAgICAgIHJldHVybiBkYXRhRm9ybWF0LnNjaGVtYS5mb3JtYXQgPT09IGZvcm1hdDtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgdGhpcy5jdXN0b21Gb3JtYXRzLnB1c2goZm91bmQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jdXN0b21Gb3JtYXRzLnB1c2goe1xuICAgICAgICAgIG5hbWU6IGZvcm1hdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGZvcm1hdC5zbGljZSgxKSxcbiAgICAgICAgICBkZWZhdWx0VmFsdWU6ICgpID0+ICcnLFxuICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICBmb3JtYXRcbiAgICAgICAgICB9LFxuICAgICAgICAgIGljb246ICdmaWVsZC10ZXh0JyxcbiAgICAgICAgICBtYXRjaFR5cGU6ICgpOiBib29sZWFuID0+IHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iXX0=