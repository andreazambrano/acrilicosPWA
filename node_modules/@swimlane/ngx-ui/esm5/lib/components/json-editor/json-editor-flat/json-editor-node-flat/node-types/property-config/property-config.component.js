import { __decorate, __metadata } from "tslib";
import { Component, Input, EventEmitter, Output, ViewEncapsulation, ChangeDetectionStrategy } from '@angular/core';
import { DialogService } from '../../../../../dialog/dialog.service';
import { propTypes } from '../../../../json-editor.helper';
var PropertyConfigComponent = /** @class */ (function () {
    function PropertyConfigComponent(dialogService) {
        this.dialogService = dialogService;
        this.formats = [];
        this.arrayItem = false;
        this.rootItem = false;
        this.updateSchema = new EventEmitter();
        this.propTypes = propTypes;
        this.required = false;
        this.newEnumValue = '';
    }
    PropertyConfigComponent.prototype.ngOnInit = function () {
        this.editableProperty = JSON.parse(JSON.stringify(this.property));
        if (!this.arrayItem) {
            this.setRequired();
        }
    };
    PropertyConfigComponent.prototype.applyChanges = function () {
        this.dialogService.destroyAll();
        this.updateSchema.emit({
            required: this.required,
            index: this.index,
            newProperty: this.editableProperty,
            oldProperty: this.property
        });
    };
    PropertyConfigComponent.prototype.updateType = function (type) {
        if (this.editableProperty['type'] !== type) {
            this.editableProperty['type'] = type;
            delete this.editableProperty['format'];
            this.cleanUpPropertyConstrains();
        }
    };
    PropertyConfigComponent.prototype.updateExamples = function (examples) {
        if (examples && examples.length) {
            this.editableProperty['examples'] = examples;
        }
        else {
            delete this.editableProperty.examples;
        }
    };
    PropertyConfigComponent.prototype.updateFormat = function (format) {
        if (this.editableProperty['format'] !== format) {
            this.editableProperty['type'] = 'string';
            this.editableProperty['format'] = format;
            this.cleanUpPropertyConstrains();
        }
    };
    PropertyConfigComponent.prototype.addEnumValue = function () {
        var enumValues = (this.editableProperty['enum'] = this.editableProperty['enum'] || []);
        if (!enumValues.includes(this.newEnumValue)) {
            enumValues.push(this.newEnumValue);
            this.newEnumValue = '';
            delete this.editableProperty['format'];
        }
    };
    PropertyConfigComponent.prototype.updateDefault = function (enumValue) {
        if (!enumValue) {
            delete this.editableProperty['default'];
        }
        else {
            this.editableProperty['default'] = enumValue;
        }
    };
    PropertyConfigComponent.prototype.removeEnumValue = function (val) {
        var enumValues = this.editableProperty['enum'];
        var index = enumValues.indexOf(val);
        if (index > -1) {
            enumValues.splice(index, 1);
        }
        if (!enumValues.length) {
            // Remove enum property if empty
            delete this.editableProperty['enum'];
        }
    };
    PropertyConfigComponent.prototype.cleanUpPropertyConstrains = function () {
        delete this.editableProperty['enum'];
        delete this.editableProperty['properties'];
        delete this.editableProperty['required'];
        delete this.editableProperty['items'];
        delete this.editableProperty['minimum'];
        delete this.editableProperty['maximum'];
        delete this.editableProperty['default'];
        delete this.editableProperty['minLength'];
        delete this.editableProperty['maxLength'];
        delete this.editableProperty['minItems'];
        delete this.editableProperty['maxItems'];
    };
    PropertyConfigComponent.prototype.setRequired = function () {
        this.required = this.schema.required.includes(this.property.propertyName);
    };
    PropertyConfigComponent.ctorParameters = function () { return [
        { type: DialogService }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], PropertyConfigComponent.prototype, "property", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Number)
    ], PropertyConfigComponent.prototype, "index", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], PropertyConfigComponent.prototype, "schema", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], PropertyConfigComponent.prototype, "formats", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], PropertyConfigComponent.prototype, "arrayItem", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], PropertyConfigComponent.prototype, "rootItem", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], PropertyConfigComponent.prototype, "updateSchema", void 0);
    PropertyConfigComponent = __decorate([
        Component({
            selector: 'ngx-property-config',
            template: "<div class=\"property-config\">\n  <div class=\"header\">\n    <span>Property Configuration</span>\n    <button type=\"button\" class=\"btn btn-primary\" (click)=\"applyChanges()\">\n      <i class=\"ngx-icon ngx-check has-text\"></i> Apply\n    </button>\n  </div>\n  <ngx-tabs *ngIf=\"property\">\n    <ngx-tab label=\"GENERAL\">\n      <!-- PROPERTY NAME -->\n      <ngx-input\n        *ngIf=\"!arrayItem && !rootItem\"\n        type=\"text\"\n        name=\"propertyName\"\n        [(ngModel)]=\"editableProperty.propertyName\"\n        [label]=\"'PROPERTY NAME'\"\n        [required]=\"true\"\n        [hint]=\"'Must only contain A-Z, a-z, 0-9 or _'\"\n      >\n      </ngx-input>\n\n      <!-- TITLE -->\n      <ngx-input\n        *ngIf=\"!arrayItem\"\n        type=\"text\"\n        [(ngModel)]=\"editableProperty.title\"\n        [label]=\"'PROPERTY TITLE'\"\n        [hint]=\"'A human-readable name for this property'\"\n      >\n      </ngx-input>\n\n      <!-- DESCRIPTION -->\n      <ngx-input\n        *ngIf=\"!arrayItem\"\n        type=\"text\"\n        [(ngModel)]=\"editableProperty.description\"\n        [label]=\"'PROPERTY DESCRIPTION'\"\n        [hint]=\"'A description for the property'\"\n      >\n      </ngx-input>\n\n      <ng-container *ngIf=\"!rootItem\">\n        <!-- TYPE -->\n        <ngx-select\n          class=\"prop-types-formats\"\n          [filterable]=\"false\"\n          [ngModel]=\"[editableProperty.type]\"\n          (ngModelChange)=\"updateType($event[0])\"\n          [required]=\"true\"\n          [label]=\"'TYPE'\"\n        >\n          <ngx-select-option *ngFor=\"let propType of propTypes\" [name]=\"propType\" [value]=\"propType\">\n          </ngx-select-option>\n        </ngx-select>\n\n        <!-- FORMAT -->\n        <ngx-select\n          class=\"prop-types-formats\"\n          *ngIf=\"editableProperty.type === 'string' && formats?.length && !editableProperty.enum?.length\"\n          [filterable]=\"false\"\n          [ngModel]=\"[editableProperty.format]\"\n          (ngModelChange)=\"updateFormat($event[0])\"\n          [label]=\"'FORMAT'\"\n        >\n          <ngx-select-option\n            *ngFor=\"let propFormat of formats\"\n            [name]=\"propFormat.name\"\n            [value]=\"propFormat.schema.format\"\n          >\n          </ngx-select-option>\n        </ngx-select>\n\n        <!-- ENUM -->\n        <ngx-input\n          *ngIf=\"editableProperty.type === 'string' && !editableProperty.format\"\n          type=\" text\"\n          class=\"new-enum-input\"\n          [(ngModel)]=\"newEnumValue\"\n          [label]=\"'ADD ENUM VALUE'\"\n        >\n          <ngx-input-suffix>\n            <button (click)=\"addEnumValue()\" [disabled]=\"!newEnumValue.length\">\n              <i class=\"ngx-icon ngx-ngx-icon ngx-check\"></i>\n            </button>\n          </ngx-input-suffix>\n        </ngx-input>\n\n        <ng-container *ngIf=\"editableProperty.enum?.length\">\n          <div *ngIf=\"editableProperty.enum?.length\" class=\"enum-edit\">\n            <div class=\"tag\" *ngFor=\"let value of editableProperty.enum\">\n              <span>{{ value }}</span>\n              <button type=\"button\" (click)=\"removeEnumValue(value)\">\n                <i class=\"ngx-icon ngx-x\"></i>\n              </button>\n            </div>\n          </div>\n\n          <ngx-select\n            [filterable]=\"false\"\n            [ngModel]=\"[editableProperty.default]\"\n            (ngModelChange)=\"updateDefault($event[0])\"\n            [label]=\"'DEFAULT'\"\n          >\n            <ngx-select-option *ngFor=\"let value of editableProperty.enum\" [name]=\"value\" [value]=\"value\">\n            </ngx-select-option>\n          </ngx-select>\n        </ng-container>\n\n        <!-- CONSTRAINS -->\n        <div class=\"constrain-row\" *ngIf=\"editableProperty.type === 'number' || editableProperty.type === 'integer'\">\n          <ngx-input type=\"number\" [(ngModel)]=\"editableProperty.minimum\" [label]=\"'MINIMUM'\"></ngx-input>\n\n          <ngx-input type=\"number\" [(ngModel)]=\"editableProperty.maximum\" [label]=\"'MAXIMUM'\"></ngx-input>\n        </div>\n\n        <div class=\"constrain-row\" *ngIf=\"editableProperty.type === 'string'\">\n          <ngx-input type=\"number\" [(ngModel)]=\"editableProperty.minLength\" [label]=\"'MINIMUM LENGTH'\"></ngx-input>\n\n          <ngx-input type=\"number\" [(ngModel)]=\"editableProperty.maxLength\" [label]=\"'MAXIMUM LENGTH'\"></ngx-input>\n        </div>\n\n        <div class=\"constrain-row\" *ngIf=\"editableProperty.type === 'array'\">\n          <ngx-input type=\"number\" [(ngModel)]=\"editableProperty.minItems\" [label]=\"'MIN ITEMS'\"></ngx-input>\n          <ngx-input type=\"number\" [(ngModel)]=\"editableProperty.maxItems\" [label]=\"'MAX ITEMS'\"></ngx-input>\n        </div>\n\n        <!-- PATTERN -->\n        <ngx-input\n          type=\"text\"\n          *ngIf=\"['string', 'number', 'integer'].includes($any(editableProperty.type))\"\n          [(ngModel)]=\"editableProperty.pattern\"\n          [label]=\"'PATTERN TO MATCH'\"\n        >\n        </ngx-input>\n\n        <!-- REQUIRED -->\n        <ngx-checkbox *ngIf=\"!arrayItem\" [(ngModel)]=\"required\">\n          Required\n        </ngx-checkbox>\n      </ng-container>\n    </ngx-tab>\n    <ngx-tab label=\"EXAMPLE VALUES\">\n      <div class=\"examples-container\">\n        <ngx-orderable-inputs-list\n          [data]=\"editableProperty.examples\"\n          (onUpdate)=\"updateExamples($event)\"\n        ></ngx-orderable-inputs-list>\n      </div>\n    </ngx-tab>\n  </ngx-tabs>\n</div>\n",
            encapsulation: ViewEncapsulation.None,
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: [".property-config .header{background:-webkit-gradient(linear,left top,left bottom,from(#3b4457),to(#262c38));background:linear-gradient(180deg,#3b4457 0,#262c38 100%);height:75px;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between;padding:0 35px}.property-config .header span{font-size:19px;color:#fff}.property-config .header button{font-size:14px;line-height:18px}.property-config .ngx-tab-content{max-height:65vh;overflow:auto}.property-config .new-enum-input button{color:#696969}.property-config .new-enum-input .ngx-input-hint{display:none}.property-config .enum-edit button{font-size:9px;padding-right:0}.property-config .constrain-row{display:-webkit-box;display:flex}.property-config .constrain-row ngx-input{flex-basis:50%}.property-config .constrain-row ngx-input:first-child{margin-right:30px}.property-config ngx-checkbox label{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;margin:1.2rem 1.2rem 1.2rem 0!important}.property-config .prop-types-formats .ngx-select-dropdown-option,.property-config .prop-types-formats .ngx-select-input-name{text-transform:capitalize}.property-config .examples-container{border:1px solid #505c75;padding:14px}"]
        }),
        __metadata("design:paramtypes", [DialogService])
    ], PropertyConfigComponent);
    return PropertyConfigComponent;
}());
export { PropertyConfigComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktY29uZmlnLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bzd2ltbGFuZS9uZ3gtdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9qc29uLWVkaXRvci9qc29uLWVkaXRvci1mbGF0L2pzb24tZWRpdG9yLW5vZGUtZmxhdC9ub2RlLXR5cGVzL3Byb3BlcnR5LWNvbmZpZy9wcm9wZXJ0eS1jb25maWcuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFDTCxZQUFZLEVBQ1osTUFBTSxFQUNOLGlCQUFpQixFQUNqQix1QkFBdUIsRUFDeEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQ3JFLE9BQU8sRUFBb0IsU0FBUyxFQUFzQixNQUFNLGdDQUFnQyxDQUFDO0FBaUJqRztJQXVCRSxpQ0FBb0IsYUFBNEI7UUFBNUIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFoQnZDLFlBQU8sR0FBeUIsRUFBRSxDQUFDO1FBRW5DLGNBQVMsR0FBSSxLQUFLLENBQUM7UUFFbkIsYUFBUSxHQUFJLEtBQUssQ0FBQztRQUVqQixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUF5QixDQUFDO1FBRW5FLGNBQVMsR0FBYSxTQUFTLENBQUM7UUFJaEMsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUVqQixpQkFBWSxHQUFHLEVBQUUsQ0FBQztJQUVpQyxDQUFDO0lBRXBELDBDQUFRLEdBQVI7UUFDRSxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBRWxFLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ25CLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUNwQjtJQUNILENBQUM7SUFFRCw4Q0FBWSxHQUFaO1FBQ0UsSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNoQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQztZQUNyQixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7WUFDdkIsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO1lBQ2pCLFdBQVcsRUFBRSxJQUFJLENBQUMsZ0JBQWdCO1lBQ2xDLFdBQVcsRUFBRSxJQUFJLENBQUMsUUFBUTtTQUMzQixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsNENBQVUsR0FBVixVQUFXLElBQVk7UUFDckIsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLEtBQUssSUFBSSxFQUFFO1lBQzFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsR0FBRyxJQUEyQixDQUFDO1lBQzVELE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRXZDLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxDQUFDO1NBQ2xDO0lBQ0gsQ0FBQztJQUVELGdEQUFjLEdBQWQsVUFBZSxRQUFrQjtRQUMvQixJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTSxFQUFFO1lBQy9CLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsR0FBRyxRQUFRLENBQUM7U0FDOUM7YUFBTTtZQUNMLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQztTQUN2QztJQUNILENBQUM7SUFFRCw4Q0FBWSxHQUFaLFVBQWEsTUFBYztRQUN6QixJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsS0FBSyxNQUFNLEVBQUU7WUFDOUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxHQUFHLFFBQVEsQ0FBQztZQUN6QyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLEdBQUcsTUFBTSxDQUFDO1lBQ3pDLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxDQUFDO1NBQ2xDO0lBQ0gsQ0FBQztJQUVELDhDQUFZLEdBQVo7UUFDRSxJQUFNLFVBQVUsR0FBRyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFFekYsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFO1lBQzNDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxZQUFZLEdBQUcsRUFBRSxDQUFDO1lBQ3ZCLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3hDO0lBQ0gsQ0FBQztJQUVELCtDQUFhLEdBQWIsVUFBYyxTQUFpQjtRQUM3QixJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ2QsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDekM7YUFBTTtZQUNMLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsR0FBRyxTQUFTLENBQUM7U0FDOUM7SUFDSCxDQUFDO0lBRUQsaURBQWUsR0FBZixVQUFnQixHQUFXO1FBQ3pCLElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqRCxJQUFNLEtBQUssR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRXRDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxFQUFFO1lBQ2QsVUFBVSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDN0I7UUFFRCxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRTtZQUN0QixnQ0FBZ0M7WUFDaEMsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDdEM7SUFDSCxDQUFDO0lBRU8sMkRBQXlCLEdBQWpDO1FBQ0UsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckMsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDM0MsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDekMsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdEMsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDeEMsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDeEMsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDeEMsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDMUMsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDMUMsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDekMsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUVPLDZDQUFXLEdBQW5CO1FBQ0UsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM1RSxDQUFDOztnQkE3RmtDLGFBQWE7O0lBdEJ2QztRQUFSLEtBQUssRUFBRTs7NkRBQTRCO0lBRTNCO1FBQVIsS0FBSyxFQUFFOzswREFBZ0I7SUFFZjtRQUFSLEtBQUssRUFBRTs7MkRBQTBCO0lBRXpCO1FBQVIsS0FBSyxFQUFFOzs0REFBb0M7SUFFbkM7UUFBUixLQUFLLEVBQUU7OzhEQUFvQjtJQUVuQjtRQUFSLEtBQUssRUFBRTs7NkRBQW1CO0lBRWpCO1FBQVQsTUFBTSxFQUFFOztpRUFBMEQ7SUFieEQsdUJBQXVCO1FBUG5DLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxxQkFBcUI7WUFDL0IsMmdMQUErQztZQUUvQyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtZQUNyQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7U0FDaEQsQ0FBQzt5Q0F3Qm1DLGFBQWE7T0F2QnJDLHVCQUF1QixDQXFIbkM7SUFBRCw4QkFBQztDQUFBLEFBckhELElBcUhDO1NBckhZLHVCQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBJbnB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBPdXRwdXQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneVxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERpYWxvZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9kaWFsb2cvZGlhbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHsgSlNPTkVkaXRvclNjaGVtYSwgcHJvcFR5cGVzLCBKc29uU2NoZW1hRGF0YVR5cGUgfSBmcm9tICcuLi8uLi8uLi8uLi9qc29uLWVkaXRvci5oZWxwZXInO1xuaW1wb3J0IHsgSlNPTlNjaGVtYTdUeXBlTmFtZSB9IGZyb20gJ2pzb24tc2NoZW1hJztcblxuZXhwb3J0IGludGVyZmFjZSBQcm9wZXJ0eUNvbmZpZ09wdGlvbnMge1xuICByZXF1aXJlZDogYm9vbGVhbjtcbiAgaW5kZXg6IG51bWJlcjtcbiAgbmV3UHJvcGVydHk6IEpTT05FZGl0b3JTY2hlbWE7XG4gIG9sZFByb3BlcnR5OiBKU09ORWRpdG9yU2NoZW1hO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ3gtcHJvcGVydHktY29uZmlnJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3Byb3BlcnR5LWNvbmZpZy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3Byb3BlcnR5LWNvbmZpZy5jb21wb25lbnQuc2NzcyddLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBQcm9wZXJ0eUNvbmZpZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgpIHByb3BlcnR5OiBKU09ORWRpdG9yU2NoZW1hO1xuXG4gIEBJbnB1dCgpIGluZGV4PzogbnVtYmVyO1xuXG4gIEBJbnB1dCgpIHNjaGVtYTogSlNPTkVkaXRvclNjaGVtYTtcblxuICBASW5wdXQoKSBmb3JtYXRzOiBKc29uU2NoZW1hRGF0YVR5cGVbXSA9IFtdO1xuXG4gIEBJbnB1dCgpIGFycmF5SXRlbT8gPSBmYWxzZTtcblxuICBASW5wdXQoKSByb290SXRlbT8gPSBmYWxzZTtcblxuICBAT3V0cHV0KCkgdXBkYXRlU2NoZW1hID0gbmV3IEV2ZW50RW1pdHRlcjxQcm9wZXJ0eUNvbmZpZ09wdGlvbnM+KCk7XG5cbiAgcHJvcFR5cGVzOiBzdHJpbmdbXSA9IHByb3BUeXBlcztcblxuICBlZGl0YWJsZVByb3BlcnR5OiBKU09ORWRpdG9yU2NoZW1hO1xuXG4gIHJlcXVpcmVkID0gZmFsc2U7XG5cbiAgbmV3RW51bVZhbHVlID0gJyc7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBkaWFsb2dTZXJ2aWNlOiBEaWFsb2dTZXJ2aWNlKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuZWRpdGFibGVQcm9wZXJ0eSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5wcm9wZXJ0eSkpO1xuXG4gICAgaWYgKCF0aGlzLmFycmF5SXRlbSkge1xuICAgICAgdGhpcy5zZXRSZXF1aXJlZCgpO1xuICAgIH1cbiAgfVxuXG4gIGFwcGx5Q2hhbmdlcygpOiB2b2lkIHtcbiAgICB0aGlzLmRpYWxvZ1NlcnZpY2UuZGVzdHJveUFsbCgpO1xuICAgIHRoaXMudXBkYXRlU2NoZW1hLmVtaXQoe1xuICAgICAgcmVxdWlyZWQ6IHRoaXMucmVxdWlyZWQsXG4gICAgICBpbmRleDogdGhpcy5pbmRleCxcbiAgICAgIG5ld1Byb3BlcnR5OiB0aGlzLmVkaXRhYmxlUHJvcGVydHksXG4gICAgICBvbGRQcm9wZXJ0eTogdGhpcy5wcm9wZXJ0eVxuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlVHlwZSh0eXBlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5lZGl0YWJsZVByb3BlcnR5Wyd0eXBlJ10gIT09IHR5cGUpIHtcbiAgICAgIHRoaXMuZWRpdGFibGVQcm9wZXJ0eVsndHlwZSddID0gdHlwZSBhcyBKU09OU2NoZW1hN1R5cGVOYW1lO1xuICAgICAgZGVsZXRlIHRoaXMuZWRpdGFibGVQcm9wZXJ0eVsnZm9ybWF0J107XG5cbiAgICAgIHRoaXMuY2xlYW5VcFByb3BlcnR5Q29uc3RyYWlucygpO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZUV4YW1wbGVzKGV4YW1wbGVzOiBzdHJpbmdbXSk6IHZvaWQge1xuICAgIGlmIChleGFtcGxlcyAmJiBleGFtcGxlcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuZWRpdGFibGVQcm9wZXJ0eVsnZXhhbXBsZXMnXSA9IGV4YW1wbGVzO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZWxldGUgdGhpcy5lZGl0YWJsZVByb3BlcnR5LmV4YW1wbGVzO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZUZvcm1hdChmb3JtYXQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICh0aGlzLmVkaXRhYmxlUHJvcGVydHlbJ2Zvcm1hdCddICE9PSBmb3JtYXQpIHtcbiAgICAgIHRoaXMuZWRpdGFibGVQcm9wZXJ0eVsndHlwZSddID0gJ3N0cmluZyc7XG4gICAgICB0aGlzLmVkaXRhYmxlUHJvcGVydHlbJ2Zvcm1hdCddID0gZm9ybWF0O1xuICAgICAgdGhpcy5jbGVhblVwUHJvcGVydHlDb25zdHJhaW5zKCk7XG4gICAgfVxuICB9XG5cbiAgYWRkRW51bVZhbHVlKCk6IHZvaWQge1xuICAgIGNvbnN0IGVudW1WYWx1ZXMgPSAodGhpcy5lZGl0YWJsZVByb3BlcnR5WydlbnVtJ10gPSB0aGlzLmVkaXRhYmxlUHJvcGVydHlbJ2VudW0nXSB8fCBbXSk7XG5cbiAgICBpZiAoIWVudW1WYWx1ZXMuaW5jbHVkZXModGhpcy5uZXdFbnVtVmFsdWUpKSB7XG4gICAgICBlbnVtVmFsdWVzLnB1c2godGhpcy5uZXdFbnVtVmFsdWUpO1xuICAgICAgdGhpcy5uZXdFbnVtVmFsdWUgPSAnJztcbiAgICAgIGRlbGV0ZSB0aGlzLmVkaXRhYmxlUHJvcGVydHlbJ2Zvcm1hdCddO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZURlZmF1bHQoZW51bVZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoIWVudW1WYWx1ZSkge1xuICAgICAgZGVsZXRlIHRoaXMuZWRpdGFibGVQcm9wZXJ0eVsnZGVmYXVsdCddO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVkaXRhYmxlUHJvcGVydHlbJ2RlZmF1bHQnXSA9IGVudW1WYWx1ZTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVFbnVtVmFsdWUodmFsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBlbnVtVmFsdWVzID0gdGhpcy5lZGl0YWJsZVByb3BlcnR5WydlbnVtJ107XG4gICAgY29uc3QgaW5kZXggPSBlbnVtVmFsdWVzLmluZGV4T2YodmFsKTtcblxuICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICBlbnVtVmFsdWVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuXG4gICAgaWYgKCFlbnVtVmFsdWVzLmxlbmd0aCkge1xuICAgICAgLy8gUmVtb3ZlIGVudW0gcHJvcGVydHkgaWYgZW1wdHlcbiAgICAgIGRlbGV0ZSB0aGlzLmVkaXRhYmxlUHJvcGVydHlbJ2VudW0nXTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNsZWFuVXBQcm9wZXJ0eUNvbnN0cmFpbnMoKTogdm9pZCB7XG4gICAgZGVsZXRlIHRoaXMuZWRpdGFibGVQcm9wZXJ0eVsnZW51bSddO1xuICAgIGRlbGV0ZSB0aGlzLmVkaXRhYmxlUHJvcGVydHlbJ3Byb3BlcnRpZXMnXTtcbiAgICBkZWxldGUgdGhpcy5lZGl0YWJsZVByb3BlcnR5WydyZXF1aXJlZCddO1xuICAgIGRlbGV0ZSB0aGlzLmVkaXRhYmxlUHJvcGVydHlbJ2l0ZW1zJ107XG4gICAgZGVsZXRlIHRoaXMuZWRpdGFibGVQcm9wZXJ0eVsnbWluaW11bSddO1xuICAgIGRlbGV0ZSB0aGlzLmVkaXRhYmxlUHJvcGVydHlbJ21heGltdW0nXTtcbiAgICBkZWxldGUgdGhpcy5lZGl0YWJsZVByb3BlcnR5WydkZWZhdWx0J107XG4gICAgZGVsZXRlIHRoaXMuZWRpdGFibGVQcm9wZXJ0eVsnbWluTGVuZ3RoJ107XG4gICAgZGVsZXRlIHRoaXMuZWRpdGFibGVQcm9wZXJ0eVsnbWF4TGVuZ3RoJ107XG4gICAgZGVsZXRlIHRoaXMuZWRpdGFibGVQcm9wZXJ0eVsnbWluSXRlbXMnXTtcbiAgICBkZWxldGUgdGhpcy5lZGl0YWJsZVByb3BlcnR5WydtYXhJdGVtcyddO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRSZXF1aXJlZCgpOiB2b2lkIHtcbiAgICB0aGlzLnJlcXVpcmVkID0gdGhpcy5zY2hlbWEucmVxdWlyZWQuaW5jbHVkZXModGhpcy5wcm9wZXJ0eS5wcm9wZXJ0eU5hbWUpO1xuICB9XG59XG4iXX0=