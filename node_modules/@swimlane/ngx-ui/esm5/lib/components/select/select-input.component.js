import { __decorate, __metadata, __read, __spread, __values } from "tslib";
import { Component, Input, Output, EventEmitter, ViewChild, TemplateRef, ElementRef, ChangeDetectionStrategy } from '@angular/core';
import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { KeyboardKeys } from '../../enums';
var SelectInputComponent = /** @class */ (function () {
    function SelectInputComponent() {
        this.toggle = new EventEmitter();
        this.selection = new EventEmitter();
        this.activate = new EventEmitter();
        this.keyup = new EventEmitter();
        this.selectedOptions = [];
    }
    Object.defineProperty(SelectInputComponent.prototype, "autofocus", {
        get: function () {
            return this._autofocus;
        },
        set: function (autofocus) {
            this._autofocus = coerceBooleanProperty(autofocus);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectInputComponent.prototype, "allowClear", {
        get: function () {
            return this._allowClear;
        },
        set: function (allowClear) {
            this._allowClear = coerceBooleanProperty(allowClear);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectInputComponent.prototype, "multiple", {
        get: function () {
            return this._multiple;
        },
        set: function (multiple) {
            this._multiple = coerceBooleanProperty(multiple);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectInputComponent.prototype, "tagging", {
        get: function () {
            return this._tagging;
        },
        set: function (tagging) {
            this._tagging = coerceBooleanProperty(tagging);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectInputComponent.prototype, "allowAdditions", {
        get: function () {
            return this._allowAdditions;
        },
        set: function (allowAdditions) {
            this._allowAdditions = coerceBooleanProperty(allowAdditions);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectInputComponent.prototype, "disableDropdown", {
        get: function () {
            return this._disableDropdown;
        },
        set: function (disableDropdown) {
            this._disableDropdown = coerceBooleanProperty(disableDropdown);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectInputComponent.prototype, "selected", {
        get: function () {
            return this._selected;
        },
        set: function (val) {
            this._selected = val;
            this.selectedOptions = this.calcSelectedOptions(val);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectInputComponent.prototype, "caretVisible", {
        get: function () {
            if (this.disableDropdown)
                return false;
            if (this.tagging && (!this.options || !this.options.length))
                return false;
            return true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectInputComponent.prototype, "isNotTemplate", {
        get: function () {
            return !(typeof this.selectCaret === 'object' && this.selectCaret instanceof TemplateRef);
        },
        enumerable: true,
        configurable: true
    });
    SelectInputComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        if (this.tagging && this.autofocus) {
            setTimeout(function () {
                _this.inputElement.nativeElement.focus();
            }, 5);
        }
    };
    SelectInputComponent.prototype.onKeyUp = function (event) {
        event.stopPropagation();
        var key = event.key;
        var value = event.target.value;
        if (key === KeyboardKeys.ENTER) {
            if (value !== '') {
                var hasSelection = this.selected.find(function (selection) {
                    return value === selection;
                });
                if (!hasSelection) {
                    var newSelections = __spread(this.selected, [value]);
                    this.selection.emit(newSelections);
                    event.target.value = '';
                }
            }
            event.preventDefault();
        }
        else if (key === KeyboardKeys.ESCAPE) {
            this.toggle.emit();
        }
        this.keyup.emit({ event: event, value: value });
    };
    SelectInputComponent.prototype.onKeyDown = function (event) {
        if (this.disableDropdown)
            return;
        event.stopPropagation();
        if (!this.tagging) {
            this.keyup.emit({ event: event });
        }
    };
    SelectInputComponent.prototype.onClick = function (event) {
        var _this = this;
        if (this.disableDropdown)
            return;
        this.activate.emit(event);
        if (this.tagging) {
            setTimeout(function () {
                _this.inputElement.nativeElement.focus();
            }, 5);
        }
    };
    SelectInputComponent.prototype.onOptionRemove = function (event, option) {
        var _this = this;
        event.stopPropagation();
        var newSelections = this.selected.filter(function (selection) {
            if (_this.identifier !== undefined) {
                return option.value[_this.identifier] !== selection[_this.identifier];
            }
            return option.value !== selection;
        });
        this.selection.emit(newSelections);
    };
    SelectInputComponent.prototype.calcSelectedOptions = function (selected) {
        var e_1, _a;
        var _this = this;
        var results = [];
        // result out if nothing here
        if (!selected)
            return results;
        var _loop_1 = function (selection) {
            var match = void 0;
            if (this_1.options) {
                match = this_1.options.find(function (option) {
                    if (_this.identifier) {
                        return selection[_this.identifier] === option.value[_this.identifier];
                    }
                    return selection === option.value;
                });
            }
            if ((this_1.tagging || this_1.allowAdditions) && !match) {
                match = { value: selection, name: selection };
            }
            if (match)
                results.push(match);
        };
        var this_1 = this;
        try {
            for (var selected_1 = __values(selected), selected_1_1 = selected_1.next(); !selected_1_1.done; selected_1_1 = selected_1.next()) {
                var selection = selected_1_1.value;
                _loop_1(selection);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (selected_1_1 && !selected_1_1.done && (_a = selected_1.return)) _a.call(selected_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return results;
    };
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], SelectInputComponent.prototype, "placeholder", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], SelectInputComponent.prototype, "identifier", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], SelectInputComponent.prototype, "options", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], SelectInputComponent.prototype, "label", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], SelectInputComponent.prototype, "hint", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], SelectInputComponent.prototype, "selectCaret", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], SelectInputComponent.prototype, "requiredIndicator", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [Object])
    ], SelectInputComponent.prototype, "autofocus", null);
    __decorate([
        Input(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [Object])
    ], SelectInputComponent.prototype, "allowClear", null);
    __decorate([
        Input(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [Object])
    ], SelectInputComponent.prototype, "multiple", null);
    __decorate([
        Input(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [Object])
    ], SelectInputComponent.prototype, "tagging", null);
    __decorate([
        Input(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [Object])
    ], SelectInputComponent.prototype, "allowAdditions", null);
    __decorate([
        Input(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [Object])
    ], SelectInputComponent.prototype, "disableDropdown", null);
    __decorate([
        Input(),
        __metadata("design:type", Array),
        __metadata("design:paramtypes", [Array])
    ], SelectInputComponent.prototype, "selected", null);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], SelectInputComponent.prototype, "toggle", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], SelectInputComponent.prototype, "selection", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], SelectInputComponent.prototype, "activate", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], SelectInputComponent.prototype, "keyup", void 0);
    __decorate([
        ViewChild('tagInput'),
        __metadata("design:type", ElementRef)
    ], SelectInputComponent.prototype, "inputElement", void 0);
    SelectInputComponent = __decorate([
        Component({
            exportAs: 'ngxSelectInput',
            selector: 'ngx-select-input',
            template: "<div tabindex=\"-1\" (keydown)=\"onKeyDown($event)\" class=\"ngx-select-input-box\" (click)=\"onClick($event)\">\n  <span *ngIf=\"label !== undefined\" class=\"ngx-select-label\">\n    <span [innerHTML]=\"label\"></span>\n    <span [innerHTML]=\"requiredIndicator\"></span>\n  </span>\n  <span\n    *ngIf=\"!selected?.length && placeholder !== undefined\"\n    class=\"ngx-select-placeholder\"\n    [innerHTML]=\"placeholder\"\n  >\n  </span>\n  <ul class=\"horizontal-list ngx-select-input-list\">\n    <li *ngFor=\"let option of selectedOptions\" class=\"ngx-select-input-option\" [class.disabled]=\"option.disabled\">\n      <ng-template\n        *ngIf=\"option.inputTemplate\"\n        [ngTemplateOutlet]=\"option.inputTemplate\"\n        [ngTemplateOutletContext]=\"{ option: option }\"\n      >\n      </ng-template>\n      <span *ngIf=\"!option.inputTemplate\" class=\"ngx-select-input-name\" [innerHTML]=\"option.name || option.value\">\n      </span>\n      <span\n        *ngIf=\"allowClear && (multiple || tagging) && !option.disabled\"\n        title=\"Remove Selection\"\n        class=\"ngx-select-clear icon-x\"\n        (click)=\"onOptionRemove($event, option)\"\n      >\n      </span>\n    </li>\n    <li *ngIf=\"tagging\" class=\"ngx-select-input-box-wrapper\">\n      <input\n        #tagInput\n        type=\"search\"\n        class=\"ng-select-text-box\"\n        tabindex=\"\"\n        autocomplete=\"off\"\n        autocorrect=\"off\"\n        spellcheck=\"off\"\n        (keyup)=\"onKeyUp($event)\"\n      />\n    </li>\n  </ul>\n</div>\n<div class=\"ngx-select-input-underline\">\n  <div class=\"underline-fill\"></div>\n</div>\n<div class=\"ngx-select-hint\">\n  <span *ngIf=\"hint !== undefined\" [innerHTML]=\"hint\"></span>\n  <ng-content select=\"ngx-input-hint\"></ng-content>\n</div>\n<span\n  *ngIf=\"allowClear && !multiple && !tagging && selectedOptions?.length\"\n  title=\"Clear Selections\"\n  class=\"ngx-select-clear icon-x\"\n  (click)=\"selection.emit([])\"\n>\n</span>\n<span\n  *ngIf=\"caretVisible\"\n  class=\"ngx-select-caret icon-arrow-down\"\n  [class.icon-arrow-down]=\"!selectCaret\"\n  (click)=\"toggle.emit()\"\n>\n  <span *ngIf=\"isNotTemplate; else tpl\" [innerHTML]=\"selectCaret\"> </span>\n  <ng-template #tpl>\n    <ng-container *ngTemplateOutlet=\"selectCaret\"></ng-container>\n  </ng-template>\n</span>\n",
            host: { class: 'ngx-select-input' },
            changeDetection: ChangeDetectionStrategy.OnPush
        })
    ], SelectInputComponent);
    return SelectInputComponent;
}());
export { SelectInputComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LWlucHV0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bzd2ltbGFuZS9uZ3gtdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9zZWxlY3Qvc2VsZWN0LWlucHV0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBRVQsV0FBVyxFQUNYLFVBQVUsRUFDVix1QkFBdUIsRUFDeEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFOUQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGFBQWEsQ0FBQztBQVUzQztJQUFBO1FBa0VZLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBQ2xDLGNBQVMsR0FBRyxJQUFJLFlBQVksRUFBUyxDQUFDO1FBQ3RDLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBUyxDQUFDO1FBQ3JDLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBNEMsQ0FBQztRQWUvRSxvQkFBZSxHQUEyQixFQUFFLENBQUM7SUEyRy9DLENBQUM7SUFyTEMsc0JBQUksMkNBQVM7YUFBYjtZQUNFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUN6QixDQUFDO2FBQ0QsVUFBYyxTQUFTO1lBQ3JCLElBQUksQ0FBQyxVQUFVLEdBQUcscUJBQXFCLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDckQsQ0FBQzs7O09BSEE7SUFNRCxzQkFBSSw0Q0FBVTthQUFkO1lBQ0UsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQzFCLENBQUM7YUFDRCxVQUFlLFVBQVU7WUFDdkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxxQkFBcUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN2RCxDQUFDOzs7T0FIQTtJQU1ELHNCQUFJLDBDQUFRO2FBQVo7WUFDRSxPQUFPLElB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InNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBWaWV3Q2hpbGQsXG4gIEFmdGVyVmlld0luaXQsXG4gIFRlbXBsYXRlUmVmLFxuICBFbGVtZW50UmVmLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneVxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XG5cbmltcG9ydCB7IEtleWJvYXJkS2V5cyB9IGZyb20gJy4uLy4uL2VudW1zJztcbmltcG9ydCB7IFNlbGVjdERyb3Bkb3duT3B0aW9uIH0gZnJvbSAnLi9zZWxlY3QtZHJvcGRvd24tb3B0aW9uLmludGVyZmFjZSc7XG5cbkBDb21wb25lbnQoe1xuICBleHBvcnRBczogJ25neFNlbGVjdElucHV0JyxcbiAgc2VsZWN0b3I6ICduZ3gtc2VsZWN0LWlucHV0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3NlbGVjdC1pbnB1dC5jb21wb25lbnQuaHRtbCcsXG4gIGhvc3Q6IHsgY2xhc3M6ICduZ3gtc2VsZWN0LWlucHV0JyB9LFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBTZWxlY3RJbnB1dENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQge1xuICBASW5wdXQoKSBwbGFjZWhvbGRlcjogc3RyaW5nO1xuICBASW5wdXQoKSBpZGVudGlmaWVyOiBzdHJpbmc7XG4gIEBJbnB1dCgpIG9wdGlvbnM6IFNlbGVjdERyb3Bkb3duT3B0aW9uW107XG4gIEBJbnB1dCgpIGxhYmVsOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGhpbnQ6IHN0cmluZztcbiAgQElucHV0KCkgc2VsZWN0Q2FyZXQ6IHN0cmluZyB8IFRlbXBsYXRlUmVmPGFueT47XG4gIEBJbnB1dCgpIHJlcXVpcmVkSW5kaWNhdG9yOiBzdHJpbmcgfCBib29sZWFuO1xuXG4gIEBJbnB1dCgpXG4gIGdldCBhdXRvZm9jdXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2F1dG9mb2N1cztcbiAgfVxuICBzZXQgYXV0b2ZvY3VzKGF1dG9mb2N1cykge1xuICAgIHRoaXMuX2F1dG9mb2N1cyA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eShhdXRvZm9jdXMpO1xuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IGFsbG93Q2xlYXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FsbG93Q2xlYXI7XG4gIH1cbiAgc2V0IGFsbG93Q2xlYXIoYWxsb3dDbGVhcikge1xuICAgIHRoaXMuX2FsbG93Q2xlYXIgPSBjb2VyY2VCb29sZWFuUHJvcGVydHkoYWxsb3dDbGVhcik7XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgbXVsdGlwbGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX211bHRpcGxlO1xuICB9XG4gIHNldCBtdWx0aXBsZShtdWx0aXBsZSkge1xuICAgIHRoaXMuX211bHRpcGxlID0gY29lcmNlQm9vbGVhblByb3BlcnR5KG11bHRpcGxlKTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIGdldCB0YWdnaW5nKCkge1xuICAgIHJldHVybiB0aGlzLl90YWdnaW5nO1xuICB9XG4gIHNldCB0YWdnaW5nKHRhZ2dpbmcpIHtcbiAgICB0aGlzLl90YWdnaW5nID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHRhZ2dpbmcpO1xuICB9XG5cbiAgQElucHV0KClcbiAgZ2V0IGFsbG93QWRkaXRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLl9hbGxvd0FkZGl0aW9ucztcbiAgfVxuICBzZXQgYWxsb3dBZGRpdGlvbnMoYWxsb3dBZGRpdGlvbnMpIHtcbiAgICB0aGlzLl9hbGxvd0FkZGl0aW9ucyA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eShhbGxvd0FkZGl0aW9ucyk7XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgZGlzYWJsZURyb3Bkb3duKCkge1xuICAgIHJldHVybiB0aGlzLl9kaXNhYmxlRHJvcGRvd247XG4gIH1cbiAgc2V0IGRpc2FibGVEcm9wZG93bihkaXNhYmxlRHJvcGRvd24pIHtcbiAgICB0aGlzLl9kaXNhYmxlRHJvcGRvd24gPSBjb2VyY2VCb29sZWFuUHJvcGVydHkoZGlzYWJsZURyb3Bkb3duKTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIGdldCBzZWxlY3RlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWQ7XG4gIH1cbiAgc2V0IHNlbGVjdGVkKHZhbDogYW55W10pIHtcbiAgICB0aGlzLl9zZWxlY3RlZCA9IHZhbDtcbiAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucyA9IHRoaXMuY2FsY1NlbGVjdGVkT3B0aW9ucyh2YWwpO1xuICB9XG5cbiAgQE91dHB1dCgpIHRvZ2dsZSA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcbiAgQE91dHB1dCgpIHNlbGVjdGlvbiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55W10+KCk7XG4gIEBPdXRwdXQoKSBhY3RpdmF0ZSA9IG5ldyBFdmVudEVtaXR0ZXI8RXZlbnQ+KCk7XG4gIEBPdXRwdXQoKSBrZXl1cCA9IG5ldyBFdmVudEVtaXR0ZXI8eyBldmVudDogS2V5Ym9hcmRFdmVudDsgdmFsdWU/OiBzdHJpbmcgfT4oKTtcblxuICBAVmlld0NoaWxkKCd0YWdJbnB1dCcpXG4gIHJlYWRvbmx5IGlucHV0RWxlbWVudD86IEVsZW1lbnRSZWY8SFRNTElucHV0RWxlbWVudD47XG5cbiAgZ2V0IGNhcmV0VmlzaWJsZSgpOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5kaXNhYmxlRHJvcGRvd24pIHJldHVybiBmYWxzZTtcbiAgICBpZiAodGhpcy50YWdnaW5nICYmICghdGhpcy5vcHRpb25zIHx8ICF0aGlzLm9wdGlvbnMubGVuZ3RoKSkgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgZ2V0IGlzTm90VGVtcGxhdGUoKSB7XG4gICAgcmV0dXJuICEodHlwZW9mIHRoaXMuc2VsZWN0Q2FyZXQgPT09ICdvYmplY3QnICYmIHRoaXMuc2VsZWN0Q2FyZXQgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZik7XG4gIH1cblxuICBzZWxlY3RlZE9wdGlvbnM6IFNlbGVjdERyb3Bkb3duT3B0aW9uW10gPSBbXTtcblxuICBwcml2YXRlIF9zZWxlY3RlZDogYW55W107XG4gIHByaXZhdGUgX2F1dG9mb2N1czogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfYWxsb3dDbGVhcjogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfbXVsdGlwbGU6IGJvb2xlYW47XG4gIHByaXZhdGUgX3RhZ2dpbmc6IGJvb2xlYW47XG4gIHByaXZhdGUgX2FsbG93QWRkaXRpb25zOiBib29sZWFuO1xuICBwcml2YXRlIF9kaXNhYmxlRHJvcGRvd246IGJvb2xlYW47XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnRhZ2dpbmcgJiYgdGhpcy5hdXRvZm9jdXMpIHtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gICAgICB9LCA1KTtcbiAgICB9XG4gIH1cblxuICBvbktleVVwKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICBjb25zdCBrZXkgPSBldmVudC5rZXk7XG4gICAgY29uc3QgdmFsdWUgPSAoZXZlbnQudGFyZ2V0IGFzIGFueSkudmFsdWU7XG5cbiAgICBpZiAoa2V5ID09PSAoS2V5Ym9hcmRLZXlzLkVOVEVSIGFzIGFueSkpIHtcbiAgICAgIGlmICh2YWx1ZSAhPT0gJycpIHtcbiAgICAgICAgY29uc3QgaGFzU2VsZWN0aW9uID0gdGhpcy5zZWxlY3RlZC5maW5kKHNlbGVjdGlvbiA9PiB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlID09PSBzZWxlY3Rpb247XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghaGFzU2VsZWN0aW9uKSB7XG4gICAgICAgICAgY29uc3QgbmV3U2VsZWN0aW9ucyA9IFsuLi50aGlzLnNlbGVjdGVkLCB2YWx1ZV07XG4gICAgICAgICAgdGhpcy5zZWxlY3Rpb24uZW1pdChuZXdTZWxlY3Rpb25zKTtcbiAgICAgICAgICAoZXZlbnQudGFyZ2V0IGFzIGFueSkudmFsdWUgPSAnJztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0gZWxzZSBpZiAoa2V5ID09PSAoS2V5Ym9hcmRLZXlzLkVTQ0FQRSBhcyBhbnkpKSB7XG4gICAgICB0aGlzLnRvZ2dsZS5lbWl0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5rZXl1cC5lbWl0KHsgZXZlbnQsIHZhbHVlIH0pO1xuICB9XG5cbiAgb25LZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZURyb3Bkb3duKSByZXR1cm47XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICBpZiAoIXRoaXMudGFnZ2luZykge1xuICAgICAgdGhpcy5rZXl1cC5lbWl0KHsgZXZlbnQgfSk7XG4gICAgfVxuICB9XG5cbiAgb25DbGljayhldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kaXNhYmxlRHJvcGRvd24pIHJldHVybjtcbiAgICB0aGlzLmFjdGl2YXRlLmVtaXQoZXZlbnQpO1xuXG4gICAgaWYgKHRoaXMudGFnZ2luZykge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuaW5wdXRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgIH0sIDUpO1xuICAgIH1cbiAgfVxuXG4gIG9uT3B0aW9uUmVtb3ZlKGV2ZW50OiBFdmVudCwgb3B0aW9uOiBTZWxlY3REcm9wZG93bk9wdGlvbik6IHZvaWQge1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgY29uc3QgbmV3U2VsZWN0aW9ucyA9IHRoaXMuc2VsZWN0ZWQuZmlsdGVyKHNlbGVjdGlvbiA9PiB7XG4gICAgICBpZiAodGhpcy5pZGVudGlmaWVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbi52YWx1ZVt0aGlzLmlkZW50aWZpZXJdICE9PSBzZWxlY3Rpb25bdGhpcy5pZGVudGlmaWVyXTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG9wdGlvbi52YWx1ZSAhPT0gc2VsZWN0aW9uO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zZWxlY3Rpb24uZW1pdChuZXdTZWxlY3Rpb25zKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY1NlbGVjdGVkT3B0aW9ucyhzZWxlY3RlZDogYW55W10pIHtcbiAgICBjb25zdCByZXN1bHRzOiBTZWxlY3REcm9wZG93bk9wdGlvbltdID0gW107XG5cbiAgICAvLyByZXN1bHQgb3V0IGlmIG5vdGhpbmcgaGVyZVxuICAgIGlmICghc2VsZWN0ZWQpIHJldHVybiByZXN1bHRzO1xuXG4gICAgZm9yIChjb25zdCBzZWxlY3Rpb24gb2Ygc2VsZWN0ZWQpIHtcbiAgICAgIGxldCBtYXRjaDogU2VsZWN0RHJvcGRvd25PcHRpb247XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMpIHtcbiAgICAgICAgbWF0Y2ggPSB0aGlzLm9wdGlvbnMuZmluZChvcHRpb24gPT4ge1xuICAgICAgICAgIGlmICh0aGlzLmlkZW50aWZpZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBzZWxlY3Rpb25bdGhpcy5pZGVudGlmaWVyXSA9PT0gb3B0aW9uLnZhbHVlW3RoaXMuaWRlbnRpZmllcl07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHNlbGVjdGlvbiA9PT0gb3B0aW9uLnZhbHVlO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKCh0aGlzLnRhZ2dpbmcgfHwgdGhpcy5hbGxvd0FkZGl0aW9ucykgJiYgIW1hdGNoKSB7XG4gICAgICAgIG1hdGNoID0geyB2YWx1ZTogc2VsZWN0aW9uLCBuYW1lOiBzZWxlY3Rpb24gfTtcbiAgICAgIH1cblxuICAgICAgaWYgKG1hdGNoKSByZXN1bHRzLnB1c2gobWF0Y2gpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG59XG4iXX0=