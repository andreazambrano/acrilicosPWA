/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FilePickerService } from './file-picker.service';
import { Component, ElementRef, EventEmitter, Input, Output, TemplateRef } from '@angular/core';
import { getFileType } from './file-upload.utils';
import { FileValidationTypes } from './validation-error.model';
import { FilePickerAdapter } from './file-picker.adapter';
import { combineLatest, of, Subject } from 'rxjs';
import { map, takeUntil, tap } from 'rxjs/operators';
import { DefaultCaptions } from './default-captions';
export class FilePickerComponent {
    /**
     * @param {?} fileService
     * @param {?} elementRef
     */
    constructor(fileService, elementRef) {
        this.fileService = fileService;
        this.elementRef = elementRef;
        /**
         * Emitted when file is uploaded via api successfully. Emitted for every file
         */
        this.uploadSuccess = new EventEmitter();
        /**
         * Emitted when file is removed via api successfully. Emitted for every file
         */
        this.removeSuccess = new EventEmitter();
        /**
         * Emitted on file validation fail
         */
        this.validationError = new EventEmitter();
        /**
         * Emitted when file is added and passed validations. Not uploaded yet
         */
        this.fileAdded = new EventEmitter();
        /**
         * Whether to enable cropper. Default: disabled
         */
        this.enableCropper = false;
        /**
         * Whether to show default drag and drop zone. Default:true
         */
        this.showeDragDropZone = true;
        /**
         * Whether to show default files preview container. Default: true
         */
        this.showPreviewContainer = true;
        /**
         * Single or multiple. Default: multi
         */
        this.uploadType = 'multi';
        this.files = [];
        /**
         * Files array for cropper. Will be shown equentially if crop enabled
         */
        this.filesForCropper = [];
        this.cropClosed$ = new Subject();
        this._onDestroy$ = new Subject();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.setCropperOptions();
        this.listenToCropClose();
        this.setCaptions();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._onDestroy$.next();
    }
    /**
     * @return {?}
     */
    setCaptions() {
        this._captions = this.captions || DefaultCaptions;
    }
    /**
     * Listen when Cropper is closed and open new cropper if next image exists
     * @return {?}
     */
    listenToCropClose() {
        this.cropClosed$
            .pipe(takeUntil(this._onDestroy$))
            .subscribe((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            /** @type {?} */
            const croppedIndex = this.filesForCropper.findIndex((/**
             * @param {?} item
             * @return {?}
             */
            item => item.name === res.fileName));
            /** @type {?} */
            const nextFile = croppedIndex !== -1 ? this.filesForCropper[croppedIndex + 1] : undefined;
            // console.log(nextFile)
            //  console.log('cropped', res);
            this.filesForCropper = [...this.filesForCropper].filter((/**
             * @param {?} item
             * @return {?}
             */
            item => item.name !== res.fileName));
            // console.log(this.filesForCropper);
            if (nextFile) {
                this.openCropper(nextFile);
            }
        }));
    }
    /**
     * Sets custom cropper options if avaiable
     * @return {?}
     */
    setCropperOptions() {
        if (!this.cropperOptions) {
            this.setDefaultCropperOptions();
        }
    }
    /**
     * Sets manual cropper options if no custom options are avaiable
     * @return {?}
     */
    setDefaultCropperOptions() {
        this.cropperOptions = {
            dragMode: 'crop',
            aspectRatio: 1,
            autoCrop: true,
            movable: true,
            zoomable: true,
            scalable: true,
            autoCropArea: 0.8
        };
    }
    /**
     * On input file selected
     * @param {?} fileInput
     * @return {?}
     */
    onChange(fileInput) {
        /** @type {?} */
        const files = Array.from(fileInput.files);
        this.handleFiles(files).subscribe();
    }
    /**
     * Handles input and drag/drop files
     * @param {?} files
     * @return {?}
     */
    handleFiles(files) {
        if (!this.isValidMaxFileCount(files)) {
            return of(null);
        }
        /** @type {?} */
        const isValidUploadSync = files.every((/**
         * @param {?} item
         * @return {?}
         */
        item => this.validateFileSync(item)));
        /** @type {?} */
        const asyncFunctions = files.map((/**
         * @param {?} item
         * @return {?}
         */
        item => this.validateFileAsync(item)));
        return combineLatest(...asyncFunctions)
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            /** @type {?} */
            const isValidUploadAsync = res.every((/**
             * @param {?} result
             * @return {?}
             */
            result => result === true));
            if (!isValidUploadSync || !isValidUploadAsync) {
                return;
            }
            files.forEach((/**
             * @param {?} file
             * @param {?} index
             * @return {?}
             */
            (file, index) => {
                this.handleInputFile(file, index);
            }));
        })));
    }
    /**
     * Validates synchronous validations
     * @param {?} file
     * @return {?}
     */
    validateFileSync(file) {
        if (!file) {
            return;
        }
        if (!this.isValidUploadType(file)) {
            return;
        }
        if (!this.isValidExtension(file, file.name)) {
            return;
        }
        return true;
    }
    /**
     * Validates asynchronous validations
     * @param {?} file
     * @return {?}
     */
    validateFileAsync(file) {
        if (!this.customValidator) {
            return of(true);
        }
        return this.customValidator(file).pipe(tap((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            if (!res) {
                this.validationError.next({ file: file, error: FileValidationTypes.customValidator });
            }
        })));
    }
    /**
     * Handles input and drag&drop files
     * @param {?} file
     * @param {?} index
     * @return {?}
     */
    handleInputFile(file, index) {
        /** @type {?} */
        const type = getFileType(file.type);
        if (type === 'image' && this.enableCropper) {
            this.filesForCropper.push(file);
            if (!(this.currentCropperFile)) {
                this.openCropper(file);
            }
        }
        else {
            /** Size is not initially checked on handleInputFiles because of cropper size change */
            if (this.isValidSize(file, file.size)) {
                this.pushFile(file);
            }
        }
    }
    /**
     * Validates if upload type is single so another file cannot be added
     * @param {?} file
     * @return {?}
     */
    isValidUploadType(file) {
        if (this.uploadType === 'single' && this.files.length > 0) {
            this.validationError.next({ file: file, error: FileValidationTypes.uploadType });
            return false;
        }
        else {
            return true;
        }
    }
    /**
     * Validates max file count
     * @param {?} files
     * @return {?}
     */
    isValidMaxFileCount(files) {
        if (!this.fileMaxCount || this.fileMaxCount >= this.files.length + files.length) {
            return true;
        }
        else {
            this.validationError.next({ file: null, error: FileValidationTypes.fileMaxCount });
            return false;
        }
    }
    /**
     * On file dropped
     * @param {?} event
     * @return {?}
     */
    dropped(event) {
        /** @type {?} */
        const files = event.files;
        /** @type {?} */
        const filesForUpload = [];
        for (const droppedFile of event.files) {
            // Is it a file?
            if (droppedFile.fileEntry.isFile) {
                /** @type {?} */
                const fileEntry = (/** @type {?} */ (droppedFile.fileEntry));
                fileEntry.file((/**
                 * @param {?} file
                 * @return {?}
                 */
                (file) => {
                    filesForUpload.push(file);
                }));
            }
            else {
                // It was a directory (empty directories are added, otherwise only files)
                /** @type {?} */
                const fileEntry = (/** @type {?} */ (droppedFile.fileEntry));
                // console.log(droppedFile.relativePath, fileEntry);
            }
        }
        setTimeout((/**
         * @return {?}
         */
        () => this.handleFiles(filesForUpload).subscribe()));
    }
    /**
     * Add file to file list after succesfull validation
     * @param {?} file
     * @param {?=} fileName
     * @return {?}
     */
    pushFile(file, fileName = file.name) {
        this.files.push({ file: file, fileName: fileName });
        this.fileAdded.next({ file: file, fileName: fileName });
    }
    /**
     * Opens cropper for image crop
     * @param {?} file
     * @return {?}
     */
    openCropper(file) {
        if (((/** @type {?} */ (window))).UPLOADER_TEST_MODE || typeof Cropper !== 'undefined') {
            this.safeCropImgUrl = this.fileService.createSafeUrl(file);
            this.currentCropperFile = file;
        }
        else {
            console.warn('please import cropperjs script and styles to use cropper feature or disable it by setting [enableCropper]="false"');
            return;
        }
    }
    /**
     * @param {?} file
     * @return {?}
     */
    getSafeUrl(file) {
        return this.fileService.createSafeUrl(file);
    }
    /**
     * On img load event
     * @param {?} e
     * @return {?}
     */
    cropperImgLoaded(e) {
        /** @type {?} */
        const image = document.getElementById('cropper-img');
        this.cropper = new Cropper(image, this.cropperOptions);
    }
    /**
     * Close or cancel cropper
     * @param {?} filePreview
     * @return {?}
     */
    closeCropper(filePreview) {
        this.currentCropperFile = undefined;
        this.cropper = undefined;
        setTimeout((/**
         * @return {?}
         */
        () => this.cropClosed$.next(filePreview)), 200);
    }
    /**
     * Removes files from files list
     * @param {?} file
     * @return {?}
     */
    removeFileFromList(file) {
        this.files = this.files.filter((/**
         * @param {?} f
         * @return {?}
         */
        f => f !== file));
    }
    /**
     * Emits event when file upload api returns success
     * @param {?} fileItem
     * @return {?}
     */
    onUploadSuccess(fileItem) {
        this.uploadSuccess.next(fileItem);
    }
    /**
     * Validates file extension
     * @param {?} file
     * @param {?} fileName
     * @return {?}
     */
    isValidExtension(file, fileName) {
        if (!this.fileExtensions) {
            return true;
        }
        /** @type {?} */
        const extension = fileName.split('.').pop();
        /** @type {?} */
        const fileExtensions = this.fileExtensions.map((/**
         * @param {?} ext
         * @return {?}
         */
        ext => ext.toLowerCase()));
        if (fileExtensions.indexOf(extension.toLowerCase()) === -1) {
            this.validationError.next({ file: file, error: FileValidationTypes.extensions });
            return false;
        }
        return true;
    }
    /**
     * Validates selected file size and total file size
     * @param {?} file
     * @param {?} size
     * @return {?}
     */
    isValidSize(file, size) {
        /**
         * Validating selected file size
         * @type {?}
         */
        const res = this.bitsToMb(size.toString());
        /** @type {?} */
        let isValidFileSize;
        /** @type {?} */
        let isValidTotalFileSize;
        if (!this.fileMaxSize || (this.fileMaxSize && res < this.fileMaxSize)) {
            isValidFileSize = true;
        }
        else {
            this.validationError.next({ file: file, error: FileValidationTypes.fileMaxSize });
        }
        /**
         * Validating Total Files Size
         * @type {?}
         */
        const totalBits = this.files.map((/**
         * @param {?} f
         * @return {?}
         */
        f => f.file.size)).reduce((/**
         * @param {?} acc
         * @param {?} curr
         * @return {?}
         */
        (acc, curr) => acc + curr), 0);
        if (!this.totalMaxSize || (this.totalMaxSize && this.bitsToMb(totalBits + file.size) < this.totalMaxSize)) {
            isValidTotalFileSize = true;
        }
        else {
            this.validationError.next({ file: file, error: FileValidationTypes.totalMaxSize });
        }
        return !!isValidFileSize && isValidTotalFileSize;
    }
    /**
     * @param {?} size
     * @return {?}
     */
    bitsToMb(size) {
        return parseFloat(size) / 1048576;
    }
    /**
     * when crop button submitted
     * @return {?}
     */
    onCropSubmit() {
        this.cropper.getCroppedCanvas().toBlob(this.blobFallBack.bind(this), 'image/jpeg');
    }
    /**
     * After crop submit
     * @param {?} blob
     * @return {?}
     */
    blobFallBack(blob) {
        if (!blob) {
            return;
        }
        if (this.isValidSize((/** @type {?} */ (blob)), blob.size)) {
            this.pushFile((/** @type {?} */ (blob)), this.currentCropperFile.name);
        }
        this.closeCropper({ file: (/** @type {?} */ (blob)), fileName: this.currentCropperFile.name });
    }
    /**
     * @param {?} fileItem
     * @return {?}
     */
    removeFile(fileItem) {
        if (this.adapter) {
            this.adapter.removeFile(fileItem)
                .subscribe((/**
             * @param {?} res
             * @return {?}
             */
            res => {
                this.onRemoveSuccess(fileItem);
            }));
        }
        else {
            console.warn('no adapter was provided');
        }
    }
    /**
     * Emits event when file remove api returns success
     * @param {?} fileItem
     * @return {?}
     */
    onRemoveSuccess(fileItem) {
        this.removeSuccess.next(fileItem);
        this.removeFileFromList(fileItem);
    }
}
FilePickerComponent.decorators = [
    { type: Component, args: [{
                selector: 'ngx-file-picker',
                template: `
   <div (click)="fileInput.click()" class="file-drop-wrapper" *ngIf="showeDragDropZone">
      <file-drop
        (onFileDrop)="dropped($event)"
        [customstyle]="'custom-drag'"
        [captions]="_captions"
      >
      <ng-content select=".dropzoneTemplate"> </ng-content>
      </file-drop>
    </div>


    <input type="file" name="file[]" id="fileInput"
           #fileInput
           [multiple]="uploadType === 'multi' ? 'multiple' : '' "
           (click)="fileInput.value = null"
           (change)="onChange(fileInput)"
           [accept]="accept"
           class="file-input"
          >

    <div class="cropperJsOverlay" *ngIf="currentCropperFile">
     <div class="cropperJsBox">
     <img [src]="safeCropImgUrl" id="cropper-img" (load) = "cropperImgLoaded($event)">
        <div class="cropper-actions">
        <button class="cropSubmit" (click)="onCropSubmit()">{{_captions?.cropper?.crop}}</button>
        <button class="cropCancel" (click)="closeCropper({file: currentCropperFile, fileName: currentCropperFile.name})">
        {{_captions?.cropper?.cancel}}
        </button> </div>
      </div>
    </div>
    <div class="files-preview-wrapper" *ngIf="showPreviewContainer">
      <file-preview-container *ngIf="files"
      [previewFiles]="files"
      (removeFile)="removeFile($event)"
      (uploadSuccess)="onUploadSuccess($event)"
      [adapter]="adapter"
      [itemTemplate]="itemTemplate"
      [captions]="_captions"
      > </file-preview-container>
    </div>

  `,
                styles: ["*{box-sizing:border-box}:host{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-align:center;align-items:center;width:100%;height:100%;overflow:auto;max-width:440px;border-radius:6px}.files-preview-wrapper{width:100%}#cropper-img{max-width:60vw}#cropper-img img{width:100%;height:100%}.file-drop-wrapper{width:100%;background:#fafbfd;padding-top:20px}.preview-container{display:-webkit-box;display:flex}.cropperJsOverlay{display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;position:fixed;z-index:999;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.32)}.cropperJsBox{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;max-height:calc(100vh - 38px - 50px);max-width:90vw}.cropperJsBox .cropper-actions{display:-webkit-box;display:flex}.cropperJsBox .cropper-actions button{margin:5px;padding:12px 25px;border-radius:6px;border:0;cursor:pointer}.cropperJsBox .cropper-actions .cropSubmit{color:#fff;background:#16a085}::ng-deep.cropper img{max-height:300px!important}#images{display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;width:500px;overflow-x:auto}#images .image{-webkit-box-flex:0;flex:0 0 100px;margin:0 2px;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-align:end;align-items:flex-end}#fileInput{display:none}.uploader-submit-btn{background:#ffd740;color:rgba(0,0,0,.87);border:0;padding:0 16px;line-height:36px;font-size:15px;margin-top:12px;border-radius:4px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12);cursor:pointer}button:disabled{color:rgba(0,0,0,.26);background:#dcdcdc}"]
            }] }
];
/** @nocollapse */
FilePickerComponent.ctorParameters = () => [
    { type: FilePickerService },
    { type: ElementRef }
];
FilePickerComponent.propDecorators = {
    uploadSuccess: [{ type: Output }],
    removeSuccess: [{ type: Output }],
    validationError: [{ type: Output }],
    fileAdded: [{ type: Output }],
    customValidator: [{ type: Input }],
    enableCropper: [{ type: Input }],
    showeDragDropZone: [{ type: Input }],
    showPreviewContainer: [{ type: Input }],
    itemTemplate: [{ type: Input }],
    uploadType: [{ type: Input }],
    fileMaxSize: [{ type: Input }],
    fileMaxCount: [{ type: Input }],
    totalMaxSize: [{ type: Input }],
    accept: [{ type: Input }],
    fileExtensions: [{ type: Input }],
    cropperOptions: [{ type: Input }],
    adapter: [{ type: Input }],
    dropzoneTemplate: [{ type: Input }],
    captions: [{ type: Input }]
};
if (false) {
    /**
     * Emitted when file is uploaded via api successfully. Emitted for every file
     * @type {?}
     */
    FilePickerComponent.prototype.uploadSuccess;
    /**
     * Emitted when file is removed via api successfully. Emitted for every file
     * @type {?}
     */
    FilePickerComponent.prototype.removeSuccess;
    /**
     * Emitted on file validation fail
     * @type {?}
     */
    FilePickerComponent.prototype.validationError;
    /**
     * Emitted when file is added and passed validations. Not uploaded yet
     * @type {?}
     */
    FilePickerComponent.prototype.fileAdded;
    /**
     * Custom validator function
     * @type {?}
     */
    FilePickerComponent.prototype.customValidator;
    /**
     * Whether to enable cropper. Default: disabled
     * @type {?}
     */
    FilePickerComponent.prototype.enableCropper;
    /**
     * Whether to show default drag and drop zone. Default:true
     * @type {?}
     */
    FilePickerComponent.prototype.showeDragDropZone;
    /**
     * Whether to show default files preview container. Default: true
     * @type {?}
     */
    FilePickerComponent.prototype.showPreviewContainer;
    /**
     * Preview Item template
     * @type {?}
     */
    FilePickerComponent.prototype.itemTemplate;
    /**
     * Single or multiple. Default: multi
     * @type {?}
     */
    FilePickerComponent.prototype.uploadType;
    /**
     * Max size of selected file in MB. Default: no limit
     * @type {?}
     */
    FilePickerComponent.prototype.fileMaxSize;
    /**
     * Max count of file in multi-upload. Default: no limit
     * @type {?}
     */
    FilePickerComponent.prototype.fileMaxCount;
    /**
     * Total Max size limit of all files in MB. Default: no limit
     * @type {?}
     */
    FilePickerComponent.prototype.totalMaxSize;
    /**
     * Which file types to show on choose file dialog. Default: show all
     * @type {?}
     */
    FilePickerComponent.prototype.accept;
    /** @type {?} */
    FilePickerComponent.prototype.files;
    /**
     * File extensions filter
     * @type {?}
     */
    FilePickerComponent.prototype.fileExtensions;
    /** @type {?} */
    FilePickerComponent.prototype.cropper;
    /**
     * Cropper options.
     * @type {?}
     */
    FilePickerComponent.prototype.cropperOptions;
    /**
     * Files array for cropper. Will be shown equentially if crop enabled
     * @type {?}
     */
    FilePickerComponent.prototype.filesForCropper;
    /**
     * Current file to be shown in cropper
     * @type {?}
     */
    FilePickerComponent.prototype.currentCropperFile;
    /**
     * Custom api Adapter for uploading/removing files
     * @type {?}
     */
    FilePickerComponent.prototype.adapter;
    /**
     * Custome template for dropzone
     * @type {?}
     */
    FilePickerComponent.prototype.dropzoneTemplate;
    /**
     * Custom captions input. Used for multi language support
     * @type {?}
     */
    FilePickerComponent.prototype.captions;
    /**
     * captions object
     * @type {?}
     */
    FilePickerComponent.prototype._captions;
    /** @type {?} */
    FilePickerComponent.prototype.cropClosed$;
    /** @type {?} */
    FilePickerComponent.prototype._onDestroy$;
    /** @type {?} */
    FilePickerComponent.prototype.safeCropImgUrl;
    /**
     * @type {?}
     * @private
     */
    FilePickerComponent.prototype.fileService;
    /**
     * @type {?}
     * @private
     */
    FilePickerComponent.prototype.elementRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1waWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWF3ZXNvbWUtdXBsb2FkZXIvIiwic291cmNlcyI6WyJsaWIvZmlsZS1waWNrZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSx1QkFBdUIsQ0FBQztBQUN4RCxPQUFPLEVBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBQUUsV0FBVyxFQUFvQixNQUFNLGVBQWUsQ0FBQztBQUdwSSxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0scUJBQXFCLENBQUM7QUFDaEQsT0FBTyxFQUFDLG1CQUFtQixFQUFrQixNQUFNLDBCQUEwQixDQUFDO0FBQzlFLE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLHVCQUF1QixDQUFDO0FBRXhELE9BQU8sRUFBQyxhQUFhLEVBQWMsRUFBRSxFQUFFLE9BQU8sRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUM1RCxPQUFPLEVBQUMsR0FBRyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUNuRCxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFtRG5ELE1BQU0sT0FBTyxtQkFBbUI7Ozs7O0lBeUQ5QixZQUFvQixXQUE4QixFQUN2QyxVQUFzQjtRQURiLGdCQUFXLEdBQVgsV0FBVyxDQUFtQjtRQUN2QyxlQUFVLEdBQVYsVUFBVSxDQUFZOzs7O1FBeER2QixrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFvQixDQUFDOzs7O1FBRXJELGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQW9CLENBQUM7Ozs7UUFFckQsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBbUIsQ0FBQzs7OztRQUV0RCxjQUFTLEdBQUcsSUFBSSxZQUFZLEVBQW9CLENBQUM7Ozs7UUFLMUQsa0JBQWEsR0FBRyxLQUFLLENBQUM7Ozs7UUFFZCxzQkFBaUIsR0FBRyxJQUFJLENBQUM7Ozs7UUFFekIseUJBQW9CLEdBQUcsSUFBSSxDQUFDOzs7O1FBS3BDLGVBQVUsR0FBRyxPQUFPLENBQUM7UUFhdEIsVUFBSyxHQUF1QixFQUFFLENBQUM7Ozs7UUFPL0Isb0JBQWUsR0FBVyxFQUFFLENBQUM7UUFZNUIsZ0JBQVcsR0FBRyxJQUFJLE9BQU8sRUFBb0IsQ0FBQztRQUM5QyxnQkFBVyxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7SUFLbkMsQ0FBQzs7OztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDckIsQ0FBQzs7OztJQUNELFdBQVc7UUFDVCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzFCLENBQUM7Ozs7SUFDRCxXQUFXO1FBQ1gsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsUUFBUSxJQUFJLGVBQWUsQ0FBQztJQUNsRCxDQUFDOzs7OztJQUVELGlCQUFpQjtRQUNmLElBQUksQ0FBQyxXQUFXO2FBQ2YsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7YUFDakMsU0FBUzs7OztRQUFDLENBQUMsR0FBcUIsRUFBRSxFQUFFOztrQkFDN0IsWUFBWSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUzs7OztZQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsUUFBUSxFQUFDOztrQkFDakYsUUFBUSxHQUFHLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVM7WUFDMUYsd0JBQXdCO1lBQzNCLGdDQUFnQztZQUM1QixJQUFJLENBQUMsZUFBZSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsTUFBTTs7OztZQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsUUFBUSxFQUFDLENBQUM7WUFDN0YscUNBQXFDO1lBQ3BDLElBQUksUUFBUSxFQUFFO2dCQUNYLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7YUFDN0I7UUFDSCxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7O0lBRUQsaUJBQWlCO1FBQ2YsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUU7WUFDMUIsSUFBSSxDQUFDLHdCQUF3QixFQUFFLENBQUM7U0FDL0I7SUFDSCxDQUFDOzs7OztJQUVELHdCQUF3QjtRQUN0QixJQUFJLENBQUMsY0FBYyxHQUFHO1lBQ3BCLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLFdBQVcsRUFBRSxDQUFDO1lBQ2QsUUFBUSxFQUFFLElBQUk7WUFDZCxPQUFPLEVBQUUsSUFBSTtZQUNiLFFBQVEsRUFBRSxJQUFJO1lBQ2QsUUFBUSxFQUFFLElBQUk7WUFDZCxZQUFZLEVBQUUsR0FBRztTQUNsQixDQUFDO0lBQ0osQ0FBQzs7Ozs7O0lBRUQsUUFBUSxDQUFFLFNBQTJCOztjQUM1QixLQUFLLEdBQVksS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDO1FBQ25ELElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDdEMsQ0FBQzs7Ozs7O0lBRUEsV0FBVyxDQUFDLEtBQWE7UUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQUU7O2NBQ25ELGlCQUFpQixHQUFHLEtBQUssQ0FBQyxLQUFLOzs7O1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUM7O2NBQ3BFLGNBQWMsR0FBRyxLQUFLLENBQUMsR0FBRzs7OztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxFQUFDO1FBQ3RFLE9BQU8sYUFBYSxDQUFDLEdBQUcsY0FBYyxDQUFDO2FBQ3BDLElBQUksQ0FDSCxHQUFHOzs7O1FBQUMsR0FBRyxDQUFDLEVBQUU7O2tCQUNGLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxLQUFLOzs7O1lBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEtBQUssSUFBSSxFQUFDO1lBQy9ELElBQUksQ0FBQyxpQkFBaUIsSUFBSSxDQUFDLGtCQUFrQixFQUFFO2dCQUFDLE9BQU87YUFBRTtZQUN6RCxLQUFLLENBQUMsT0FBTzs7Ozs7WUFBQyxDQUFDLElBQVUsRUFBRSxLQUFhLEVBQUUsRUFBRTtnQkFDMUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFFLENBQUM7WUFDckMsQ0FBQyxFQUFDLENBQUM7UUFDTCxDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ04sQ0FBQzs7Ozs7O0lBRUQsZ0JBQWdCLENBQUMsSUFBVTtRQUN6QixJQUFJLENBQUMsSUFBSSxFQUFFO1lBQUMsT0FBTztTQUFFO1FBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFBQyxPQUFPO1NBQUU7UUFDN0MsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQUMsT0FBTztTQUFFO1FBQ3ZELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7Ozs7O0lBRUQsaUJBQWlCLENBQUMsSUFBVTtRQUMxQixJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQUU7UUFDOUMsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FDcEMsR0FBRzs7OztRQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ1IsSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLG1CQUFtQixDQUFDLGVBQWUsRUFBQyxDQUFDLENBQUM7YUFBRTtRQUNwRyxDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQzs7Ozs7OztJQUVELGVBQWUsQ0FBQyxJQUFVLEVBQUUsS0FBSzs7Y0FDekIsSUFBSSxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ25DLElBQUksSUFBSSxLQUFLLE9BQU8sSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQzFDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2hDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFO2dCQUM5QixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3hCO1NBQ0Y7YUFBTTtZQUNMLHVGQUF1RjtZQUN0RixJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDdEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUNwQjtTQUNIO0lBQ0gsQ0FBQzs7Ozs7O0lBRUQsaUJBQWlCLENBQUMsSUFBSTtRQUNwQixJQUFJLElBQUksQ0FBQyxVQUFVLEtBQUssUUFBUSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUN6RCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLG1CQUFtQixDQUFDLFVBQVUsRUFBQyxDQUFDLENBQUM7WUFDL0UsT0FBTyxLQUFLLENBQUM7U0FDZDthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUM7U0FDYjtJQUNILENBQUM7Ozs7OztJQUVELG1CQUFtQixDQUFDLEtBQWE7UUFDL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFHO1lBQ2hGLE9BQU8sSUFBSSxDQUFDO1NBQ1o7YUFBTTtZQUNMLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsbUJBQW1CLENBQUMsWUFBWSxFQUFDLENBQUMsQ0FBQztZQUNsRixPQUFPLEtBQUssQ0FBQztTQUNiO0lBQ0osQ0FBQzs7Ozs7O0lBRUQsT0FBTyxDQUFDLEtBQWtCOztjQUNsQixLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUs7O2NBQ25CLGNBQWMsR0FBVyxFQUFFO1FBQ2pDLEtBQUssTUFBTSxXQUFXLElBQUksS0FBSyxDQUFDLEtBQUssRUFBRTtZQUNyQyxnQkFBZ0I7WUFDaEIsSUFBSSxXQUFXLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRTs7c0JBQzFCLFNBQVMsR0FBRyxtQkFBQSxXQUFXLENBQUMsU0FBUyxFQUF1QjtnQkFDOUQsU0FBUyxDQUFDLElBQUk7Ozs7Z0JBQUMsQ0FBQyxJQUFVLEVBQUUsRUFBRTtvQkFDNUIsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDNUIsQ0FBQyxFQUFDLENBQUM7YUFDSjtpQkFBTTs7O3NCQUVDLFNBQVMsR0FBRyxtQkFBQSxXQUFXLENBQUMsU0FBUyxFQUE0QjtnQkFDcEUsb0RBQW9EO2FBQ3BEO1NBQ0Y7UUFDRCxVQUFVOzs7UUFBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFDLENBQUM7SUFDakUsQ0FBQzs7Ozs7OztJQUVELFFBQVEsQ0FBRSxJQUFVLEVBQUUsUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJO1FBQ3RDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFDLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUM7SUFDM0QsQ0FBQzs7Ozs7O0lBRUQsV0FBVyxDQUFDLElBQVU7UUFDcEIsSUFBSSxDQUFDLG1CQUFLLE1BQU0sRUFBQSxDQUFDLENBQUMsa0JBQWtCLElBQUksT0FBTyxPQUFPLEtBQUssV0FBVyxFQUFHO1lBQ3ZFLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0QsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQztTQUNoQzthQUFPO1lBQ04sT0FBTyxDQUFDLElBQUksQ0FBQyxtSEFBbUgsQ0FBQyxDQUFDO1lBQ2xJLE9BQU87U0FDUjtJQUNILENBQUM7Ozs7O0lBQ0QsVUFBVSxDQUFDLElBQVU7UUFDbkIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5QyxDQUFDOzs7Ozs7SUFFRCxnQkFBZ0IsQ0FBQyxDQUFDOztjQUNWLEtBQUssR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQztRQUNwRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksT0FBTyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDekQsQ0FBQzs7Ozs7O0lBRUQsWUFBWSxDQUFDLFdBQTZCO1FBQ3hDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxTQUFTLENBQUM7UUFDcEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxTQUFTLENBQUM7UUFDekIsVUFBVTs7O1FBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUUsR0FBRyxDQUFDLENBQUM7SUFDNUQsQ0FBQzs7Ozs7O0lBRUQsa0JBQWtCLENBQUMsSUFBc0I7UUFDdkMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFFLENBQUMsS0FBSyxJQUFJLEVBQUMsQ0FBQztJQUNuRCxDQUFDOzs7Ozs7SUFFRCxlQUFlLENBQUMsUUFBMEI7UUFDeEMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDcEMsQ0FBQzs7Ozs7OztJQUVGLGdCQUFnQixDQUFDLElBQVUsRUFBRSxRQUFnQjtRQUM1QyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUFDLE9BQU8sSUFBSSxDQUFDO1NBQUU7O2NBQ25DLFNBQVMsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRTs7Y0FDckMsY0FBYyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRzs7OztRQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxFQUFDO1FBQ3hFLElBQUksY0FBYyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtZQUMxRCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLG1CQUFtQixDQUFDLFVBQVUsRUFBQyxDQUFDLENBQUM7WUFDL0UsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNFLE9BQU8sSUFBSSxDQUFDO0lBQ2pCLENBQUM7Ozs7Ozs7SUFFQyxXQUFXLENBQUMsSUFBVSxFQUFFLElBQVk7Ozs7O2NBRTVCLEdBQUcsR0FBVyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQzs7WUFDOUMsZUFBd0I7O1lBQ3hCLG9CQUE2QjtRQUNqQyxJQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFFLElBQUksQ0FBQyxXQUFXLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRTtZQUN2RSxlQUFlLEdBQUcsSUFBSSxDQUFDO1NBQ3hCO2FBQU07WUFDTCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLG1CQUFtQixDQUFDLFdBQVcsRUFBQyxDQUFDLENBQUM7U0FDakY7Ozs7O2NBRUssU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRzs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUMsQ0FBQyxNQUFNOzs7OztRQUFDLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsR0FBRyxHQUFHLElBQUksR0FBRSxDQUFDLENBQUM7UUFDckYsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUU7WUFDeEcsb0JBQW9CLEdBQUcsSUFBSSxDQUFDO1NBQzlCO2FBQU07WUFDTCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLG1CQUFtQixDQUFDLFlBQVksRUFBQyxDQUFDLENBQUM7U0FDbEY7UUFDRCxPQUFPLENBQUMsQ0FBQyxlQUFlLElBQUksb0JBQW9CLENBQUM7SUFDckQsQ0FBQzs7Ozs7SUFDRCxRQUFRLENBQUMsSUFBSTtRQUNYLE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQztJQUNwQyxDQUFDOzs7OztJQUVELFlBQVk7UUFDVixJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ3JGLENBQUM7Ozs7OztJQUVELFlBQVksQ0FBQyxJQUFVO1FBQ3JCLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFBQyxPQUFPO1NBQUM7UUFDcEIsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLG1CQUFNLElBQUksRUFBQSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUMzQyxJQUFJLENBQUMsUUFBUSxDQUFDLG1CQUFNLElBQUksRUFBQSxFQUFFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN6RDtRQUNGLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBQyxJQUFJLEVBQUUsbUJBQUEsSUFBSSxFQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLEVBQUMsQ0FBQyxDQUFDO0lBQ2pGLENBQUM7Ozs7O0lBQ0QsVUFBVSxDQUFDLFFBQTBCO1FBQ25DLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNoQixJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUM7aUJBQ2hDLFNBQVM7Ozs7WUFBQyxHQUFHLENBQUMsRUFBRTtnQkFDZixJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ2pDLENBQUMsRUFBQyxDQUFDO1NBQ0g7YUFBTTtZQUNOLE9BQU8sQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQztTQUN4QztJQUNILENBQUM7Ozs7OztJQUVGLGVBQWUsQ0FBQyxRQUEwQjtRQUN4QyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDcEMsQ0FBQzs7O1lBcFZGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsaUJBQWlCO2dCQUMzQixRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQTBDVDs7YUFFRjs7OztZQTVETyxpQkFBaUI7WUFDTixVQUFVOzs7NEJBOEQxQixNQUFNOzRCQUVOLE1BQU07OEJBRU4sTUFBTTt3QkFFTixNQUFNOzhCQUVOLEtBQUs7NEJBRUwsS0FBSztnQ0FHTCxLQUFLO21DQUVMLEtBQUs7MkJBRUwsS0FBSzt5QkFFTCxLQUFLOzBCQUdMLEtBQUs7MkJBR0wsS0FBSzsyQkFHTCxLQUFLO3FCQUdMLEtBQUs7NkJBSUwsS0FBSzs2QkFHTCxLQUFLO3NCQU1MLEtBQUs7K0JBR0osS0FBSzt1QkFFTCxLQUFLOzs7Ozs7O0lBakRQLDRDQUErRDs7Ozs7SUFFL0QsNENBQStEOzs7OztJQUUvRCw4Q0FBZ0U7Ozs7O0lBRWhFLHdDQUEyRDs7Ozs7SUFFM0QsOENBQThEOzs7OztJQUU5RCw0Q0FDdUI7Ozs7O0lBRXZCLGdEQUFrQzs7Ozs7SUFFbEMsbURBQXFDOzs7OztJQUVyQywyQ0FBd0M7Ozs7O0lBRXhDLHlDQUNzQjs7Ozs7SUFFdEIsMENBQ3FCOzs7OztJQUVyQiwyQ0FDc0I7Ozs7O0lBRXRCLDJDQUNzQjs7Ozs7SUFFdEIscUNBQ2U7O0lBQ2Ysb0NBQStCOzs7OztJQUUvQiw2Q0FBa0M7O0lBQ2xDLHNDQUFhOzs7OztJQUViLDZDQUFnQzs7Ozs7SUFFaEMsOENBQTZCOzs7OztJQUU1QixpREFBeUI7Ozs7O0lBRTFCLHNDQUM0Qjs7Ozs7SUFFM0IsK0NBQTRDOzs7OztJQUU1Qyx1Q0FBb0M7Ozs7O0lBRXBDLHdDQUE0Qjs7SUFDNUIsMENBQThDOztJQUM5QywwQ0FBa0M7O0lBQ2xDLDZDQUFnQzs7Ozs7SUFDckIsMENBQXNDOzs7OztJQUMvQyx5Q0FBOEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0ZpbGVQaWNrZXJTZXJ2aWNlfSBmcm9tICcuL2ZpbGUtcGlja2VyLnNlcnZpY2UnO1xyXG5pbXBvcnQge0NvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCwgVGVtcGxhdGVSZWYsIENoYW5nZURldGVjdG9yUmVmfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtTYWZlUmVzb3VyY2VVcmx9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xyXG5pbXBvcnQge0ZpbGVQcmV2aWV3TW9kZWx9IGZyb20gJy4vZmlsZS1wcmV2aWV3Lm1vZGVsJztcclxuaW1wb3J0IHtnZXRGaWxlVHlwZX0gZnJvbSAnLi9maWxlLXVwbG9hZC51dGlscyc7XHJcbmltcG9ydCB7RmlsZVZhbGlkYXRpb25UeXBlcywgVmFsaWRhdGlvbkVycm9yfSBmcm9tICcuL3ZhbGlkYXRpb24tZXJyb3IubW9kZWwnO1xyXG5pbXBvcnQge0ZpbGVQaWNrZXJBZGFwdGVyfSBmcm9tICcuL2ZpbGUtcGlja2VyLmFkYXB0ZXInO1xyXG5pbXBvcnQge0ZpbGVTeXN0ZW1EaXJlY3RvcnlFbnRyeSwgRmlsZVN5c3RlbUZpbGVFbnRyeSwgVXBsb2FkRXZlbnR9IGZyb20gJy4vZmlsZS1kcm9wJztcclxuaW1wb3J0IHtjb21iaW5lTGF0ZXN0LCBPYnNlcnZhYmxlLCBvZiwgU3ViamVjdH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7bWFwLCB0YWtlVW50aWwsIHRhcH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQge0RlZmF1bHRDYXB0aW9uc30gZnJvbSAnLi9kZWZhdWx0LWNhcHRpb25zJztcclxuaW1wb3J0IHtVcGxvYWRlckNhcHRpb25zfSBmcm9tICcuL3VwbG9hZGVyLWNhcHRpb25zJztcclxuXHJcbmRlY2xhcmUgdmFyIENyb3BwZXI7XHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbmd4LWZpbGUtcGlja2VyJyxcclxuICB0ZW1wbGF0ZTogYFxyXG4gICA8ZGl2IChjbGljayk9XCJmaWxlSW5wdXQuY2xpY2soKVwiIGNsYXNzPVwiZmlsZS1kcm9wLXdyYXBwZXJcIiAqbmdJZj1cInNob3dlRHJhZ0Ryb3Bab25lXCI+XHJcbiAgICAgIDxmaWxlLWRyb3BcclxuICAgICAgICAob25GaWxlRHJvcCk9XCJkcm9wcGVkKCRldmVudClcIlxyXG4gICAgICAgIFtjdXN0b21zdHlsZV09XCInY3VzdG9tLWRyYWcnXCJcclxuICAgICAgICBbY2FwdGlvbnNdPVwiX2NhcHRpb25zXCJcclxuICAgICAgPlxyXG4gICAgICA8bmctY29udGVudCBzZWxlY3Q9XCIuZHJvcHpvbmVUZW1wbGF0ZVwiPiA8L25nLWNvbnRlbnQ+XHJcbiAgICAgIDwvZmlsZS1kcm9wPlxyXG4gICAgPC9kaXY+XHJcblxyXG5cclxuICAgIDxpbnB1dCB0eXBlPVwiZmlsZVwiIG5hbWU9XCJmaWxlW11cIiBpZD1cImZpbGVJbnB1dFwiXHJcbiAgICAgICAgICAgI2ZpbGVJbnB1dFxyXG4gICAgICAgICAgIFttdWx0aXBsZV09XCJ1cGxvYWRUeXBlID09PSAnbXVsdGknID8gJ211bHRpcGxlJyA6ICcnIFwiXHJcbiAgICAgICAgICAgKGNsaWNrKT1cImZpbGVJbnB1dC52YWx1ZSA9IG51bGxcIlxyXG4gICAgICAgICAgIChjaGFuZ2UpPVwib25DaGFuZ2UoZmlsZUlucHV0KVwiXHJcbiAgICAgICAgICAgW2FjY2VwdF09XCJhY2NlcHRcIlxyXG4gICAgICAgICAgIGNsYXNzPVwiZmlsZS1pbnB1dFwiXHJcbiAgICAgICAgICA+XHJcblxyXG4gICAgPGRpdiBjbGFzcz1cImNyb3BwZXJKc092ZXJsYXlcIiAqbmdJZj1cImN1cnJlbnRDcm9wcGVyRmlsZVwiPlxyXG4gICAgIDxkaXYgY2xhc3M9XCJjcm9wcGVySnNCb3hcIj5cclxuICAgICA8aW1nIFtzcmNdPVwic2FmZUNyb3BJbWdVcmxcIiBpZD1cImNyb3BwZXItaW1nXCIgKGxvYWQpID0gXCJjcm9wcGVySW1nTG9hZGVkKCRldmVudClcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwiY3JvcHBlci1hY3Rpb25zXCI+XHJcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImNyb3BTdWJtaXRcIiAoY2xpY2spPVwib25Dcm9wU3VibWl0KClcIj57e19jYXB0aW9ucz8uY3JvcHBlcj8uY3JvcH19PC9idXR0b24+XHJcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImNyb3BDYW5jZWxcIiAoY2xpY2spPVwiY2xvc2VDcm9wcGVyKHtmaWxlOiBjdXJyZW50Q3JvcHBlckZpbGUsIGZpbGVOYW1lOiBjdXJyZW50Q3JvcHBlckZpbGUubmFtZX0pXCI+XHJcbiAgICAgICAge3tfY2FwdGlvbnM/LmNyb3BwZXI/LmNhbmNlbH19XHJcbiAgICAgICAgPC9idXR0b24+IDwvZGl2PlxyXG4gICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG4gICAgPGRpdiBjbGFzcz1cImZpbGVzLXByZXZpZXctd3JhcHBlclwiICpuZ0lmPVwic2hvd1ByZXZpZXdDb250YWluZXJcIj5cclxuICAgICAgPGZpbGUtcHJldmlldy1jb250YWluZXIgKm5nSWY9XCJmaWxlc1wiXHJcbiAgICAgIFtwcmV2aWV3RmlsZXNdPVwiZmlsZXNcIlxyXG4gICAgICAocmVtb3ZlRmlsZSk9XCJyZW1vdmVGaWxlKCRldmVudClcIlxyXG4gICAgICAodXBsb2FkU3VjY2Vzcyk9XCJvblVwbG9hZFN1Y2Nlc3MoJGV2ZW50KVwiXHJcbiAgICAgIFthZGFwdGVyXT1cImFkYXB0ZXJcIlxyXG4gICAgICBbaXRlbVRlbXBsYXRlXT1cIml0ZW1UZW1wbGF0ZVwiXHJcbiAgICAgIFtjYXB0aW9uc109XCJfY2FwdGlvbnNcIlxyXG4gICAgICA+IDwvZmlsZS1wcmV2aWV3LWNvbnRhaW5lcj5cclxuICAgIDwvZGl2PlxyXG5cclxuICBgLFxyXG4gIHN0eWxlVXJsczogWycuL2ZpbGUtcGlja2VyLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIEZpbGVQaWNrZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcbiAgLyoqIEVtaXR0ZWQgd2hlbiBmaWxlIGlzIHVwbG9hZGVkIHZpYSBhcGkgc3VjY2Vzc2Z1bGx5LiBFbWl0dGVkIGZvciBldmVyeSBmaWxlICovXHJcbiAgQE91dHB1dCgpIHVwbG9hZFN1Y2Nlc3MgPSBuZXcgRXZlbnRFbWl0dGVyPEZpbGVQcmV2aWV3TW9kZWw+KCk7XHJcbiAgLyoqIEVtaXR0ZWQgd2hlbiBmaWxlIGlzIHJlbW92ZWQgdmlhIGFwaSBzdWNjZXNzZnVsbHkuIEVtaXR0ZWQgZm9yIGV2ZXJ5IGZpbGUgKi9cclxuICBAT3V0cHV0KCkgcmVtb3ZlU3VjY2VzcyA9IG5ldyBFdmVudEVtaXR0ZXI8RmlsZVByZXZpZXdNb2RlbD4oKTtcclxuICAvKiogRW1pdHRlZCBvbiBmaWxlIHZhbGlkYXRpb24gZmFpbCAqL1xyXG4gIEBPdXRwdXQoKSB2YWxpZGF0aW9uRXJyb3IgPSBuZXcgRXZlbnRFbWl0dGVyPFZhbGlkYXRpb25FcnJvcj4oKTtcclxuICAvKiogRW1pdHRlZCB3aGVuIGZpbGUgaXMgYWRkZWQgYW5kIHBhc3NlZCB2YWxpZGF0aW9ucy4gTm90IHVwbG9hZGVkIHlldCAqL1xyXG4gIEBPdXRwdXQoKSBmaWxlQWRkZWQgPSBuZXcgRXZlbnRFbWl0dGVyPEZpbGVQcmV2aWV3TW9kZWw+KCk7XHJcbiAgLyoqIEN1c3RvbSB2YWxpZGF0b3IgZnVuY3Rpb24gKi9cclxuICBASW5wdXQoKSBjdXN0b21WYWxpZGF0b3I6IChmaWxlOiBGaWxlKSA9PiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xyXG4gIC8qKiBXaGV0aGVyIHRvIGVuYWJsZSBjcm9wcGVyLiBEZWZhdWx0OiBkaXNhYmxlZCAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgIGVuYWJsZUNyb3BwZXIgPSBmYWxzZTtcclxuICAvKiogV2hldGhlciB0byBzaG93IGRlZmF1bHQgZHJhZyBhbmQgZHJvcCB6b25lLiBEZWZhdWx0OnRydWUgKi9cclxuICBASW5wdXQoKSBzaG93ZURyYWdEcm9wWm9uZSA9IHRydWU7XHJcbiAgIC8qKiBXaGV0aGVyIHRvIHNob3cgZGVmYXVsdCBmaWxlcyBwcmV2aWV3IGNvbnRhaW5lci4gRGVmYXVsdDogdHJ1ZSAqL1xyXG4gIEBJbnB1dCgpIHNob3dQcmV2aWV3Q29udGFpbmVyID0gdHJ1ZTtcclxuICAgLyoqIFByZXZpZXcgSXRlbSB0ZW1wbGF0ZSAqL1xyXG4gIEBJbnB1dCgpIGl0ZW1UZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcclxuICAvKiogU2luZ2xlIG9yIG11bHRpcGxlLiBEZWZhdWx0OiBtdWx0aSAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgIHVwbG9hZFR5cGUgPSAnbXVsdGknO1xyXG4gIC8qKiBNYXggc2l6ZSBvZiBzZWxlY3RlZCBmaWxlIGluIE1CLiBEZWZhdWx0OiBubyBsaW1pdCAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgIGZpbGVNYXhTaXplOiBudW1iZXI7XHJcbiAgLyoqIE1heCBjb3VudCBvZiBmaWxlIGluIG11bHRpLXVwbG9hZC4gRGVmYXVsdDogbm8gbGltaXQgKi9cclxuICBASW5wdXQoKVxyXG4gICBmaWxlTWF4Q291bnQ6IG51bWJlcjtcclxuICAvKiogVG90YWwgTWF4IHNpemUgbGltaXQgb2YgYWxsIGZpbGVzIGluIE1CLiBEZWZhdWx0OiBubyBsaW1pdCAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgIHRvdGFsTWF4U2l6ZTogbnVtYmVyO1xyXG4gIC8qKiBXaGljaCBmaWxlIHR5cGVzIHRvIHNob3cgb24gY2hvb3NlIGZpbGUgZGlhbG9nLiBEZWZhdWx0OiBzaG93IGFsbCAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgYWNjZXB0OiBzdHJpbmc7XHJcbiAgZmlsZXM6IEZpbGVQcmV2aWV3TW9kZWxbXSA9IFtdO1xyXG4gLyoqIEZpbGUgZXh0ZW5zaW9ucyBmaWx0ZXIgKi9cclxuICBASW5wdXQoKSBmaWxlRXh0ZW5zaW9uczogU3RyaW5nW107XHJcbiAgY3JvcHBlcjogYW55O1xyXG4gIC8qKiBDcm9wcGVyIG9wdGlvbnMuICovXHJcbiAgQElucHV0KCkgY3JvcHBlck9wdGlvbnM6IE9iamVjdDtcclxuICAvKiogRmlsZXMgYXJyYXkgZm9yIGNyb3BwZXIuIFdpbGwgYmUgc2hvd24gZXF1ZW50aWFsbHkgaWYgY3JvcCBlbmFibGVkICovXHJcbiAgZmlsZXNGb3JDcm9wcGVyOiBGaWxlW10gPSBbXTtcclxuICAgLyoqIEN1cnJlbnQgZmlsZSB0byBiZSBzaG93biBpbiBjcm9wcGVyKi9cclxuICAgY3VycmVudENyb3BwZXJGaWxlOiBGaWxlO1xyXG4gIC8qKiBDdXN0b20gYXBpIEFkYXB0ZXIgZm9yIHVwbG9hZGluZy9yZW1vdmluZyBmaWxlcyAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgIGFkYXB0ZXI6IEZpbGVQaWNrZXJBZGFwdGVyO1xyXG4gIC8qKiAgQ3VzdG9tZSB0ZW1wbGF0ZSBmb3IgZHJvcHpvbmUgKi9cclxuICAgQElucHV0KCkgZHJvcHpvbmVUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcclxuICAvKiogQ3VzdG9tIGNhcHRpb25zIGlucHV0LiBVc2VkIGZvciBtdWx0aSBsYW5ndWFnZSBzdXBwb3J0ICovXHJcbiAgIEBJbnB1dCgpIGNhcHRpb25zOiBVcGxvYWRlckNhcHRpb25zO1xyXG4gICAvKiogY2FwdGlvbnMgb2JqZWN0Ki9cclxuICAgX2NhcHRpb25zOiBVcGxvYWRlckNhcHRpb25zO1xyXG4gICBjcm9wQ2xvc2VkJCA9IG5ldyBTdWJqZWN0PEZpbGVQcmV2aWV3TW9kZWw+KCk7XHJcbiAgIF9vbkRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcclxuICAgc2FmZUNyb3BJbWdVcmw6IFNhZmVSZXNvdXJjZVVybDtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGZpbGVTZXJ2aWNlOiBGaWxlUGlja2VyU2VydmljZSxcclxuICAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWZcclxuICAgICApIHtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5zZXRDcm9wcGVyT3B0aW9ucygpO1xyXG4gICAgdGhpcy5saXN0ZW5Ub0Nyb3BDbG9zZSgpO1xyXG4gICAgdGhpcy5zZXRDYXB0aW9ucygpO1xyXG4gIH1cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMuX29uRGVzdHJveSQubmV4dCgpO1xyXG4gIH1cclxuICBzZXRDYXB0aW9ucygpIHtcclxuICB0aGlzLl9jYXB0aW9ucyA9IHRoaXMuY2FwdGlvbnMgfHwgRGVmYXVsdENhcHRpb25zO1xyXG4gIH1cclxuICAvKiogTGlzdGVuIHdoZW4gQ3JvcHBlciBpcyBjbG9zZWQgYW5kIG9wZW4gbmV3IGNyb3BwZXIgaWYgbmV4dCBpbWFnZSBleGlzdHMgKi9cclxuICBsaXN0ZW5Ub0Nyb3BDbG9zZSgpIHtcclxuICAgIHRoaXMuY3JvcENsb3NlZCRcclxuICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLl9vbkRlc3Ryb3kkKSlcclxuICAgIC5zdWJzY3JpYmUoKHJlczogRmlsZVByZXZpZXdNb2RlbCkgPT4ge1xyXG4gICAgICBjb25zdCBjcm9wcGVkSW5kZXggPSB0aGlzLmZpbGVzRm9yQ3JvcHBlci5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLm5hbWUgPT09IHJlcy5maWxlTmFtZSk7XHJcbiAgICAgIGNvbnN0IG5leHRGaWxlID0gY3JvcHBlZEluZGV4ICE9PSAtMSA/IHRoaXMuZmlsZXNGb3JDcm9wcGVyW2Nyb3BwZWRJbmRleCArIDFdIDogdW5kZWZpbmVkO1xyXG4gICAgIC8vIGNvbnNvbGUubG9nKG5leHRGaWxlKVxyXG4gIC8vICBjb25zb2xlLmxvZygnY3JvcHBlZCcsIHJlcyk7XHJcbiAgICAgIHRoaXMuZmlsZXNGb3JDcm9wcGVyID0gWy4uLnRoaXMuZmlsZXNGb3JDcm9wcGVyXS5maWx0ZXIoaXRlbSA9PiBpdGVtLm5hbWUgIT09IHJlcy5maWxlTmFtZSk7XHJcbiAgICAgLy8gY29uc29sZS5sb2codGhpcy5maWxlc0ZvckNyb3BwZXIpO1xyXG4gICAgICBpZiAobmV4dEZpbGUpIHtcclxuICAgICAgICAgdGhpcy5vcGVuQ3JvcHBlcihuZXh0RmlsZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuLyoqIFNldHMgY3VzdG9tIGNyb3BwZXIgb3B0aW9ucyBpZiBhdmFpYWJsZSAqL1xyXG4gIHNldENyb3BwZXJPcHRpb25zKCkge1xyXG4gICAgaWYgKCF0aGlzLmNyb3BwZXJPcHRpb25zKSB7XHJcbiAgICB0aGlzLnNldERlZmF1bHRDcm9wcGVyT3B0aW9ucygpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKiogU2V0cyBtYW51YWwgY3JvcHBlciBvcHRpb25zIGlmIG5vIGN1c3RvbSBvcHRpb25zIGFyZSBhdmFpYWJsZSAqL1xyXG4gIHNldERlZmF1bHRDcm9wcGVyT3B0aW9ucygpIHtcclxuICAgIHRoaXMuY3JvcHBlck9wdGlvbnMgPSB7XHJcbiAgICAgIGRyYWdNb2RlOiAnY3JvcCcsXHJcbiAgICAgIGFzcGVjdFJhdGlvOiAxLFxyXG4gICAgICBhdXRvQ3JvcDogdHJ1ZSxcclxuICAgICAgbW92YWJsZTogdHJ1ZSxcclxuICAgICAgem9vbWFibGU6IHRydWUsXHJcbiAgICAgIHNjYWxhYmxlOiB0cnVlLFxyXG4gICAgICBhdXRvQ3JvcEFyZWE6IDAuOFxyXG4gICAgfTtcclxuICB9XHJcbiAgLyoqIE9uIGlucHV0IGZpbGUgc2VsZWN0ZWQgKi9cclxuICBvbkNoYW5nZSggZmlsZUlucHV0OiBIVE1MSW5wdXRFbGVtZW50KSB7XHJcbiAgICAgY29uc3QgZmlsZXM6IEZpbGVbXSA9ICBBcnJheS5mcm9tKGZpbGVJbnB1dC5maWxlcyk7XHJcbiAgICB0aGlzLmhhbmRsZUZpbGVzKGZpbGVzKS5zdWJzY3JpYmUoKTtcclxuICB9XHJcbiAgLyoqIEhhbmRsZXMgaW5wdXQgYW5kIGRyYWcvZHJvcCBmaWxlcyAqL1xyXG4gICBoYW5kbGVGaWxlcyhmaWxlczogRmlsZVtdKTogT2JzZXJ2YWJsZTx2b2lkPiB7XHJcbiAgICBpZiAoIXRoaXMuaXNWYWxpZE1heEZpbGVDb3VudChmaWxlcykpIHtyZXR1cm4gb2YobnVsbCk7IH1cclxuICAgIGNvbnN0IGlzVmFsaWRVcGxvYWRTeW5jID0gZmlsZXMuZXZlcnkoaXRlbSA9PiB0aGlzLnZhbGlkYXRlRmlsZVN5bmMoaXRlbSkpO1xyXG4gICAgY29uc3QgYXN5bmNGdW5jdGlvbnMgPSBmaWxlcy5tYXAoaXRlbSA9PiB0aGlzLnZhbGlkYXRlRmlsZUFzeW5jKGl0ZW0pKTtcclxuICAgIHJldHVybiBjb21iaW5lTGF0ZXN0KC4uLmFzeW5jRnVuY3Rpb25zKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICBtYXAocmVzID0+IHtcclxuICAgICAgICAgIGNvbnN0IGlzVmFsaWRVcGxvYWRBc3luYyA9IHJlcy5ldmVyeShyZXN1bHQgPT4gcmVzdWx0ID09PSB0cnVlKTtcclxuICAgICAgICAgIGlmICghaXNWYWxpZFVwbG9hZFN5bmMgfHwgIWlzVmFsaWRVcGxvYWRBc3luYykge3JldHVybjsgfVxyXG4gICAgICAgICAgZmlsZXMuZm9yRWFjaCgoZmlsZTogRmlsZSwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZUlucHV0RmlsZShmaWxlLCBpbmRleCApO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICB9XHJcbiAgLyoqIFZhbGlkYXRlcyBzeW5jaHJvbm91cyB2YWxpZGF0aW9ucyAqL1xyXG4gIHZhbGlkYXRlRmlsZVN5bmMoZmlsZTogRmlsZSk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCFmaWxlKSB7cmV0dXJuOyB9XHJcbiAgICBpZiAoIXRoaXMuaXNWYWxpZFVwbG9hZFR5cGUoZmlsZSkpIHtyZXR1cm47IH1cclxuICAgIGlmICghdGhpcy5pc1ZhbGlkRXh0ZW5zaW9uKGZpbGUsIGZpbGUubmFtZSkpIHtyZXR1cm47IH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuICAvKiogVmFsaWRhdGVzIGFzeW5jaHJvbm91cyB2YWxpZGF0aW9ucyAqL1xyXG4gIHZhbGlkYXRlRmlsZUFzeW5jKGZpbGU6IEZpbGUpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGlmICghdGhpcy5jdXN0b21WYWxpZGF0b3IpIHtyZXR1cm4gb2YodHJ1ZSk7IH1cclxuICAgIHJldHVybiB0aGlzLmN1c3RvbVZhbGlkYXRvcihmaWxlKS5waXBlKFxyXG4gICAgICB0YXAocmVzID0+IHtcclxuICAgICAgICBpZiAoIXJlcykgeyB0aGlzLnZhbGlkYXRpb25FcnJvci5uZXh0KHtmaWxlOiBmaWxlLCBlcnJvcjogRmlsZVZhbGlkYXRpb25UeXBlcy5jdXN0b21WYWxpZGF0b3J9KTsgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqIEhhbmRsZXMgaW5wdXQgYW5kIGRyYWcmZHJvcCBmaWxlcyAqL1xyXG4gIGhhbmRsZUlucHV0RmlsZShmaWxlOiBGaWxlLCBpbmRleCk6IHZvaWQge1xyXG4gICAgY29uc3QgdHlwZSA9IGdldEZpbGVUeXBlKGZpbGUudHlwZSk7XHJcbiAgICBpZiAodHlwZSA9PT0gJ2ltYWdlJyAmJiB0aGlzLmVuYWJsZUNyb3BwZXIpIHtcclxuICAgICAgdGhpcy5maWxlc0ZvckNyb3BwZXIucHVzaChmaWxlKTtcclxuICAgICAgaWYgKCEodGhpcy5jdXJyZW50Q3JvcHBlckZpbGUpKSB7XHJcbiAgICAgICAgdGhpcy5vcGVuQ3JvcHBlcihmaWxlKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLyoqIFNpemUgaXMgbm90IGluaXRpYWxseSBjaGVja2VkIG9uIGhhbmRsZUlucHV0RmlsZXMgYmVjYXVzZSBvZiBjcm9wcGVyIHNpemUgY2hhbmdlICovXHJcbiAgICAgICBpZiAodGhpcy5pc1ZhbGlkU2l6ZShmaWxlLCBmaWxlLnNpemUpKSB7XHJcbiAgICAgICAgdGhpcy5wdXNoRmlsZShmaWxlKTtcclxuICAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgLyoqIFZhbGlkYXRlcyBpZiB1cGxvYWQgdHlwZSBpcyBzaW5nbGUgc28gYW5vdGhlciBmaWxlIGNhbm5vdCBiZSBhZGRlZCAqL1xyXG4gIGlzVmFsaWRVcGxvYWRUeXBlKGZpbGUpOiBib29sZWFuIHtcclxuICAgIGlmICh0aGlzLnVwbG9hZFR5cGUgPT09ICdzaW5nbGUnICYmIHRoaXMuZmlsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLnZhbGlkYXRpb25FcnJvci5uZXh0KHtmaWxlOiBmaWxlLCBlcnJvcjogRmlsZVZhbGlkYXRpb25UeXBlcy51cGxvYWRUeXBlfSk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKiogVmFsaWRhdGVzIG1heCBmaWxlIGNvdW50ICovXHJcbiAgaXNWYWxpZE1heEZpbGVDb3VudChmaWxlczogRmlsZVtdKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIXRoaXMuZmlsZU1heENvdW50IHx8IHRoaXMuZmlsZU1heENvdW50ID49IHRoaXMuZmlsZXMubGVuZ3RoICsgZmlsZXMubGVuZ3RoICkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICB9IGVsc2Uge1xyXG4gICAgICAgdGhpcy52YWxpZGF0aW9uRXJyb3IubmV4dCh7ZmlsZTogbnVsbCwgZXJyb3I6IEZpbGVWYWxpZGF0aW9uVHlwZXMuZmlsZU1heENvdW50fSk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICB9XHJcbiAgfVxyXG4gIC8qKiBPbiBmaWxlIGRyb3BwZWQgKi9cclxuICBkcm9wcGVkKGV2ZW50OiBVcGxvYWRFdmVudCkge1xyXG4gICAgY29uc3QgZmlsZXMgPSBldmVudC5maWxlcztcclxuICAgIGNvbnN0IGZpbGVzRm9yVXBsb2FkOiBGaWxlW10gPSBbXTtcclxuICAgIGZvciAoY29uc3QgZHJvcHBlZEZpbGUgb2YgZXZlbnQuZmlsZXMpIHtcclxuICAgICAgLy8gSXMgaXQgYSBmaWxlP1xyXG4gICAgICBpZiAoZHJvcHBlZEZpbGUuZmlsZUVudHJ5LmlzRmlsZSkge1xyXG4gICAgICAgIGNvbnN0IGZpbGVFbnRyeSA9IGRyb3BwZWRGaWxlLmZpbGVFbnRyeSBhcyBGaWxlU3lzdGVtRmlsZUVudHJ5O1xyXG4gICAgICAgIGZpbGVFbnRyeS5maWxlKChmaWxlOiBGaWxlKSA9PiB7XHJcbiAgICAgICAgICBmaWxlc0ZvclVwbG9hZC5wdXNoKGZpbGUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEl0IHdhcyBhIGRpcmVjdG9yeSAoZW1wdHkgZGlyZWN0b3JpZXMgYXJlIGFkZGVkLCBvdGhlcndpc2Ugb25seSBmaWxlcylcclxuICAgICAgICBjb25zdCBmaWxlRW50cnkgPSBkcm9wcGVkRmlsZS5maWxlRW50cnkgYXMgRmlsZVN5c3RlbURpcmVjdG9yeUVudHJ5O1xyXG4gICAgICAgLy8gY29uc29sZS5sb2coZHJvcHBlZEZpbGUucmVsYXRpdmVQYXRoLCBmaWxlRW50cnkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaGFuZGxlRmlsZXMoZmlsZXNGb3JVcGxvYWQpLnN1YnNjcmliZSgpKTtcclxuICB9XHJcbiAgLyoqIEFkZCBmaWxlIHRvIGZpbGUgbGlzdCBhZnRlciBzdWNjZXNmdWxsIHZhbGlkYXRpb24gKi9cclxuICBwdXNoRmlsZSggZmlsZTogRmlsZSwgZmlsZU5hbWUgPSBmaWxlLm5hbWUpOiB2b2lkIHtcclxuICAgICAgdGhpcy5maWxlcy5wdXNoKHsgZmlsZTogZmlsZSwgZmlsZU5hbWU6IGZpbGVOYW1lfSk7XHJcbiAgICAgIHRoaXMuZmlsZUFkZGVkLm5leHQoeyBmaWxlOiBmaWxlLCBmaWxlTmFtZTogZmlsZU5hbWV9KTtcclxuICB9XHJcbiAgLyoqIE9wZW5zIGNyb3BwZXIgZm9yIGltYWdlIGNyb3AgKi9cclxuICBvcGVuQ3JvcHBlcihmaWxlOiBGaWxlKTogdm9pZCB7XHJcbiAgICBpZiAoKDxhbnk+d2luZG93KS5VUExPQURFUl9URVNUX01PREUgfHwgdHlwZW9mIENyb3BwZXIgIT09ICd1bmRlZmluZWQnICkge1xyXG4gICAgICB0aGlzLnNhZmVDcm9wSW1nVXJsID0gdGhpcy5maWxlU2VydmljZS5jcmVhdGVTYWZlVXJsKGZpbGUpO1xyXG4gICAgICB0aGlzLmN1cnJlbnRDcm9wcGVyRmlsZSA9IGZpbGU7XHJcbiAgICB9IGVsc2UgIHtcclxuICAgICAgY29uc29sZS53YXJuKCdwbGVhc2UgaW1wb3J0IGNyb3BwZXJqcyBzY3JpcHQgYW5kIHN0eWxlcyB0byB1c2UgY3JvcHBlciBmZWF0dXJlIG9yIGRpc2FibGUgaXQgYnkgc2V0dGluZyBbZW5hYmxlQ3JvcHBlcl09XCJmYWxzZVwiJyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICB9XHJcbiAgZ2V0U2FmZVVybChmaWxlOiBGaWxlKTogU2FmZVJlc291cmNlVXJsIHtcclxuICAgIHJldHVybiB0aGlzLmZpbGVTZXJ2aWNlLmNyZWF0ZVNhZmVVcmwoZmlsZSk7XHJcbiAgfVxyXG4gIC8qKiBPbiBpbWcgbG9hZCBldmVudCAqL1xyXG4gIGNyb3BwZXJJbWdMb2FkZWQoZSk6IHZvaWQge1xyXG4gICAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3JvcHBlci1pbWcnKTtcclxuICAgIHRoaXMuY3JvcHBlciA9IG5ldyBDcm9wcGVyKGltYWdlLCB0aGlzLmNyb3BwZXJPcHRpb25zKTtcclxuICB9XHJcbiAgLyoqIENsb3NlIG9yIGNhbmNlbCBjcm9wcGVyICovXHJcbiAgY2xvc2VDcm9wcGVyKGZpbGVQcmV2aWV3OiBGaWxlUHJldmlld01vZGVsKTogdm9pZCB7XHJcbiAgICB0aGlzLmN1cnJlbnRDcm9wcGVyRmlsZSA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuY3JvcHBlciA9IHVuZGVmaW5lZDtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5jcm9wQ2xvc2VkJC5uZXh0KGZpbGVQcmV2aWV3KSwgMjAwKTtcclxuICB9XHJcbi8qKiBSZW1vdmVzIGZpbGVzIGZyb20gZmlsZXMgbGlzdCAqL1xyXG4gIHJlbW92ZUZpbGVGcm9tTGlzdChmaWxlOiBGaWxlUHJldmlld01vZGVsKTogdm9pZCB7XHJcbiAgICB0aGlzLmZpbGVzID0gdGhpcy5maWxlcy5maWx0ZXIoZiA9PiAgZiAhPT0gZmlsZSk7XHJcbiAgfVxyXG4gIC8qKiBFbWl0cyBldmVudCB3aGVuIGZpbGUgdXBsb2FkIGFwaSByZXR1cm5zIHN1Y2Nlc3MgICovXHJcbiAgb25VcGxvYWRTdWNjZXNzKGZpbGVJdGVtOiBGaWxlUHJldmlld01vZGVsKTogdm9pZCB7XHJcbiAgICB0aGlzLnVwbG9hZFN1Y2Nlc3MubmV4dChmaWxlSXRlbSk7XHJcbiAgfVxyXG4gLyoqIFZhbGlkYXRlcyBmaWxlIGV4dGVuc2lvbiAqL1xyXG4gaXNWYWxpZEV4dGVuc2lvbihmaWxlOiBGaWxlLCBmaWxlTmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgaWYgKCF0aGlzLmZpbGVFeHRlbnNpb25zKSB7cmV0dXJuIHRydWU7IH1cclxuICBjb25zdCBleHRlbnNpb24gPSBmaWxlTmFtZS5zcGxpdCgnLicpLnBvcCgpO1xyXG4gIGNvbnN0IGZpbGVFeHRlbnNpb25zID0gdGhpcy5maWxlRXh0ZW5zaW9ucy5tYXAoZXh0ID0+IGV4dC50b0xvd2VyQ2FzZSgpKTtcclxuICBpZiAoZmlsZUV4dGVuc2lvbnMuaW5kZXhPZihleHRlbnNpb24udG9Mb3dlckNhc2UoKSkgPT09IC0xKSB7XHJcbiAgICB0aGlzLnZhbGlkYXRpb25FcnJvci5uZXh0KHtmaWxlOiBmaWxlLCBlcnJvcjogRmlsZVZhbGlkYXRpb25UeXBlcy5leHRlbnNpb25zfSk7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gICAgIHJldHVybiB0cnVlO1xyXG59XHJcbiAgIC8qKiBWYWxpZGF0ZXMgc2VsZWN0ZWQgZmlsZSBzaXplIGFuZCB0b3RhbCBmaWxlIHNpemUgKi9cclxuICBpc1ZhbGlkU2l6ZShmaWxlOiBGaWxlLCBzaXplOiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgIC8qKiBWYWxpZGF0aW5nIHNlbGVjdGVkIGZpbGUgc2l6ZSAqL1xyXG4gICAgY29uc3QgcmVzOiBudW1iZXIgPSB0aGlzLmJpdHNUb01iKHNpemUudG9TdHJpbmcoKSk7XHJcbiAgICBsZXQgaXNWYWxpZEZpbGVTaXplOiBib29sZWFuO1xyXG4gICAgbGV0IGlzVmFsaWRUb3RhbEZpbGVTaXplOiBib29sZWFuO1xyXG4gICAgaWYgICghdGhpcy5maWxlTWF4U2l6ZSB8fCAoIHRoaXMuZmlsZU1heFNpemUgJiYgcmVzIDwgdGhpcy5maWxlTWF4U2l6ZSkpIHtcclxuICAgICAgaXNWYWxpZEZpbGVTaXplID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudmFsaWRhdGlvbkVycm9yLm5leHQoe2ZpbGU6IGZpbGUsIGVycm9yOiBGaWxlVmFsaWRhdGlvblR5cGVzLmZpbGVNYXhTaXplfSk7XHJcbiAgICB9XHJcbiAgICAvKiogVmFsaWRhdGluZyBUb3RhbCBGaWxlcyBTaXplICovXHJcbiAgICBjb25zdCB0b3RhbEJpdHMgPSB0aGlzLmZpbGVzLm1hcChmID0+IGYuZmlsZS5zaXplKS5yZWR1Y2UoKGFjYywgY3VycikgPT4gYWNjICsgY3VyciwgMCk7XHJcbiAgICAgIGlmICghdGhpcy50b3RhbE1heFNpemUgfHwgKHRoaXMudG90YWxNYXhTaXplICYmIHRoaXMuYml0c1RvTWIodG90YWxCaXRzICsgZmlsZS5zaXplKSA8IHRoaXMudG90YWxNYXhTaXplKSkge1xyXG4gICAgICAgICBpc1ZhbGlkVG90YWxGaWxlU2l6ZSA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy52YWxpZGF0aW9uRXJyb3IubmV4dCh7ZmlsZTogZmlsZSwgZXJyb3I6IEZpbGVWYWxpZGF0aW9uVHlwZXMudG90YWxNYXhTaXplfSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuICEhaXNWYWxpZEZpbGVTaXplICYmIGlzVmFsaWRUb3RhbEZpbGVTaXplO1xyXG4gIH1cclxuICBiaXRzVG9NYihzaXplKTogbnVtYmVyIHtcclxuICAgIHJldHVybiBwYXJzZUZsb2F0KHNpemUpIC8gMTA0ODU3NjtcclxuICB9XHJcbiAgLyoqIHdoZW4gY3JvcCBidXR0b24gc3VibWl0dGVkICovXHJcbiAgb25Dcm9wU3VibWl0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5jcm9wcGVyLmdldENyb3BwZWRDYW52YXMoKS50b0Jsb2IodGhpcy5ibG9iRmFsbEJhY2suYmluZCh0aGlzKSwgJ2ltYWdlL2pwZWcnKTtcclxuICB9XHJcbiAgLyoqIEFmdGVyIGNyb3Agc3VibWl0ICovXHJcbiAgYmxvYkZhbGxCYWNrKGJsb2I6IEJsb2IpOiB2b2lkIHtcclxuICAgIGlmICghYmxvYikge3JldHVybjt9XHJcbiAgICBpZiAodGhpcy5pc1ZhbGlkU2l6ZSg8RmlsZT5ibG9iLCBibG9iLnNpemUpKSB7XHJcbiAgICAgIHRoaXMucHVzaEZpbGUoPEZpbGU+YmxvYiwgdGhpcy5jdXJyZW50Q3JvcHBlckZpbGUubmFtZSk7XHJcbiAgICB9XHJcbiAgIHRoaXMuY2xvc2VDcm9wcGVyKHtmaWxlOiBibG9iIGFzIEZpbGUsIGZpbGVOYW1lOiB0aGlzLmN1cnJlbnRDcm9wcGVyRmlsZS5uYW1lfSk7XHJcbiAgfVxyXG4gIHJlbW92ZUZpbGUoZmlsZUl0ZW06IEZpbGVQcmV2aWV3TW9kZWwpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmFkYXB0ZXIpIHtcclxuICAgICAgdGhpcy5hZGFwdGVyLnJlbW92ZUZpbGUoZmlsZUl0ZW0pXHJcbiAgICAgIC5zdWJzY3JpYmUocmVzID0+IHtcclxuICAgICAgICB0aGlzLm9uUmVtb3ZlU3VjY2VzcyhmaWxlSXRlbSk7XHJcbiAgICAgIH0pO1xyXG4gICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUud2Fybignbm8gYWRhcHRlciB3YXMgcHJvdmlkZWQnKTtcclxuICAgICB9XHJcbiAgIH1cclxuICAgIC8qKiBFbWl0cyBldmVudCB3aGVuIGZpbGUgcmVtb3ZlIGFwaSByZXR1cm5zIHN1Y2Nlc3MgICovXHJcbiAgb25SZW1vdmVTdWNjZXNzKGZpbGVJdGVtOiBGaWxlUHJldmlld01vZGVsKTogdm9pZCB7XHJcbiAgICB0aGlzLnJlbW92ZVN1Y2Nlc3MubmV4dChmaWxlSXRlbSk7XHJcbiAgICB0aGlzLnJlbW92ZUZpbGVGcm9tTGlzdChmaWxlSXRlbSk7XHJcbiAgfVxyXG5cclxuXHJcbn1cclxuIl19