import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter } from '@angular/core';
var XunkCalendarComponent = /** @class */ (function () {
    /** CalendarComponent */
    function XunkCalendarComponent() {
        /** Array with all the calendar data */
        this.calendar = [[]];
        /** Color for heat map */
        this.heatMapColor = '#00ff00';
        /** Color for primary */
        this.primaryColor = '#ff0000';
        /** Color for primary foreground */
        this.primaryForeground = 'white';
        /** Heatmap data */
        this.heatmap = {};
        /** Set this to false to hide month changing header */
        this.showHeader = true;
        /** Emits the new date on change */
        this.change = new EventEmitter();
        /** Emits the new month with date as 1 on change */
        this.monthChange = new EventEmitter();
        /** Constants */
        this.monthNames = [
            'January', 'February', 'March', 'April',
            'May', 'June', 'July', 'August',
            'September', 'October', 'November', 'December'
        ];
        this.dayNames = [
            'Sunday', 'Monday', 'Tuesday', 'Wednesday',
            'Thrusday', 'Friday', 'Saturday'
        ];
        /* Initialize */
        this.calendar = [];
        this.today = XunkCalendarComponent_1.getToday();
        this.openPage = tslib_1.__assign({}, this.today);
        this.selectedDate = tslib_1.__assign({}, this.today);
    }
    XunkCalendarComponent_1 = XunkCalendarComponent;
    /* Get RGB from CSS color */
    XunkCalendarComponent.parseColor = function (input) {
        var div = document.createElement('div');
        div.style.color = input;
        document.body.appendChild(div);
        var m = getComputedStyle(div).color.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);
        document.body.removeChild(div);
        if (m) {
            return { R: m[1], G: m[2], B: m[3] };
        }
        else {
            throw new Error('Color ' + input + ' could not be parsed.');
        }
    };
    /* Get today's date */
    XunkCalendarComponent.getToday = function () {
        var dateNow = new Date();
        return {
            date: dateNow.getDate(),
            month: dateNow.getMonth(),
            year: dateNow.getFullYear()
        };
    };
    /** Pad number with zeros */
    XunkCalendarComponent.zeropad = function (num, padlen, padchar) {
        if (padchar === void 0) { padchar = '0'; }
        var pad_char = typeof padchar !== 'undefined' ? padchar : '0';
        var pad = new Array(1 + padlen).join(pad_char);
        return (pad + num).slice(-pad.length);
    };
    XunkCalendarComponent.prototype.ngOnInit = function () {
        /* Parse colors*/
        this.RGB_HM = XunkCalendarComponent_1.parseColor(this.heatMapColor);
        this.RGB_Primary = XunkCalendarComponent_1.parseColor(this.primaryColor);
        this.RGB_Primary_FG = XunkCalendarComponent_1.parseColor(this.primaryForeground);
        /* Display initial */
        this.displayCalendar();
    };
    /**
     * Returns true if two dates are the same
     * with the date taken separately
     */
    XunkCalendarComponent.prototype.sameDate = function (date, a, b) {
        return date === b.date &&
            a.month === b.month &&
            a.year === b.year;
    };
    /** Returns true if fab! */
    XunkCalendarComponent.prototype.isFab = function (col) {
        /* Check if date is selected */
        if (this.sameDate(col, this.openPage, this.selectedDate)) {
            return 'primary';
        }
        /* No matches found */
        return '';
    };
    /** Returns 'primary' if col is today */
    XunkCalendarComponent.prototype.isToday = function (col) {
        if (this.sameDate(col, this.openPage, this.today)) {
            return 'primary';
        }
        return '';
    };
    /** Select a day in the open page */
    XunkCalendarComponent.prototype.selectDay = function (col) {
        this.selectedDate.date = col;
        this.selectedDate.month = this.openPage.month;
        this.selectedDate.year = this.openPage.year;
        this.change.emit(this.selectedDate);
    };
    /** Change the month +1 or -1 */
    XunkCalendarComponent.prototype.changeMonth = function (diff) {
        this.openPage.month += diff;
        /* See if the year switches */
        if (this.openPage.month >= 12) {
            this.openPage.month = 0;
            this.openPage.year++;
        }
        if (this.openPage.month < 0) {
            this.openPage.month = 11;
            this.openPage.year--;
        }
        /* Refresh */
        this.displayCalendar();
        /* Emit event */
        this.monthChange.emit(this.openPage);
    };
    /** Compute the calendar */
    XunkCalendarComponent.prototype.displayCalendar = function () {
        /* Generate a new object */
        var newCalendar = [[]];
        var month = this.openPage.month;
        var year = this.openPage.year;
        /* Days in next month, and day of week */
        var col = new Date(year, month, 0).getDay();
        var row = 0, counter = 1;
        var numOfDays = Number(this.getDaysOfMonth(month, year));
        /* Loop to build the calendar body */
        while (counter <= numOfDays) {
            /* When to start new line */
            if (col > 6) {
                col = 0;
                newCalendar[++row] = [];
            }
            /* Set the value and increment */
            newCalendar[row][col++] = counter++;
        }
        /* Set the calendar to the newly computed one */
        this.calendar = newCalendar;
    };
    /** Gets the DaysPerMonth array */
    XunkCalendarComponent.prototype.getDaysOfMonth = function (month, year) {
        /* Check leap years if February */
        if (month === 1 && this.leapYear(year)) {
            return 29;
        }
        /** Return the number of days */
        return [31, 28, 31, 30, 31, 30,
            31, 31, 30, 31, 30, 31][month];
    };
    /** Returns true if leap year */
    XunkCalendarComponent.prototype.leapYear = function (year) {
        return ((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0);
    };
    /** Gets the heat map color */
    XunkCalendarComponent.prototype.getHM = function (day) {
        /* If today */
        if (this.isFab(day)) {
            return "rgb(" + this.RGB_Primary.R + ", " + this.RGB_Primary.G + ", " + this.RGB_Primary.B + ")";
        }
        /* Return heatmap color */
        var zeropad = XunkCalendarComponent_1.zeropad;
        var ind = (zeropad(this.openPage.year, 4) + zeropad(this.openPage.month + 1, 2) + zeropad(day, 2));
        if (ind in this.heatmap) {
            return "rgba(" + this.RGB_HM.R + ", " + this.RGB_HM.G + ", " + this.RGB_HM.B + ", " + this.heatmap[ind] + ")";
        }
        else {
            return 'inherit';
        }
    };
    XunkCalendarComponent.prototype.getForeground = function (day) {
        /* If today */
        if (this.isFab(day)) {
            return "rgb(" + this.RGB_Primary_FG.R + ", " + this.RGB_Primary_FG.G + ", " + this.RGB_Primary_FG.B + ")";
        }
        if (this.isToday(day)) {
            return "rgb(" + this.RGB_Primary.R + ", " + this.RGB_Primary.G + ", " + this.RGB_Primary.B + ")";
        }
        return;
    };
    var XunkCalendarComponent_1;
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], XunkCalendarComponent.prototype, "today", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], XunkCalendarComponent.prototype, "openPage", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], XunkCalendarComponent.prototype, "selectedDate", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Array)
    ], XunkCalendarComponent.prototype, "calendar", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], XunkCalendarComponent.prototype, "heatMapColor", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], XunkCalendarComponent.prototype, "primaryColor", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], XunkCalendarComponent.prototype, "primaryForeground", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], XunkCalendarComponent.prototype, "heatmap", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], XunkCalendarComponent.prototype, "showHeader", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], XunkCalendarComponent.prototype, "change", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], XunkCalendarComponent.prototype, "monthChange", void 0);
    XunkCalendarComponent = XunkCalendarComponent_1 = tslib_1.__decorate([
        Component({
            selector: 'xunk-calendar',
            template: "<table class=\"xunk-calendar\">\n\n    <!-- Header for changing month -->\n    <tr *ngIf=\"showHeader\">\n        <!-- Previous month button -->\n        <th>\n            <button mat-icon-button (click)=\"changeMonth(-1)\">\n                <mat-icon>keyboard_arrow_left</mat-icon>\n            </button>\n        </th>\n\n        <!-- Month label -->\n        <th colspan=5>{{monthNames[openPage.month]}} {{openPage.year}}</th>\n\n        <!-- Next month button -->\n        <th>\n            <button mat-icon-button (click)=\"changeMonth(1)\">\n                <mat-icon>keyboard_arrow_right</mat-icon>\n            </button>\n        </th>\n    </tr>\n\n    <!-- Weekday headers -->\n    <tr class=\"weekday\">\n        <th>M</th>\n        <th>T</th>\n        <th>W</th>\n        <th>T</th>\n        <th>F</th>\n        <th>S</th>\n        <th>S</th>\n    </tr>\n\n    <!-- The real calendar -->\n    <tr *ngFor=\"let row of calendar\">\n        <td class=\"xunk-calendar-cell\" *ngFor=\"let col of row\">\n            <button mat-icon-button\n                    *ngIf=\"col\" class=\"xunk-calendar-day\"\n                    [style.backgroundColor]=\"getHM(col)\"\n                    [style.color]=\"getForeground(col)\"\n                    (click)=\"selectDay(col)\">\n                <span [style.fontWeight]=\"isToday(col) ? 'bold' : null\">{{col}}</span>\n            </button>\n        </td>\n    </tr>\n</table>\n",
            styles: [".xunk-calendar{width:100%}.xunk-calendar-cell{text-align:center;padding:.5vw 0}.weekday{color:#cacaca}.xunk-calendar-day{-webkit-transition:background-color .1s linear,color .1s linear;transition:background-color .1s linear,color .1s linear}@media (min-width:1000px){button{font-size:1.05em}}@media (min-width:1200px){button{font-size:1.08em}}"]
        }),
        tslib_1.__metadata("design:paramtypes", [])
    ], XunkCalendarComponent);
    return XunkCalendarComponent;
}());
export { XunkCalendarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieHVuay1jYWxlbmRhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly94dW5rLWNhbGVuZGFyLyIsInNvdXJjZXMiOlsic3JjL3h1bmstY2FsZW5kYXIveHVuay1jYWxlbmRhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFhN0U7SUFvRkUsd0JBQXdCO0lBQ3hCO1FBMUVBLHVDQUF1QztRQUN2QixhQUFRLEdBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUV6Qyx5QkFBeUI7UUFDVCxpQkFBWSxHQUFHLFNBQVMsQ0FBQztRQUV6Qyx3QkFBd0I7UUFDUixpQkFBWSxHQUFHLFNBQVMsQ0FBQztRQUV6QyxtQ0FBbUM7UUFDbkIsc0JBQWlCLEdBQUcsT0FBTyxDQUFDO1FBRTVDLG1CQUFtQjtRQUNILFlBQU8sR0FBRyxFQUFFLENBQUM7UUFFN0Isc0RBQXNEO1FBQ3RDLGVBQVUsR0FBRyxJQUFJLENBQUM7UUFFbEMsbUNBQW1DO1FBQ3pCLFdBQU0sR0FBMkIsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUU5RCxtREFBbUQ7UUFDekMsZ0JBQVcsR0FBMkIsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQU1uRSxnQkFBZ0I7UUFDQSxlQUFVLEdBQ3hCO1lBQ0UsU0FBUyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsT0FBTztZQUN2QyxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxRQUFRO1lBQy9CLFdBQVcsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFVBQVU7U0FDL0MsQ0FBQztRQUNZLGFBQVEsR0FDdEI7WUFDRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxXQUFXO1lBQzFDLFVBQVUsRUFBRSxRQUFRLEVBQUUsVUFBVTtTQUNqQyxDQUFDO1FBb0NGLGdCQUFnQjtRQUNoQixJQUFJLENBQUMsUUFB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QVIsS0FBSyxFQUFFOzsrREFBK0I7SUFHOUI7UUFBUixLQUFLLEVBQUU7OzJEQUFpQztJQUdoQztRQUFSLEtBQUssRUFBRTs7K0RBQWlDO0lBR2hDO1FBQVIsS0FBSyxFQUFFOzsrREFBaUM7SUFHaEM7UUFBUixLQUFLLEVBQUU7O29FQUFvQztJQUduQztRQUFSLEtBQUssRUFBRTs7MERBQXFCO0lBR3BCO1FBQVIsS0FBSyxFQUFFOzs2REFBMEI7SUFHeEI7UUFBVCxNQUFNLEVBQUU7MENBQVMsWUFBWTt5REFBZ0M7SUFHcEQ7UUFBVCxNQUFNLEVBQUU7MENBQWMsWUFBWTs4REFBZ0M7SUFqQ3hELHFCQUFxQjtRQUxuQyxTQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUsZUFBZTtZQUN6QiwrNUNBQTZDOztTQUU5QyxDQUFDOztPQUNXLHFCQUFxQixDQTRPbkM7SUFBRCw0QkFBQztDQUFBLEFBNU9DLElBNE9EO1NBNU9jLHFCQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuZXhwb3J0IGludGVyZmFjZSBYdW5rRGF0ZSB7XG4gIGRhdGU6IG51bWJlcjtcbiAgbW9udGg6IGFueTtcbiAgeWVhcjogYW55O1xufVxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3h1bmstY2FsZW5kYXInLFxuICAgIHRlbXBsYXRlVXJsOiAnLi94dW5rLWNhbGVuZGFyLmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi94dW5rLWNhbGVuZGFyLmNvbXBvbmVudC5jc3MnXVxuICB9KVxuICBleHBvcnQgY2xhc3MgWHVua0NhbGVuZGFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcblxuICAgIC8qKiBUb2RheSAqL1xuICAgIEBJbnB1dCgpIHB1YmxpYyB0b2RheTogWHVua0RhdGU7XG5cbiAgICAvKiogVGhlIHBhZ2Ugb3BlbiB3aXRoIFt4eCwgbW9udGgsIHllYXJdICovXG4gICAgQElucHV0KCkgcHVibGljIG9wZW5QYWdlOiBYdW5rRGF0ZTtcblxuICAgIC8qKiBDdXJyZW50bHkgc2VsZWN0ZWQgZGF0ZSAqL1xuICAgIEBJbnB1dCgpIHB1YmxpYyBzZWxlY3RlZERhdGU6IFh1bmtEYXRlO1xuXG4gICAgLyoqIEFycmF5IHdpdGggYWxsIHRoZSBjYWxlbmRhciBkYXRhICovXG4gICAgQElucHV0KCkgcHVibGljIGNhbGVuZGFyOiBhbnlbXVtdID0gW1tdXTtcblxuICAgIC8qKiBDb2xvciBmb3IgaGVhdCBtYXAgKi9cbiAgICBASW5wdXQoKSBwdWJsaWMgaGVhdE1hcENvbG9yID0gJyMwMGZmMDAnO1xuXG4gICAgLyoqIENvbG9yIGZvciBwcmltYXJ5ICovXG4gICAgQElucHV0KCkgcHVibGljIHByaW1hcnlDb2xvciA9ICcjZmYwMDAwJztcblxuICAgIC8qKiBDb2xvciBmb3IgcHJpbWFyeSBmb3JlZ3JvdW5kICovXG4gICAgQElucHV0KCkgcHVibGljIHByaW1hcnlGb3JlZ3JvdW5kID0gJ3doaXRlJztcblxuICAgIC8qKiBIZWF0bWFwIGRhdGEgKi9cbiAgICBASW5wdXQoKSBwdWJsaWMgaGVhdG1hcCA9IHt9O1xuXG4gICAgLyoqIFNldCB0aGlzIHRvIGZhbHNlIHRvIGhpZGUgbW9udGggY2hhbmdpbmcgaGVhZGVyICovXG4gICAgQElucHV0KCkgcHVibGljIHNob3dIZWFkZXIgPSB0cnVlO1xuXG4gICAgLyoqIEVtaXRzIHRoZSBuZXcgZGF0ZSBvbiBjaGFuZ2UgKi9cbiAgICBAT3V0cHV0KCkgY2hhbmdlOiBFdmVudEVtaXR0ZXI8WHVua0RhdGU+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgLyoqIEVtaXRzIHRoZSBuZXcgbW9udGggd2l0aCBkYXRlIGFzIDEgb24gY2hhbmdlICovXG4gICAgQE91dHB1dCgpIG1vbnRoQ2hhbmdlOiBFdmVudEVtaXR0ZXI8WHVua0RhdGU+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgcHJpdmF0ZSBSR0JfSE06IGFueTtcbiAgICBwcml2YXRlIFJHQl9QcmltYXJ5OiBhbnk7XG4gICAgcHJpdmF0ZSBSR0JfUHJpbWFyeV9GRzogYW55O1xuXG4gICAgLyoqIENvbnN0YW50cyAqL1xuICAgIHB1YmxpYyByZWFkb25seSBtb250aE5hbWVzID1cbiAgICAgIFtcbiAgICAgICAgJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLFxuICAgICAgICAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLFxuICAgICAgICAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXG4gICAgICBdO1xuICAgIHB1YmxpYyByZWFkb25seSBkYXlOYW1lcyA9XG4gICAgICBbXG4gICAgICAgICdTdW5kYXknLCAnTW9uZGF5JywgJ1R1ZXNkYXknLCAnV2VkbmVzZGF5JyxcbiAgICAgICAgJ1RocnVzZGF5JywgJ0ZyaWRheScsICdTYXR1cmRheSdcbiAgICAgIF07XG5cbiAgICAvKiBHZXQgUkdCIGZyb20gQ1NTIGNvbG9yICovXG4gICAgcHVibGljIHN0YXRpYyBwYXJzZUNvbG9yKGlucHV0KSB7XG4gICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGRpdi5zdHlsZS5jb2xvciA9IGlucHV0O1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkaXYpO1xuICAgICAgY29uc3QgbSA9IGdldENvbXB1dGVkU3R5bGUoZGl2KS5jb2xvci5tYXRjaCgvXnJnYlxccypcXChcXHMqKFxcZCspXFxzKixcXHMqKFxcZCspXFxzKixcXHMqKFxcZCspXFxzKlxcKSQvaSk7XG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGRpdik7XG5cbiAgICAgIGlmIChtKSB7XG4gICAgICAgIHJldHVybiB7UjogbVsxXSwgRzogbVsyXSwgQjogbVszXX07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbG9yICcgKyBpbnB1dCArICcgY291bGQgbm90IGJlIHBhcnNlZC4nKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKiBHZXQgdG9kYXkncyBkYXRlICovXG4gICAgcHVibGljIHN0YXRpYyBnZXRUb2RheSgpOiBYdW5rRGF0ZSB7XG4gICAgICBjb25zdCBkYXRlTm93ID0gbmV3IERhdGUoKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGU6IGRhdGVOb3cuZ2V0RGF0ZSgpLFxuICAgICAgICBtb250aDogZGF0ZU5vdy5nZXRNb250aCgpLFxuICAgICAgICB5ZWFyOiBkYXRlTm93LmdldEZ1bGxZZWFyKClcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqIFBhZCBudW1iZXIgd2l0aCB6ZXJvcyAqL1xuICAgIHB1YmxpYyBzdGF0aWMgemVyb3BhZChudW0sIHBhZGxlbiwgcGFkY2hhciA9ICcwJyk6IHN0cmluZyB7XG4gICAgICBjb25zdCBwYWRfY2hhciA9IHR5cGVvZiBwYWRjaGFyICE9PSAndW5kZWZpbmVkJyA/IHBhZGNoYXIgOiAnMCc7XG4gICAgICBjb25zdCBwYWQgPSBuZXcgQXJyYXkoMSArIHBhZGxlbikuam9pbihwYWRfY2hhcik7XG4gICAgICByZXR1cm4gKHBhZCArIG51bSkuc2xpY2UoLXBhZC5sZW5ndGgpO1xuICAgIH1cblxuICAgIC8qKiBDYWxlbmRhckNvbXBvbmVudCAqL1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgLyogSW5pdGlhbGl6ZSAqL1xuICAgICAgdGhpcy5jYWxlbmRhciA9IFtdO1xuXG4gICAgICB0aGlzLnRvZGF5ID0gWHVua0NhbGVuZGFyQ29tcG9uZW50LmdldFRvZGF5KCk7XG4gICAgICB0aGlzLm9wZW5QYWdlID0gey4uLnRoaXMudG9kYXl9O1xuICAgICAgdGhpcy5zZWxlY3RlZERhdGUgPSB7Li4udGhpcy50b2RheX07XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAvKiBQYXJzZSBjb2xvcnMqL1xuICAgICAgdGhpcy5SR0JfSE0gPSBYdW5rQ2FsZW5kYXJDb21wb25lbnQucGFyc2VDb2xvcih0aGlzLmhlYXRNYXBDb2xvcik7XG4gICAgICB0aGlzLlJHQl9QcmltYXJ5ID0gWHVua0NhbGVuZGFyQ29tcG9uZW50LnBhcnNlQ29sb3IodGhpcy5wcmltYXJ5Q29sb3IpO1xuICAgICAgdGhpcy5SR0JfUHJpbWFyeV9GRyA9IFh1bmtDYWxlbmRhckNvbXBvbmVudC5wYXJzZUNvbG9yKHRoaXMucHJpbWFyeUZvcmVncm91bmQpO1xuXG4gICAgICAvKiBEaXNwbGF5IGluaXRpYWwgKi9cbiAgICAgIHRoaXMuZGlzcGxheUNhbGVuZGFyKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHR3byBkYXRlcyBhcmUgdGhlIHNhbWVcbiAgICAgKiB3aXRoIHRoZSBkYXRlIHRha2VuIHNlcGFyYXRlbHlcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgc2FtZURhdGUoZGF0ZTogbnVtYmVyLCBhOiBYdW5rRGF0ZSwgYjogWHVua0RhdGUpOiBib29sZWFuIHtcbiAgICAgIHJldHVybiBkYXRlID09PSBiLmRhdGUgJiZcbiAgICAgICAgICAgICBhLm1vbnRoID09PSBiLm1vbnRoICYmXG4gICAgICAgICAgICAgYS55ZWFyID09PSBiLnllYXI7XG4gICAgfVxuXG4gICAgLyoqIFJldHVybnMgdHJ1ZSBpZiBmYWIhICovXG4gICAgcHJvdGVjdGVkIGlzRmFiKGNvbDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgIC8qIENoZWNrIGlmIGRhdGUgaXMgc2VsZWN0ZWQgKi9cbiAgICAgIGlmICh0aGlzLnNhbWVEYXRlKGNvbCwgdGhpcy5vcGVuUGFnZSwgdGhpcy5zZWxlY3RlZERhdGUpKSB7XG4gICAgICAgIHJldHVybiAncHJpbWFyeSc7XG4gICAgICB9XG5cbiAgICAgIC8qIE5vIG1hdGNoZXMgZm91bmQgKi9cbiAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICAvKiogUmV0dXJucyAncHJpbWFyeScgaWYgY29sIGlzIHRvZGF5ICovXG4gICAgcHVibGljIGlzVG9kYXkoY29sOiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgaWYgKHRoaXMuc2FtZURhdGUoY29sLCB0aGlzLm9wZW5QYWdlLCB0aGlzLnRvZGF5KSkge1xuICAgICAgICByZXR1cm4gJ3ByaW1hcnknO1xuICAgICAgfVxuICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIC8qKiBTZWxlY3QgYSBkYXkgaW4gdGhlIG9wZW4gcGFnZSAqL1xuICAgIHB1YmxpYyBzZWxlY3REYXkoY29sOiBudW1iZXIpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWREYXRlLmRhdGUgPSBjb2w7XG4gICAgICB0aGlzLnNlbGVjdGVkRGF0ZS5tb250aCA9IHRoaXMub3BlblBhZ2UubW9udGg7XG4gICAgICB0aGlzLnNlbGVjdGVkRGF0ZS55ZWFyID0gdGhpcy5vcGVuUGFnZS55ZWFyO1xuICAgICAgdGhpcy5jaGFuZ2UuZW1pdCh0aGlzLnNlbGVjdGVkRGF0ZSk7XG4gICAgfVxuXG4gICAgLyoqIENoYW5nZSB0aGUgbW9udGggKzEgb3IgLTEgKi9cbiAgICBwdWJsaWMgY2hhbmdlTW9udGgoZGlmZjogbnVtYmVyKSB7XG4gICAgICB0aGlzLm9wZW5QYWdlLm1vbnRoICs9IGRpZmY7XG5cbiAgICAgIC8qIFNlZSBpZiB0aGUgeWVhciBzd2l0Y2hlcyAqL1xuICAgICAgaWYgKHRoaXMub3BlblBhZ2UubW9udGggPj0gMTIgKSB7XG4gICAgICAgIHRoaXMub3BlblBhZ2UubW9udGggPSAwO1xuICAgICAgICB0aGlzLm9wZW5QYWdlLnllYXIrKztcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3BlblBhZ2UubW9udGggPCAwICkge1xuICAgICAgICB0aGlzLm9wZW5QYWdlLm1vbnRoID0gMTE7XG4gICAgICAgIHRoaXMub3BlblBhZ2UueWVhci0tO1xuICAgICAgfVxuXG4gICAgICAvKiBSZWZyZXNoICovXG4gICAgICB0aGlzLmRpc3BsYXlDYWxlbmRhcigpO1xuXG4gICAgICAvKiBFbWl0IGV2ZW50ICovXG4gICAgICB0aGlzLm1vbnRoQ2hhbmdlLmVtaXQodGhpcy5vcGVuUGFnZSk7XG4gICAgfVxuXG4gICAgLyoqIENvbXB1dGUgdGhlIGNhbGVuZGFyICovXG4gICAgcHVibGljIGRpc3BsYXlDYWxlbmRhcigpIHtcbiAgICAgIC8qIEdlbmVyYXRlIGEgbmV3IG9iamVjdCAqL1xuICAgICAgY29uc3QgbmV3Q2FsZW5kYXIgPSBbW11dO1xuXG4gICAgICBjb25zdCBtb250aCA9IHRoaXMub3BlblBhZ2UubW9udGg7XG4gICAgICBjb25zdCB5ZWFyID0gdGhpcy5vcGVuUGFnZS55ZWFyO1xuXG4gICAgICAvKiBEYXlzIGluIG5leHQgbW9udGgsIGFuZCBkYXkgb2Ygd2VlayAqL1xuICAgICAgbGV0IGNvbCA9IG5ldyBEYXRlKHllYXIsIG1vbnRoLCAwKS5nZXREYXkoKTtcbiAgICAgIGxldCByb3cgPSAwLCBjb3VudGVyID0gMTtcbiAgICAgIGNvbnN0IG51bU9mRGF5cyA9IE51bWJlcih0aGlzLmdldERheXNPZk1vbnRoKG1vbnRoLCB5ZWFyKSk7XG5cbiAgICAgIC8qIExvb3AgdG8gYnVpbGQgdGhlIGNhbGVuZGFyIGJvZHkgKi9cbiAgICAgIHdoaWxlIChjb3VudGVyIDw9IG51bU9mRGF5cykge1xuICAgICAgICAgLyogV2hlbiB0byBzdGFydCBuZXcgbGluZSAqL1xuICAgICAgICAgaWYgKGNvbCA+IDYpIHtcbiAgICAgICAgICAgICBjb2wgPSAwO1xuICAgICAgICAgICAgIG5ld0NhbGVuZGFyWysrcm93XSA9IFtdO1xuICAgICAgICAgfVxuXG4gICAgICAgICAvKiBTZXQgdGhlIHZhbHVlIGFuZCBpbmNyZW1lbnQgKi9cbiAgICAgICAgIG5ld0NhbGVuZGFyW3Jvd11bY29sKytdID0gY291bnRlcisrO1xuICAgICAgfVxuXG4gICAgICAvKiBTZXQgdGhlIGNhbGVuZGFyIHRvIHRoZSBuZXdseSBjb21wdXRlZCBvbmUgKi9cbiAgICAgIHRoaXMuY2FsZW5kYXIgPSBuZXdDYWxlbmRhcjtcbiAgICB9XG5cbiAgICAvKiogR2V0cyB0aGUgRGF5c1Blck1vbnRoIGFycmF5ICovXG4gICAgcHJvdGVjdGVkIGdldERheXNPZk1vbnRoKG1vbnRoOiBudW1iZXIsIHllYXI6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAvKiBDaGVjayBsZWFwIHllYXJzIGlmIEZlYnJ1YXJ5ICovXG4gICAgICBpZiAobW9udGggPT09IDEgJiYgdGhpcy5sZWFwWWVhcih5ZWFyKSkge1xuICAgICAgICByZXR1cm4gMjk7XG4gICAgICB9XG5cbiAgICAgIC8qKiBSZXR1cm4gdGhlIG51bWJlciBvZiBkYXlzICovXG4gICAgICByZXR1cm4gWzMxLCAyOCwgMzEsIDMwLCAzMSwgMzAsXG4gICAgICAgIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzFdW21vbnRoXTtcbiAgICB9XG5cbiAgICAvKiogUmV0dXJucyB0cnVlIGlmIGxlYXAgeWVhciAqL1xuICAgIHByb3RlY3RlZCBsZWFwWWVhcih5ZWFyOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICAgIHJldHVybiAoKHllYXIgJSA0ID09PSAwKSAmJiAoeWVhciAlIDEwMCAhPT0gMCkpIHx8ICh5ZWFyICUgNDAwID09PSAwKTtcbiAgICB9XG5cbiAgICAvKiogR2V0cyB0aGUgaGVhdCBtYXAgY29sb3IgKi9cbiAgICBwdWJsaWMgZ2V0SE0oZGF5OiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgLyogSWYgdG9kYXkgKi9cbiAgICAgIGlmICh0aGlzLmlzRmFiKGRheSkpIHtcbiAgICAgICAgcmV0dXJuIGByZ2IoJHt0aGlzLlJHQl9QcmltYXJ5LlJ9LCAke3RoaXMuUkdCX1ByaW1hcnkuR30sICR7dGhpcy5SR0JfUHJpbWFyeS5CfSlgO1xuICAgICAgfVxuXG4gICAgICAvKiBSZXR1cm4gaGVhdG1hcCBjb2xvciAqL1xuICAgICAgY29uc3QgemVyb3BhZCA9IFh1bmtDYWxlbmRhckNvbXBvbmVudC56ZXJvcGFkO1xuICAgICAgY29uc3QgaW5kID0gKHplcm9wYWQodGhpcy5vcGVuUGFnZS55ZWFyLCA0KSArIHplcm9wYWQodGhpcy5vcGVuUGFnZS5tb250aCArIDEsIDIpICsgemVyb3BhZChkYXksIDIpKTtcbiAgICAgIGlmIChpbmQgaW4gdGhpcy5oZWF0bWFwKSB7XG4gICAgICAgIHJldHVybiBgcmdiYSgke3RoaXMuUkdCX0hNLlJ9LCAke3RoaXMuUkdCX0hNLkd9LCAke3RoaXMuUkdCX0hNLkJ9LCAke3RoaXMuaGVhdG1hcFtpbmRdfSlgO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICdpbmhlcml0JztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Rm9yZWdyb3VuZChkYXk6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAvKiBJZiB0b2RheSAqL1xuICAgICAgaWYgKHRoaXMuaXNGYWIoZGF5KSkge1xuICAgICAgICByZXR1cm4gYHJnYigke3RoaXMuUkdCX1ByaW1hcnlfRkcuUn0sICR7dGhpcy5SR0JfUHJpbWFyeV9GRy5HfSwgJHt0aGlzLlJHQl9QcmltYXJ5X0ZHLkJ9KWA7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5pc1RvZGF5KGRheSkpIHtcbiAgICAgICAgcmV0dXJuIGByZ2IoJHt0aGlzLlJHQl9QcmltYXJ5LlJ9LCAke3RoaXMuUkdCX1ByaW1hcnkuR30sICR7dGhpcy5SR0JfUHJpbWFyeS5CfSlgO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbn1cbiJdfQ==